"use strict";ze.App=function(){this.appStateLog="",this.appState=ze.App.APP_STATE.DEFAULT,this.isInitialized=!1,this.zipFilename=null,this.zipFileSize=null,this.zipMimeType=null,this.isTarFile=!1,this.zipEntryTree=null,this.zipBlob=null,this.zipBlobSource=null,this.currentArchiveTypeString="ZIP",this.currentArchiveHeaderIsEncrypted=!1,this.isInZipEditMode=!1,this.wasZipFileCreatedLocally=!1,this.isSavingToDrive=!1,this.wasSaveToDriveCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.willDownloadAfterDecompression=!1,this.isPreviewDecompressing=!1,this.wasPreviewDecompressionCancelled=!1,this.wasArchiveDecompressionProcessCancelled=!1,this.wasCheckPasswordCancelled=!1,this.hasDownloadBeenAutoRetried=!1,this.lastDownloadId=null,this.addFilesToZipOrEncryptZipCancelRequested=!1,this.doResumeOpenFromDriveAfterManualAuth=!1,this.doResumeExtractToDriveAfterManualAuth=!1,this.doResumeSavePreviewItemToDriveAfterManualAuth=!1,this.doResumeSaveZipToDriveAfterManualAuth=!1,this.doResumeChooseFolderLocationAfterManualAuth=!1,this.doResumeAddFilesToZipFromDriveAfterManualAuth=!1,this.fileIdToOpen=null,this.parentFolderId=null,this.asyncWorkQueue=new ze.AsyncWorkQueue(ze.App.MAX_WORKQUEUE_WORKERS),this.zipEntryStateMap={},this.zipEntriesInProcessMap={},this.createdZipSavedToDriveId=null,this.totalSessionSize=0,this.currentSessionProgress=0,this.isSessionClosed=!1,this.isSessionAborted=!1,this.isSessionAbortedForThePurposesOfPreview=!1,this.sessionHasBeenRetried=!1,this.isProcessingOpenLocalZipFileInputEl=!1,this.isProcessingOpenLocalZipPartFileInputEl=!1,this.isProcessingAddLocalFileInputEl=!1,this.isProcessingAddLocalFolderInputEl=!1,this.createZipFromFileAssociatedExtension=null,this.previewedEntry=null,this.previewedBlob=null,this.previewType=null,this.sessionPropMap={},this.highestZipEntryIndexUploadedInSession=0,this.hasAutoProceededWithDirectNewFlow=!1,this.currentAutodetectedEncoding=null,this.autoRefreshTokenTimer=null,this.isPreviewPdfDirty=!1,this.errorCounter=0,this.isCurrentlyInJumpToZipOperation=!1,this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=null,this.cachedMistypedZipImageUri=null,this.extraZipPartsMap={},this.numExtraZipParts=0,this.zipPartsLoadedMask=[]},ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MINUTES=29,ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS=60*ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MINUTES*1e3,ze.App.ERR_WRITE_DATA="Error while writing file data",ze.App.ERR_READ_DATA="Error while reading file data",ze.App.ERR_READ_DATA_CRC="Error while reading file data (CRC32 check failed)",ze.App.ERR_INCORRECT_PASSWORD="Incorrect password provided",ze.App.ERR_GENERIC_DECOMPRESS="Error while decompressing entry",ze.App.DECOMPRESS_WORKER_MESSAGE_EVENT="message",ze.App.TEXTDECODER_ASCII=null,ze.App.TEXTDECODER_UTF8=null;try{"TextDecoder"in window&&(ze.App.TEXTDECODER_ASCII=new TextDecoder("ascii"),ze.App.TEXTDECODER_UTF8=new TextDecoder("utf-8"))}catch(e){logImpression("text_decoder_instantiate_error","app_load",e)}ze.App.LIB_JSCHARDET_SCRIPT_NAME="lib/jschardet1-4-1.min.js",ze.App.LIB_CREATEZIP_SCRIPT_NAME="lib/lib-createzip-12-min.js",ze.App.LIB_CRYPTO_SCRIPT_NAME="lib/lib-crypto-5-maxmin.js",ze.App.LIB_RAR_SCRIPT_NAME="lib/lib-rar-7-min.js",ze.App.LIB_ZIP_SCRIPT_NAME="lib/lib-zip-8-min.js",ze.App.LIB_SEVENZIP_SCRIPT_NAME="lib/lib-sevenz-7-min.js",ze.App.LIB_BZIP_SCRIPT_NAME="lib/lib-bzip2-new-1-min.js",ze.App.LIB_LZMA_SCRIPT_NAME="lib/lib-lzma-new-3-min.js",ze.App.LIB_XZ_SCRIPT_NAME="lib/lib-xz-2-min.js",ze.App.LIB_INFLATE_SCRIPT_NAME="lib/lib-inflate-14-min.js",ze.App.LIB_PPMDH_SCRIPT_NAME="lib/lib-ppmdh-1-min.js",ze.App.LIB_PPMDI_SCRIPT_NAME="lib/lib-ppmdi-4-min.js",ze.App.CHUNK_SIZE_INFLATE=1048576,ze.App.CHUNK_SIZE_COPY=2097152,ze.App.CHUNK_SIZE_PPMDH=131072,ze.App.CHUNK_SIZE_PPMDI=131072,ze.App.CHUNK_SIZE_BZIP=524288,ze.App.CHUNK_SIZE_LZMA=524288,ze.App.CHUNK_SIZE_XZ=-1,ze.App.LIB_CREATEZIP_WINDOW_OBJECT_CHECK="zeCreateZipLib",ze.App.LIB_ZIP_WINDOW_OBJECT_CHECK="zeZipLib",ze.App.LIB_SEVENZIP_WINDOW_OBJECT_CHECK="zeSevenZLib",ze.App.LIB_RAR_WINDOW_OBJECT_CHECK="RarNode_construct",ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK="zeCryptoLib",ze.App.LIB_JSCHARDET_WINDOW_OBJECT_CHECK="jschardet",ze.App.DEFAULT_PAGE_TITLE="ZIP Extractor - Free App for Opening ZIP Files",ze.App.SUPPORTED_ARCHIVE_EXTENSIONS=["zip","zipx","tar","rar","7z","gz","gzip","tgz","lzma","lz","tlz","bz","bz2","bzip","bzip2","tbz","tbz2","xz","txz","jar","war","ear","epub","apk"],ze.App.SUPPORTED_GOOGLE_DOCS_EXPORT_TYPES=["document","spreadsheet","presentation","drawing","jam"],ze.App.ENCRYPTION_MODE_NONE="none",ze.App.ENCRYPTION_MODE_UNKNOWN="unknown",ze.App.ENCRYPTION_MODE_PKZIPSTANDARD="pkzipstandard",ze.App.ENCRYPTION_MODE_PKZIPSTRONG="pkzipstrong",ze.App.ENCRYPTION_MODE_WINZIPAES="winzipaes",ze.App.ENCRYPTION_MODE_PKZIPOTHER="pkzipother",ze.App.ENCRYPTION_MODE_ENCRYPTEDCDR="encryptedcdr",ze.App.ENCRYPTION_MODE_7ZAES="7z-aes",ze.App.ENCRYPTION_MODE_RAR="rar-all",ze.App.ARCHIVE_TYPE={ZIP:"ZIP",RAR:"RAR",BZIP:"BZIP",GZIP:"GZIP",TAR:"TAR",XZ:"XZ",LZMA_STANDALONE:"LZMA",SEVENZIP:"7-Zip",LZIP:"LZIP"},ze.App.CANONICAL_MIME_TYPES={ZIP:"application/zip",ZIP2:"application/x-zip",ZIP3:"application/x-zip-compressed",GZIP:"application/x-gzip",GZIP2:"application/gzip",GZIP3:"application/x-gzip-compressed",GZIP4:"application/gzip-compressed",XZ:"application/x-xz",SEVENZIP:"application/x-7z-compressed",SEVENZIP2:"application/7z",RAR:"application/rar",RAR2:"application/x-rar",RAR3:"application/x-rar-compressed",RAR4:"application/vnd.rar",BZIP:"application/x-bzip2",BZIP2:"application/bzip2",BZIP3:"application/x-bzip",BZIP4:"application/bzip",BZIP5:"application/x-bz2",TAR:"application/x-tar",TAR2:"application/tar",LZIP:"application/lzip",LZIP2:"application/x-lzip",PNG:"image/png",BMP:"image/bmp",GIF:"image/gif",JPG:"image/jpg",PDF:"application/pdf",MP4:"video/mp4"},ze.App.SUPPORTED_MIME_TYPES=["application/zip","application/x-zip","application/x-zip-compressed","application/rar","application/x-rar","application/x-rar-compressed","application/vnd.rar","application/x-7z-compressed","application/7z","application/tar, application/x-tar","application/x-gzip","application/gzip","application/gzip-compressed","application/x-gzip-compressed","application/x-gtar","application/x-tgz","application/tar+gzip","application/x-gtar-compressed","application/bzip2","application/x-bzip","application/x-bzip2","application/x-bz2","application/bzip","application/x-xz","application/lzip","application/x-lzip","application/epub+zip","application/epub","application/java-archive","application/vnd.android.package-archive"],ze.App.DOCUMENT_REFERENCES=["startPagePrompt","startPageIconImg","startPageIconImgDrive","startPageIconImgGmail","startPageIconImgGeneral","startPageNewDetails","startPageDriveDetails","startPageDriveDetailsCallToAction","startPageGmailDetails","startPageGmailDetailsCallToAction","startPageGeneralDetails","startPageGeneralDetailsCallToAction","checkingAuthSpinner","authButtonContainer","generalButtonContainer","authButtonDetails","profileImageDiv","profileImageImg","profileName","openLocalZipFileInputEl","openLocalZipPartFileInputEl","addLocalFileInputEl","addLocalFolderInputEl","topBanner","startCard","appContent","mainWrapper","centeredBodyContent","mainApp","fileTableHeader","fileTableHeaderLabel","fileTableHeaderSize","fileTableContainer","fileTableAlternateImage","fileTableAlternateImageImg","mainLabel","secondaryLabel","secondaryLabelContainer","mainProgressBarContainer","mainProgressBar","selectAllCheckbox","rootStatus","rootStatusIcon","rootStatusIconContainer","rootStatusSpinner","addFilesFromComputerButton","addFolderButton","addFilesToZipFromDriveButton","addFilesButtonContainer","addZipPartFromComputerButton","addZipPartFromDriveButton","downloadZipButton","saveZipToDriveButton","openZipInDriveButton","editZipButton","fixEncodingButton","doneEditingZipButton","closeButton","openZipFromDriveButton","openZipFromComputerButton","createNewZipButton","viewFilesButton","rateAppButton","sendFeedbackButton","authButton","retryButton","cancelButton","extractButton","checkPasswordButton","fileTableItems","preview","previewGenericContent","previewGen","previewImageContent","previewImg","previewAudioContent","previewAud","previewTextContent","previewTxt","previewVideoContent","previewVid","previewPdfContent","previewPdf","previewDriveContent","previewCloseButton","previewDownloadButton","previewOpenInDriveButton","previewSaveToDriveButton","previewCancelButton","previewNextButton","previewPrevButton","downloadAnchorEl","previewItemFilename","previewZipFilenameAndStatus","previewSpinner","previewItemIcon","previewItemIconImg","noPreviewIcon","previewItemSize","previewProgressBarContainer","previewProgressBar","previewErrorContent","previewErrorCaption","previewErrorDetails","zipTable","mainScrollableContent","mainScrollableContentSubContainer","mainAppHeader","buttonContainer","openButtonsContainer","mainIcon","mainSpinner","zipPasswordInputContainer","zipPasswordInput","zipFilenameInputContainer","zipFilenameInput","fileTableSubHeader","fileTableSubHeaderIcon","fileTableSubHeaderLabel","secondaryLabelLink","previewDriveSaveToDriveFirst","previewSaveToDriveDetails","secondaryLabelLinkCombo","mainAppHeaderContent","footer","textBlockHowToUse","mainAppSubTitle","addPasswordButton","setPasswordButton","encryptionPrompt","encryptionPromptCheckbox","encryptionPromptText","showZipPasswordButton","hideZipPasswordButton","enableCookiesContent","enableCookiesImg1","enableCookiesImg2","enableCookiesImg3","zipDropArea","bottomDndRegionContainer","topDndRegionContainer"],ze.App.SESS_PROP={},ze.App.SESS_PROP.DIDAUTHORIZE="didAuthorize",ze.App.SESS_PROP.DIDPREVIEW="didPreview",ze.App.SESS_PROP.DIDDOWNLOADZIP="didDownloadZip",ze.App.SESS_PROP.DIDZIPDOWNLOAD="didZipDownloadSuccessfully",ze.App.SESS_PROP.DIDPICKEXTRACTLOCATION="didPickExtractLocation",ze.App.SESS_PROP.DIDPICKLOCALZIP="didPickLocalZip",ze.App.SESS_PROP.DIDDRAGDROPZIP="didDragDropZip",ze.App.SESS_PROP.DIDPICKDRIVEZIP="didPickDriveZip",ze.App.SESS_PROP.DIDDOWNLOADSUBITEM="didDownloadSubItem",ze.App.SESS_PROP.DIDOPENZIP="didOpenZip",ze.App.SESS_PROP.DIDZIPOPEN="didZipOpen",ze.App.SESS_PROP.DIDZIPRENDER="didZipRender",ze.App.SESS_PROP.DIDEXTRACTZIP="didExtractZip",ze.App.SESS_PROP.DIDZIPEXTRACT="didZipExtract",ze.App.SESS_PROP.DIDVIEWFILES="didViewFiles",ze.App.SESS_PROP.DIDCANCELDOWNLOAD="didCancelDownload",ze.App.SESS_PROP.DIDCANCELEXTRACTION="didCancelExtraction",ze.App.SESS_PROP.DIDRETRYDOWNLOAD="didRetryDownload",ze.App.SESS_PROP.DIDRETRYEXTRACTION="didRetryExtraction",ze.App.SESS_PROP.DIDCREATEZIP="didCreateZip",ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP="didAddLocalFilesToZip",ze.App.SESS_PROP.DIDADDLOCALFOLDERSTOZIP="didAddLocalFoldersToZip",ze.App.SESS_PROP.DIDRATEAPP="didRateApp",ze.App.APP_STATE={DEFAULT:"default",INIT:"init",UNSUPPORTED_BROWSER:"unsupportedBrowser",NEW_SESSION:"newSession",APP_CREATE:"appCreate",APP_CREATED:"appCreated",APP_INIT:"appInit",ENCRYPTING_ZIP:"encryptingZip",ADD_PASSWORD_TO_ZIP:"addPasswordToZip",PASSWORD_REQUIRED:"passwordRequired",PASSWORD_INCORRECT:"passwordIncorrect",PASSWORD_VERIFIED:"passwordVerified",PASSWORD_FORMAT_NOT_SUPPORTED:"passwordFormatNotSupported",AUTH_PENDING_AUTO:"authPendingAuto",AUTH_PENDING_USER:"authPendingUser",AUTH_REQUIRED:"authRequired",AUTH_ERROR:"authError",AUTH_MISMATCH:"authMisMatch",DOWNLOADING:"downloading",DOWNLOADING_METADATA:"downloadingMetadata",DOWNLOADING_MULTIPLE_METADATA:"downloadingMultipleMetadata",DOWNLOADING_FILE_TO_ADD_TO_ZIP:"downloadingFileToAddToZip",DOWNLOADED_FILE_TO_ADD_TO_ZIP:"downloading",CANCEL_DOWNLOAD_REQUESTED:"cancelDownloadRequested",DOWNLOAD_CANCELED:"downloadCanceled",DOWNLOAD_ALL_BYTES_TRANSFERRED:"downloadAllBytesTransferred",DOWNLOAD_FIRST_BYTE_TRANSFERRED:"downloadFirstByteTransferred",DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED:"downloadToAddToZipFirstByteTransferred",DOWNLOADED:"downloaded",DOWNLOAD_ERROR:"downloadError",DOWNLOAD_ERROR_DUE_TO_AUTH:"downloadErrorDueToAuth",ZIP_READING:"zipReading",ZIP_READ_ERROR:"zipReadError",ZIP_READ_CANCELLED:"zipReadCancelled",MODULE_LOAD_ERROR:"moduleLoadError",MODEL_BUILDING:"modelBuilding",MODEL_BUILT:"modelBuilt",EXTRACTING:"extracting",EXTRACTION_COMPLETE:"extractionComplete",API_LOADED:"apiLoaded",READY_TO_EXTRACT:"readyToExtract",SESSION_CANCELED:"sessionCanceled",EXTRACTION_CANCEL_REQUESTED:"extractionCancelRequested",EXTRACTION_CANCELED:"extractionCanceled",RENDER_ZIP_UI:"renderZipUi",COMPLETE_WITH_ERRORS:"completeWithErrors",LIBRARY_LOADING:"libraryLoading",EDIT_ZIP:"editZip",ADDING_FILES_TO_ZIP:"addingFilesToZip",FILES_ADDED_TO_ZIP:"filesAddedToZip",ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE:"addOrRemoveFilesToZipSessionDone",ZIP_CREATION_ERROR:"zipCreationError",ZIP_CREATION_CANCELLED:"zipCreationCancelled",ZIP_ENCRYPTION_ERROR:"zipEncryptionError",ZIP_ENCRYPTION_CANCELLED:"zipEncryptionCancelled",CHECKING_PASSWORD:"checkingPassword",CHECK_PASSWORD_CANCELLED:"checkPasswordCancelled",MULTI_PART_ZIP:"multiPartZip"},ze.App.ESTATE={ADDED_TO_ZIP:"addedToZip",CREATED_ZIP_SAVED_TO_DRIVE:"createdZipSavedToDrive",DEFAULT:"default",QUEUED:"queued",QUEUED_PENDING_RETRY:"queuedPendingRetry",REQUEUED_AFTER_ERROR:"requeuedAfterError",SKIPPED:"skipped",PENDING:"pending",WAITING:"waiting",CANCELED:"canceled",BEGIN_DECOMPRESSION:"beginDecompression",DECOMPRESSION_PROGRESS:"decompressionProgress",DECOMPRESSION_COMPLETE:"decompressionComplete",DECOMPRESSION_ERROR:"decompressionError",DECOMPRESSION_CANCELED:"decompressionCanceled",BEGIN_UPLOAD:"beginUpload",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_ERROR:"uploadError",UPLOAD_ALL_BYTES_TRANSFERRED:"uploadAllBytesTransferred",UPLOAD_COMPLETE:"uploadComplete",UPLOAD_ABORTED:"uploadAborted",PARSE_ERROR:"parseError",ENTRY_DISK_MISSING:"entryDiskMissing"},ze.App.SESSION_ITEM_STATE_TYPE={UPLOAD_ERROR:"uploadError",DECOMPRESSION_ERROR:"decompressionError",CANCELED:"canceled",AUTH_ERROR:"authError"},ze.App.MAIN_ICON_TYPE={SECURITY:"security",LOCKED:"locked",UNLOCKED:"unlocked",INFO:"info",WARNING:"warning",ERROR:"error",SPINNER:"spinner",CANCEL:"cancel",SUCCESS:"success"},ze.App.NAME="ZIP Extractor",ze.App.EXTRACTED_FOLDER_SUFFIX="(Unzipped Files)",ze.App.FILE_EXTENSION_REGEX="/\\.[^/.]+$/",ze.App.DRIVE_URL="https://drive.google.com/drive/",ze.App.FOLDER_SUFFIX="folders/",ze.App.DEFAULT_ZIP_FILENAME="Untitled.zip",ze.App.MAX_WORKQUEUE_WORKERS=4,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER=1,ze.App.ENTRY_OVERHEAD_BYTES=1e5,ze.App.createDriveFolderLink=function(e){var t="u/"+CURRENT_AUTH_USER+"/";return ze.App.DRIVE_URL+t+(e?ze.App.FOLDER_SUFFIX+e:"")},ze.App.getFolderName=function(e){return ze.App.trimFileExtension(e)+" "+ze.App.EXTRACTED_FOLDER_SUFFIX},ze.App.endsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},ze.App.startsWith=function(e,t){return 0==e.indexOf(t,0)},ze.App.stringSuffixAt=function(e,t){return e.substring(t)},ze.App.stringContains=function(e,t){return-1!=e.indexOf(t,0)},ze.App.trimFileExtension=function(e){return e.replace(ze.App.FILE_EXTENSION_REGEX,"")},ze.App.getFileExtension=function(e){if(null==e)return null;var t=e.trim().split(".");return 1==t.length?"":t.pop().toLowerCase().trim()},ze.App.getBaseFilenameNoExtension=function(e){if(null==e)return null;var t=e.lastIndexOf(".");return e.substring(0,t)},ze.App.trimLastFileExtension=function(e){var t=e.split(".");return 1==t.length?e:(t.pop(),t.join("."))},ze.App.execLater=function(e,t,i){window.setTimeout(function(){e(),t&&t()},i||0)},ze.App.readUint64FromDataView=function(e,t,i){var r=e.getUint32(t,!!i),s=e.getUint32(t+4,!!i);return i?r+Math.pow(2,32)*s:s+Math.pow(2,32)*r},ze.App.maybeReportTestError=function(e){ze.App.isForTesting()&&(console.log("ZE TEST SUITE REPORTING ERROR: "+e),zeTestSuite.reportError(e))},ze.App.maybeReportTestSuccess=function(e){ze.App.isForTesting()&&zeTestSuite.reportSuccess(e)},ze.App.isForTesting=function(){return"zeTestSuite"in window&&"isForTestSuiteFlow"in window&&isForTestSuiteFlow()},ze.App.getTestingPassword=function(){return zeTestSuite.external__getTestPasswordString()},ze.App.maybePreloadLibraryForType=function(e,t){var i=ze.App.getFileExtension(e)||"";"rar"!=(i=i.toLowerCase())&&t!=ze.App.CANONICAL_MIME_TYPES.RAR&&t!=ze.App.CANONICAL_MIME_TYPES.RAR2&&t!=ze.App.CANONICAL_MIME_TYPES.RAR3&&t!=ze.App.CANONICAL_MIME_TYPES.RAR4||ze.App.maybePreloadLibrary(ze.App.LIB_RAR_WINDOW_OBJECT_CHECK,ze.App.LIB_RAR_SCRIPT_NAME),"zip"!=i&&"zipx"!=i&&t!=ze.App.CANONICAL_MIME_TYPES.ZIP&&t!=ze.App.CANONICAL_MIME_TYPES.ZIP2&&t!=ze.App.CANONICAL_MIME_TYPES.ZIP3||ze.App.maybePreloadLibrary(ze.App.LIB_ZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIP_SCRIPT_NAME),"7z"!=i&&t!=ze.App.CANONICAL_MIME_TYPES.SEVENZIP&&t!=ze.App.CANONICAL_MIME_TYPES.SEVENZIP2||ze.App.maybePreloadLibrary(ze.App.LIB_SEVENZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_SEVENZIP_SCRIPT_NAME)},ze.App.maybePreloadLibrary=function(e,t){null==window[e]&&loadScript(t,function(){},function(){})},ze.App.prototype.initAfterDomLoaded=function(e){this.isInitialized||(this.isInitialized=!0,this.fileIdToOpen=e,this.addDocumentReferences(),this.addEventListeners(),logImpression("app_initialized - initAfterDomLoaded()","app_load",ze.VERSION),this.startSessionAfterInit(),ze.App.maybePreloadLibraryForType("test.zip"))},ze.App.prototype.startSessionAfterInit=function(){isAuthorized()&&(this.updateUserInfoUi(),this.maybeEnableAutoRefreshTokenTimer()),this.fileIdToOpen?isAuthorized()?this.maybeDownloadAfterAuth():isFirstAuthPending()||this.updateStartPageButtons():isFirstAuthPending()||this.maybeProceedWithDirectNewFlow()||(this.updateStartPageButtons(),this.startNewManualSession())},ze.App.prototype.handleCancelAddPasswordToZip=function(){this.zipPasswordInput.value="",this.hideAddPasswordPrompt(!0)},ze.App.prototype.hideAddPasswordPrompt=function(e){var t=this.zipEntryTree&&this.zipEntryTree.originalEntries?this.zipEntryTree.originalEntries.length:0,i=e?0==t?"Creating new ZIP file":"Editing ZIP":"Password set. Ready to add files to ZIP";this.updateLabelsAndProgress(i,""),e?this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO):this.setMainIcon(ze.App.MAIN_ICON_TYPE.LOCKED),this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.encryptionPrompt,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.setPasswordButton,!1),this.showEl(this.downloadZipButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!1),this.configureUiForZipEditMode()},ze.App.prototype.handleAddPasswordToZip=function(){this.setAppState(ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP)},ze.App.prototype.encryptZip=function(e){e?ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,bindFn(this.doEncryptZip,this,e)):this.doEncryptZip(e)},ze.App.ensureLibLoadedAndCallback=function(i,r,s,n){null!=window[i]?s&&s():(MAINAPP.setAppState(ze.App.APP_STATE.LIBRARY_LOADING),loadScript(r,s,function(e){var t;n?(t=e.target,e&&"error"==e.type&&e.target&&e.target.src&&(t="Target source: "+e.target.src),logImpression("module_load_error","misc",t),MAINAPP.setAppState(ze.App.APP_STATE.MODULE_LOAD_ERROR,e)):ze.App.ensureLibLoadedAndCallback(i,r,s,!0)}))},ze.App.prototype.doEncryptZip=function(e){var t=e?ze.App.ENCRYPTION_MODE_WINZIPAES:ze.App.ENCRYPTION_MODE_PKZIPSTANDARD;this.zipEntryTree.isEncrypted=!0,this.zipEntryTree.encryptionMode=t,this.hideAddPasswordPrompt(!1),this.zipEntryTree.originalEntries&&0==this.zipEntryTree.originalEntries.length?this.maybeShowZipFileCommentOrEncryptedState():(this.setAppState(ze.App.APP_STATE.ENCRYPTING_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1,logImpression("do_encrypt_zip","encrypt_zip",this.createZipFromFileAssociatedExtension+" ("+t+")"),zeCreateZipLib.serializeZipFromEntries(this.zipEntryTree.originalEntries,this.zipBlob,[],bindFn(this.renderCreatedZip,this,!1,null,null,!0,!1,void 0,void 0,!1,void 0),bindFn(this.handleZipEncryptError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipEncryptError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,t,this.getZipPasswordCharCodeByteArray()))},ze.App.prototype.maybeProceedWithDirectNewFlow=function(){return!this.hasAutoProceededWithDirectNewFlow&&(!!isForDirectNewFlow()&&(this.hasAutoProceededWithDirectNewFlow=!0,logImpression("create_new_zip_direct_new","create_new_zip"),this.doCreateNewZip(),!0))},ze.App.prototype.checkStateUserAndLoggedInUserMatch=function(){var e=getLoggedInUserId();if(null==e)return!1;var t=getStateUserId();return null==t||("{userId}"==t||t==e)},ze.App.prototype.handleStateUserIdMismatchError=function(){logImpression("auth_account_mismatch","auth","authUser: "+CURRENT_AUTH_USER),this.setAppState(ze.App.APP_STATE.AUTH_MISMATCH)},ze.App.prototype.handleFirstAuthError=function(){this.maybeProceedWithDirectNewFlow()||this.updateStartPageButtons()},ze.App.prototype.handleFirstAuthSuccess=function(){this.handleAppPostAuthorizationTasks(),this.maybeEnableAutoRefreshTokenTimer()},ze.App.prototype.handleAppPostAuthorizationTasks=function(){this.updateUserInfoUi(),this.fileIdToOpen?this.maybeDownloadAfterAuth():this.maybeProceedWithDirectNewFlow()||this.updateStartPageButtons()},ze.App.prototype.maybeDownloadAfterAuth=function(){this.downloadInProgress(this.fileIdToOpen)||(this.checkStateUserAndLoggedInUserMatch()?(this.zipBlobSource="drive",this.downloadFileById(this.fileIdToOpen)):this.handleStateUserIdMismatchError())},ze.App.prototype.configureStartPageForNewManualSession=function(){this.authButtonDetails.textContent="",this.showEl(this.startPageIconImgGeneral,!0),this.showEl(this.startPageIconImgGmail,!1),this.showEl(this.startPageIconImgDrive,!1),this.showEl(this.generalButtonContainer,!0),this.showEl(this.authButtonContainer,!1),this.showEl(this.authButton,!1),this.showEl(this.authButtonDetails,!1),this.showEl(this.checkingAuthSpinner,!1),this.showEl(this.startPageGeneralDetails,!0),this.showEl(this.startPageGeneralDetailsCallToAction,!0),document.getElementById("startPageGeneralDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageGmailDetails,!1),this.showEl(this.startPageGmailDetailsCallToAction,!1),this.showEl(this.startPageDriveDetails,!1),this.showEl(this.startPageDriveDetailsCallToAction,!1),this.showEl(this.startPageNewDetails,!1),this.showEl(this.startPagePrompt,!0)},ze.App.prototype.updateStartPageButtons=function(){var e=null==this.fileIdToOpen?"general":getReferringSource();null!=this.fileIdToOpen&&"gmail"!=e&&(e="drive");var t="drive"==e,i="gmail"==e,r=!(t||i||isForDirectNew);this.showEl(this.authButtonContainer,!r),this.showEl(this.authButton,!r),this.showEl(this.authButtonDetails,!r),this.showEl(this.checkingAuthSpinner,!1),this.showEl(this.generalButtonContainer,r),this.showEl(this.startPageGeneralDetails,r),r&&document.getElementById("startPageGeneralDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageGmailDetails,i),i&&document.getElementById("startPageGmailDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageDriveDetails,t),t&&document.getElementById("startPageDriveDetailsCallToAction").removeAttribute("visibilityHidden"),this.showEl(this.startPageNewDetails,isForDirectNew)},ze.App.prototype.initiateManualAuth=function(e){var t=!0,i=t?null:getStateUserId();this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),authorize(!1,bindFn(this.handleManualAuthSuccess,this),bindFn(this.handleManualAuthError,this),i,void 0,t,"initiateManualAuth")},ze.App.prototype.handleManualAuthSuccess=function(){this.doResumeOpenFromDriveAfterManualAuth?(this.doResumeOpenFromDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),ze.App.showPicker(bindFn(this.handlePickerZipFileSelected,this))):this.doResumeChooseFolderLocationAfterManualAuth?(this.doResumeChooseFolderLocationAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.handleSecondaryLabelLinkClick()):this.doResumeExtractToDriveAfterManualAuth?(this.doResumeExtractToDriveAfterManualAuth=!1,this.enableEl(this.extractButton,!0),this.updateLabelsForReadyToExtract(),this.updateUserInfoUi(),this.setAuthText(""),this.doExtract(!1)):this.doResumeSavePreviewItemToDriveAfterManualAuth?(this.doResumeSavePreviewItemToDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.handlePreviewSaveToDriveButtonClick()):this.doResumeSaveZipToDriveAfterManualAuth?(this.doResumeSaveZipToDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.saveZipToDrive()):this.doResumeAddFilesToZipFromDriveAfterManualAuth?(this.doResumeAddFilesToZipFromDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.addFilesToZipFromDrive()):(this.setAuthText("Signed in as "+getUserEmail()),this.handleAppPostAuthorizationTasks())},ze.App.prototype.handleManualAuthError=function(e,t){this.setAppState(ze.App.APP_STATE.AUTH_ERROR,e,t)},ze.App.prototype.updateUserInfoUi=function(){this.sessionPropMap[ze.App.SESS_PROP.DIDAUTHORIZE]=!0;var e=ze.App.htmlEscape(getUserEmail()),t=ze.App.htmlEscape(getUserFullName()),i=ze.App.htmlEscape(getUserGivenName());this.profileImageImg.src=getUserPicture()+"?size=72",this.profileName.textContent=i,this.showEl(this.profileImageDiv,!0),this.showEl(this.profileName,!0),this.profileImageImg.title="Switch Google Account",this.profileName.title=t+" ("+e+")"},ze.App.prototype.setAppState=function(e,t,i,r,s){this.appState=e,this.appStateLog+=" "+e,this.updateViewFromAppState(t,i,r,s)},ze.App.prototype.downloadInProgress=function(e){return this.lastDownloadId==e&&(this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA||this.appState==ze.App.APP_STATE.DOWNLOADING||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_CANCELED||this.appState==ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED||this.appState==ze.App.APP_STATE.CANCEL_DOWNLOAD_ERROR)},ze.App.prototype.downloadFileById=function(e){logImpression("download_file_metadata","download","start. is_authorized="+isAuthorized()),this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADZIP]=!0,this.hideWelcomeText(),this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.lastDownloadId=e,this.setAppState(ze.App.APP_STATE.DOWNLOADING_METADATA);var t=this,i=ze.Dapi.generateCallbacks(function(e){ze.App.maybePreloadLibraryForType(e.name,e.mimeType),e.mimeType==ze.Dapi.MimeType.FOLDER?t.handleOpenWithOnFolder(e):t.downloadFile(e)},bindFn(this.onDownloadError,this),void 0,bindFn(this.onDownloadAborted,this));ze.Dapi.get(e,i)},ze.App.prototype.handleOpenWithOnFolder=function(e){logImpression("open_with_on_folder","misc");var t=this;this.doCreateNewZip(function(){t.addFilesToZipFromDrive(e.id)})},ze.App.prototype.downloadFile=function(e){logImpression("download_file_blob","download","start");var t=ze.App.getProcessedSizeFromDriveFileObj(e);this.setAppState(ze.App.APP_STATE.DOWNLOADING,e.name,t);var i=ze.Dapi.generateCallbacks(bindFn(this.onDownloadSuccess,this,e),bindFn(this.onDownloadError,this),bindFn(this.onDownloadProgress,this,!1,null,t),bindFn(this.onDownloadAborted,this));ze.App.isExportableGoogleDocsMimeType(e.mimeType)?ze.Dapi.exportGoogleDocFileBytes(e.id,i):ze.Dapi.downloadFileBytes(e.id,i)},ze.App.prototype.onDownloadSuccess=function(r,s){logImpression("download_file_blob","download","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPDOWNLOAD]=!0,this.setAppState(ze.App.APP_STATE.DOWNLOADED),this.parentFolderId=ze.App.getParentIdOfDownloadedFile(r);var o,p,a,l=r.name.trim(),e=ze.App.isExportableGoogleDocsMimeType(r.mimeType);e&&(l+=".pdf",r.mimeType="application/pdf",r.id=null),!e&&ze.App.isSupportedArchiveType(l,r.mimeType)?this.readArchive(l,r.size,r.mimeType,s):!e&&null!=ze.App.translateZipPartFilenameToIndex(l)&&STATE&&STATE.ids&&1<STATE.ids.length?(o=STATE.ids.slice(1),p=ze.App.getBaseFilenameNoExtension(l),this.updateLabelsAndProgress("Downloading ZIP parts..."),this.showOrHideOpenZipPartButtons(!1),(a=this).downloadMultipleFileIds(o,function(e,t){var i,n=ze.App.getArchiveFilesProperties(t,p);n.hasPrimaryArchive?(i=o[n.primaryArchiveIdx],a.downloadMultipleFileIds([i],function(e,t){var i=t[0],r=e[0],s=STATE.ids[0];STATE.ids[0]=STATE.ids[1+n.primaryArchiveIdx],STATE.ids[1+n.primaryArchiveIdx]=s,a.readArchive(i.name.trim(),i.size,i.mimeType,r)},function(e){a.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)})):a.createNewZipFromFile(l,s,r.id)},function(e){console.trace(),console.log("download multipart ERROR",e),a.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},!0)):this.createNewZipFromFile(l,s,r.id)},ze.App.prototype.onDownloadError=function(e,t){var i="isAuthorized? "+isAuthorized()+" - isTokenExpired? "+isTokenExpired()+"; error: "+e,r="",r=this.appState==ze.App.APP_STATE.DOWNLOADING?"download_file_init_error":this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED?"download_file_blob_error":this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA?"download_file_metadata_error":this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP?"download_file_init_error_add_to_zip":this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED?"download_file_blob_error_add_to_zip":"download_file_other_error";logImpression(r,"download",i);var s,n=this,o=e==ze.Dapi.ErrType.AUTH_ERROR||e==ze.Dapi.ErrType.FORBIDDEN||e==ze.Dapi.ErrType.FILE_NOT_FOUND;this.hasDownloadBeenAutoRetried?(s=o?ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH:ze.App.APP_STATE.DOWNLOAD_ERROR,this.setAppState(s,t,o)):(this.hasDownloadBeenAutoRetried=!0,o?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_AUTO),authorize(!0,bindFn(this.downloadFileById,this,this.lastDownloadId),function(){n.setAppState(ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH,"(Auth auto retry failed): "+t,!0)},void 0,CURRENT_AUTH_USER,!1,"onDownloadError")):this.downloadFileById(this.lastDownloadId))},ze.App.prototype.onDownloadProgress=function(e,t,i,r,s){var n,o;this.appState!=ze.App.APP_STATE.DOWNLOAD_CANCELED&&-1!=i&&(n=null!=s&&0!==s?s:i,o=e?'Downloading: "'+t+'" ('+ze.App.formatSize(i)+")":"Opening",this.handleGenericMainProgress(r,n,!0,o),r===i?this.setAppState(ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED,t,i):this.appState==ze.App.APP_STATE.DOWNLOADING&&0<r?this.setAppState(ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED,t,i):this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&0<r&&this.setAppState(ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED,t,i))},ze.App.prototype.onDownloadAborted=function(){this.handleDownloadCanceled()},ze.App.prototype.handleDownloadCanceled=function(){this.setAppState(ze.App.APP_STATE.DOWNLOAD_CANCELED)},ze.App.prototype.maybeEnableAutoRefreshTokenTimer=function(){null==this.autoRefreshTokenTimer&&(this.autoRefreshTokenTimer=setTimeout(bindFn(this.doAutoRefreshToken,this),ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS))},ze.App.prototype.doAutoRefreshToken=function(){clearTimeout(this.autoRefreshTokenTimer);var e=this;authorize(!0,function(){e.autoRefreshTokenTimer=setTimeout(bindFn(e.doAutoRefreshToken,e),ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS)},function(e){},void 0,CURRENT_AUTH_USER,!1,"autoRefreshToken",!0)},ze.App.prototype.handleZipDropAreaDragEnter=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.allowedEffect="copyMove",console.log("dragenter",e),this.mainScrollableContent.scrollTop=0,this.showEl(this.mainScrollableContentSubContainer,!1),this.zipDropArea.style.zIndex="200",this.showEl(this.zipDropArea,!0),this.mainScrollableContent.classList.add("dndDisablePointerEventsRegion"),this.zipDropArea.style.opacity="1"},ze.App.prototype.handleZipDropAreaDragLeave=function(e){e.stopPropagation(),e.preventDefault(),this.zipDropArea.classList.remove("zipDropAreaHover"),console.log("dragleave",e),this.mainScrollableContent.classList.remove("dndDisablePointerEventsRegion"),this.showEl(this.mainScrollableContentSubContainer,!0),this.zipDropArea.style.opacity="0",this.zipDropArea.style.zIndex="50"},ze.App.prototype.handleZipDropAreaDragOver=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},ze.App.prototype.handleZipDropAreaDrop=function(e){console.log("DROP"),e.stopPropagation(),e.preventDefault(),this.zipDropArea.classList.remove("zipDropAreaHover"),this.mainScrollableContent.classList.remove("dndDisablePointerEventsRegion"),this.showEl(this.mainScrollableContentSubContainer,!0),this.zipDropArea.style.opacity="0",this.zipDropArea.style.zIndex="50";var t,i,r,s,n,o=e.dataTransfer.items;o&&0<o.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDPICKLOCALZIP]=!0,t=this.convertDataTransferItemsToFileOrDirectoryEntries(o),i=!1,s=r=null,1==o.length&&t&&0<=t.length&&t[0].isDirectory&&(i=!0,(s=t[0].name)&&(r=s+".zip")),(n=this).traverseEntryTreeAsync(t,function(e){n.convertFileEntriesIntoFilesAsync(e,function(e){n.closeSession(!0),n.maybeCreateLocalSessionFromFiles(e,!0,i,r,s)},function(e){console.err(e)})}))},ze.App.prototype.traverseEntryTreeAsync=function(e,t){this.doTraverseEntryTreeAsync(e,0,[],t)},ze.App.prototype.doTraverseEntryTreeAsync=function(i,r,s,n){var e,o;r==i.length?n(s):(e=i[r]).isFile?(s.push(e),this.doTraverseEntryTreeAsync(i,r+1,s,n)):e.isDirectory?(s.push(e),(o=this).scanDirectoryForEntries(e.createReader(),function(e){o.traverseEntryTreeAsync(e,function(e){for(var t=0;t<e.length;t++)s.push(e[t]);o.doTraverseEntryTreeAsync(i,r+1,s,n)})})):console.log("Unrecognized Entry Type",e)},ze.App.prototype.convertFileEntriesIntoFilesAsync=function(e,t,i){this.doConvertFileEntriesIntoFilesAsync(e,0,[],t,i)},ze.App.prototype.doConvertFileEntriesIntoFilesAsync=function(t,i,r,s,n){var e,o,p=this,a=t[i],l=ze.App.startsWith(a.fullPath,"/")?a.fullPath.substring(1):a.fullPath;a.isDirectory?(e={isDirectory:!0},ze.App.endsWith(l,"/")||(l+="/"),e.fullPath=l,o=a.name,ze.App.endsWith(o,"/")||(o+="/"),e.name=o,r.push(e),i==t.length-1?s(r):p.doConvertFileEntriesIntoFilesAsync(t,i+1,r,s,n)):a.file(function(e){e.fullPath=l,r.push(e),i==t.length-1?s(r):p.doConvertFileEntriesIntoFilesAsync(t,i+1,r,s,n)},n)},ze.App.prototype.convertDataTransferItemsToFileOrDirectoryEntries=function(e){if(null==e)return e;if(!e.length)return[];for(var t,i=[],r=0;r<e.length;r++){"file"==e[r].kind&&(((t=e[r]).webkitGetAsEntry||t.getAsEntry)&&i.push(t.webkitGetAsEntry?t.webkitGetAsEntry():t.getAsEntry()))}return i},ze.App.prototype.scanDirectoryForEntries=function(e,t){this.doScanDirectory(e,[],t)},ze.App.prototype.doScanDirectory=function(i,r,s){var n=this;i.readEntries(function(e){if(0==e.length)s(r);else{for(var t=0;t<e.length;t++)r.push(e[t]);n.doScanDirectory(i,r,s)}})},ze.App.prototype.maybeCreateLocalSessionFromFiles=function(e,t,i,r,s){var n,o=ze.App.getArchiveFilesProperties(e);if(o.hasPrimaryArchive&&!o.isDirectoryTree){var p=e[o.primaryArchiveIdx],a=p.name.trim(),l=ze.App.getFileExtension(a)||"";if((l=l.toLowerCase())&&""!=l&&-1!=ze.App.SUPPORTED_ARCHIVE_EXTENSIONS.indexOf(l)){var h=null;if(o.hasMultiPartArchiveParts){h=[];for(var d=0;d<o.multiPartArchivePartsIdx.length;d++)h.push(e[o.multiPartArchivePartsIdx[d]])}if(o.hasMultiPartArchiveParts||!i)return this.zipBlobSource="local",void this.loadArchiveSessionFromManualBlobs(a,p,h);console.log("This is a folder scenario and NOT a multi archive part scenario. Therefore, proceed to fall through to create.")}else console.log("unsupported file extension for archive: "+a)}t&&(n=this).doCreateNewZip(function(){n.sessionPropMap[ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP]=!0,n.addFilesToZip(e,void 0,void 0,!0,i,r,s)})},ze.App.getArchiveType=function(e,t){return e==ze.App.CANONICAL_MIME_TYPES.ZIP||e==ze.App.CANONICAL_MIME_TYPES.ZIP2||e==ze.App.CANONICAL_MIME_TYPES.ZIP3?ze.App.ARCHIVE_TYPE.ZIP:e==ze.App.CANONICAL_MIME_TYPES.RAR||e==ze.App.CANONICAL_MIME_TYPES.RAR2||e==ze.App.CANONICAL_MIME_TYPES.RAR3||e==ze.App.CANONICAL_MIME_TYPES.RAR4?ze.App.ARCHIVE_TYPE.RAR:e==ze.App.CANONICAL_MIME_TYPES.GZIP||e==ze.App.CANONICAL_MIME_TYPES.GZIP2||e==ze.App.CANONICAL_MIME_TYPES.GZIP3||e==ze.App.CANONICAL_MIME_TYPES.GZIP4?ze.App.ARCHIVE_TYPE.GZIP:e==ze.App.CANONICAL_MIME_TYPES.TAR||e==ze.App.CANONICAL_MIME_TYPES.TAR2?ze.App.ARCHIVE_TYPE.TAR:e==ze.App.CANONICAL_MIME_TYPES.BZIP||e==ze.App.CANONICAL_MIME_TYPES.BZIP2||e==ze.App.CANONICAL_MIME_TYPES.BZIP3||e==ze.App.CANONICAL_MIME_TYPES.BZIP4||e==ze.App.CANONICAL_MIME_TYPES.BZIP5?ze.App.ARCHIVE_TYPE.BZIP:e==ze.App.CANONICAL_MIME_TYPES.SEVENZIP||e==ze.App.CANONICAL_MIME_TYPES.SEVENZIP2?ze.App.ARCHIVE_TYPE.SEVENZIP:e==ze.App.CANONICAL_MIME_TYPES.XZ?ze.App.ARCHIVE_TYPE.XZ:e==ze.App.CANONICAL_MIME_TYPES.LZIP||e==ze.App.CANONICAL_MIME_TYPES.LZIP2?ze.App.ARCHIVE_TYPE.LZIP:"zip"==t||"zipx"==t?ze.App.ARCHIVE_TYPE.ZIP:"tar"==t?ze.App.ARCHIVE_TYPE.TAR:"rar"==t?ze.App.ARCHIVE_TYPE.RAR:"gz"==t||"gzip"==t||"tgz"==t?ze.App.ARCHIVE_TYPE.GZIP:"7z"==t?ze.App.ARCHIVE_TYPE.SEVENZIP:"lz"==t||"tlz"==t?ze.App.ARCHIVE_TYPE.LZIP:"lzma"==t?ze.App.ARCHIVE_TYPE.LZMA_STANDALONE:"xz"==t||"txz"==t?ze.App.ARCHIVE_TYPE.XZ:"bz"==t||"bz2"==t||"bzip"==t||"bzip2"==t||"tbz"==t||"tbz2"==t?ze.App.ARCHIVE_TYPE.BZIP:ze.App.ARCHIVE_TYPE.ZIP},ze.App.prototype.readArchive=function(e,t,i,r,s,n,o){var p=null!=s?s:t;this.hideWelcomeText();var a=(a=ze.App.getFileExtension(e)||"").toLowerCase();this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,ze.App.updatePageTitle(e),this.zipFilename=e,this.zipFileSize=t,this.zipMimeType=i,this.showEl(this.closeButton,!1),this.showEl(this.retryButton,!1);var l=ze.App.getArchiveType(i,a),h=l.toLowerCase();switch(logImpression("read_"+h,h,"start. Extension: "+a+"; MIME type: "+i),this.currentArchiveTypeString=l,this.setAppState(ze.App.APP_STATE.ZIP_READING),this.currentArchiveTypeString=l){case ze.App.ARCHIVE_TYPE.RAR:this.doReadRar(r,o,n);break;case ze.App.ARCHIVE_TYPE.GZIP:this.doReadGzip(r,e,n);break;case ze.App.ARCHIVE_TYPE.TAR:this.doReadTarFromBlob(r,this.currentAutodetectedEncoding,n);break;case ze.App.ARCHIVE_TYPE.BZIP:this.doReadBzip(r,e,n);break;case ze.App.ARCHIVE_TYPE.ZIP:this.doReadZip(r,e,i,p,this.currentAutodetectedEncoding,n);break;case ze.App.ARCHIVE_TYPE.SEVENZIP:this.doReadSevenZ(r,o,n);break;case ze.App.ARCHIVE_TYPE.LZMA_STANDALONE:this.doReadLzmaStandalone(r,e,n);break;case ze.App.ARCHIVE_TYPE.LZIP:this.doReadLzip(r,e,n);break;case ze.App.ARCHIVE_TYPE.XZ:this.doReadXz(r,e,n);break;default:throw new Error("Unrecognized archiveType in doReadArchive(): "+l)}},ze.App.prototype.doReadZip=function(i,e,t,r,s,n){var o=this;ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIP_SCRIPT_NAME,function(){zeZipLib.readHeaderMetadataFromEocdr(i,e,t,r,function(e){var t=e.numExtraZipParts;200<t?o.archiveReadError(n,"Cannot read multi-part ZIP file with more than 200 parts ("+t+")"):(e.encoding=s,zeZipLib.readEntriesFromCentralDirectory(e,i,bindFn(o.archiveReadSuccess,o,i,e.zipFileComment,t,n),bindFn(o.archiveReadError,o,n)))},bindFn(o.archiveReadError,o,n))})},ze.App.prototype.archiveReadSuccess=function(e,t,i,r,s,n){logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0;var o=r||n;this.buildEntryTree(s,bindFn(this.entryTreeBuildComplete,this,e,o),t,i)},ze.App.prototype.archiveReadError=function(e,t,i,r,s,n){var o;i?(logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","cancelled"),this.setAppState(ze.App.APP_STATE.ZIP_READ_CANCELLED)):(o=t&&null!=t.code?" FileError Code: "+t.code:"",logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","error: "+t+o),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,t,r,s,n)),e&&e(!1)},ze.App.prototype.doReadSevenZ=function(e,t,i){var r=this;ze.App.ensureLibLoadedAndCallback(ze.App.LIB_SEVENZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_SEVENZIP_SCRIPT_NAME,function(){ze.SevenZLibCore.verifySevenZFile(e,bindFn(ze.SevenZLibCore.getSevenZEntries,r,e,bindFn(r.archiveReadSuccess,r,e,void 0,void 0,i),bindFn(r.archiveReadErrorWithHeaderPassword,r),bindFn(r.archiveReadProgress,r),t),bindFn(r.archiveReadErrorWithHeaderPassword,r))})},ze.App.prototype.doReadRar=function(e,t,i){ze.RarLib.verifyRarFile(e,bindFn(ze.RarLib.getRarEntries,this,e,bindFn(this.archiveReadSuccess,this,e,void 0,void 0,i),bindFn(this.archiveReadErrorWithHeaderPassword,this),bindFn(this.archiveReadProgress,this),t),bindFn(this.archiveReadErrorWithHeaderPassword,this))},ze.App.prototype.archiveReadErrorWithHeaderPassword=function(e,t,i,r){i||r||logImpression(this.currentArchiveTypeString.toLowerCase(),"archive_read","error: "+e),this.handleReadErrorWithOptionalHeaderPassword(e,t,i,r)},ze.App.prototype.doReadTarFromBlob=function(e,t,i){this.isTarFile=!0,ze.TarLib.verifyTarFile(e,bindFn(ze.TarLib.getTarEntriesFromBlob,this,e,bindFn(this.archiveReadSuccess,this,e,void 0,void 0,i),bindFn(this.archiveReadError,this,i),bindFn(this.archiveReadProgress,this),t),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadTarFromByteArrayParts=function(r,s){var n=this;ze.TarLib.getTarEntriesFromByteArrayParts(r,function(e){for(var t=new Blob(r),i=0;i<r.length;i++)r[i]=[];r=[],n.isTarFile=!0,n.archiveReadSuccess(t,void 0,void 0,s,e)},bindFn(this.archiveReadError,this,s),bindFn(this.archiveReadProgress,this))},ze.App.prototype.archiveDecompressProgress=function(e,t,i){this.handleGenericMainProgress(e,t,i,"Decompressing")},ze.App.prototype.archiveReadProgress=function(e,t,i){this.handleGenericMainProgress(e,t,i,"Reading")},ze.App.prototype.handleJumpToZipDecompressProgress=function(e,t){this.handleGenericMainProgress(e,t,!0,"Decompressing")},ze.App.prototype.handleGenericMainProgress=function(e,t,i,r){var s,n=Math.floor(3+e/t*97);return this.setProgressBarPercent(n),i&&(s=r||"",this.updateLabelsAndProgress(null,s+" ("+n.toString()+"%)",n)),n},ze.App.prototype.handleGenericPreviewProgress=function(e,t,i,r){var s,n=Math.floor(3+e/t*97);return this.setPreviewProgressBarPercent(n),i&&(s=r||"",this.previewZipFilenameAndStatus.textContent=s+" ("+n+"%)"),n},ze.App.prototype.generalDecompressionCheckCancelFn=function(){return this.wasPreviewDecompressionCancelled||this.isSessionAbortedForThePurposesOfPreview||this.wasArchiveDecompressionProcessCancelled||this.wasCheckPasswordCancelled},ze.App.prototype.doReadBzip=function(e,t,i){ze.BzipLib.verifyBzipFile(e,bindFn(ze.BzipLib.getBzipEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadGzip=function(e,t,i){var r=this;ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIP_SCRIPT_NAME,function(){ze.GzipLib.verifyGzipFile(e,bindFn(ze.GzipLib.getGzipEntry,r,e,t,bindFn(r.streamDecodedArchiveReadSuccess,r,e,bindFn(r.archiveReadError,r,i),i),bindFn(r.archiveReadError,r,i)),bindFn(r.archiveReadError,r,i))})},ze.App.prototype.doReadLzip=function(e,t,i){ze.LzipLib.verifyLzipFile(e,bindFn(ze.LzipLib.getLzipEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadLzmaStandalone=function(e,t,i){ze.LzmaLib.verifyLzmaFile(e,bindFn(ze.LzmaLib.getLzmaEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.doReadXz=function(e,t,i){ze.XzLib.verifyXzFile(e,bindFn(ze.XzLib.getXzEntry,this,e,t,bindFn(this.streamDecodedArchiveReadSuccess,this,e,bindFn(this.archiveReadError,this,i),i),bindFn(this.archiveReadError,this,i)),bindFn(this.archiveReadError,this,i))},ze.App.prototype.streamDecodedArchiveReadSuccess=function(e,t,i,r,s,n){logImpression("read_"+this.currentArchiveTypeString.toLowerCase(),"archive","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,this.maybeHandleEmbeddedTarFileBeforeDecompress(e,t,r,s,n,i)},ze.App.prototype.maybeHandleEmbeddedTarFileBeforeDecompress=function(e,t,i,r,s,n){var o=r||i.filename,p=this;o&&ze.App.endsWith(o.toLowerCase(),".tar")?(this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.updateLabelsAndProgress(null,"Decompressing..."),this.wasArchiveDecompressionProcessCancelled=!1,this.zipBlob=e,ze.App.decompressArchiveEntry(e,i,!0,function(e){p.updateLabelsAndProgress("Reading embedded TAR file..."),ze.App.execLater(function(){try{p.doReadTarFromByteArrayParts(e,n)}catch(e){return void t(e)}},void 0,1)},t,bindFn(this.archiveDecompressProgress,this),bindFn(this.generalDecompressionCheckCancelFn,this),void 0,!0)):this.buildEntryTree([i],bindFn(this.entryTreeBuildComplete,this,e,n),s)},ze.App.prototype.handleReadErrorWithOptionalHeaderPassword=function(e,t,i,r){var s;i?(this.currentArchiveHeaderIsEncrypted=!0,r?(this.setAppState(ze.App.APP_STATE.PASSWORD_INCORRECT),ze.App.maybeReportTestError(e)):(s=this,ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){s.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED,!0),ze.App.maybeReportTestError(e)}))):this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.entryTreeBuildComplete=function(e,t){this.zipBlob=e,this.renderZipTableUi(bindFn(this.zipUiRenderComplete,this,t))},ze.App.prototype.zipUiRenderComplete=function(e,t){if(null!=this.zipEntryTree)if(this.maybeShowZipFileCommentOrEncryptedState(),this.isInZipEditMode)this.configureUiForZipEditMode(this.numFilesRecentlyAdded,this.numFilesRecentlyRemoved,t),this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=null,e&&e(!0);else if(0<this.numExtraZipParts&&this.areAdditionalZipPartsRequired()){var i,p,r=this.getAdditionalZipPartsRequiredExtensionString();this.setAppState(ze.App.APP_STATE.MULTI_PART_ZIP,r),logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","start. numExtraParts: "+this.numExtraZipParts),e&&e(!0),STATE&&STATE.ids&&1<STATE.ids.length&&(i=STATE.ids.slice(1),this.updateLabelsAndProgress("Downloading ZIP parts..."),this.showOrHideOpenZipPartButtons(!1),(p=this).downloadMultipleFileIds(i,function(e,t){var i=ze.App.getBaseFilenameNoExtension(p.zipFilename),r=ze.App.getArchiveFilesProperties(t,i),s=null;if(r.hasMultiPartArchiveParts){s=[];for(var n=0;n<r.multiPartArchivePartsIdx.length;n++){var o=r.multiPartArchivePartsIdx[n];e[o].name=t[o].name,s.push(e[o])}}s&&0<s.length&&p.addZipPartBlobsToExistingMultiPartArchive(s)},function(e){console.trace(),console.log("download multipart ERROR",e),p.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),p.updateLabelsAndProgress(void 0,"Multi-Download Error (A): "+e,100)}))}else{if(0<this.numExtraZipParts)try{this.maybeHandleMultiPartZipFollowUpActions()}catch(e){throw logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","error: "+e),console.trace(),e}this.zipEntryTree.isEncrypted?this.configurePasswordPrompt():this.setReadyToExtract();var s=this.zipEntryTree&&this.zipEntryTree.filenameHasExtendedChar&&null==this.currentAutodetectedEncoding;this.showEl(this.fixEncodingButton,s),s&&this.enableEl(this.fixEncodingButton,!0);var n="Number of entries in archive: "+this.zipEntryTree.originalEntries.length+"; encrypted: "+!!this.zipEntryTree.isEncrypted;e&&e(!0),ze.App.maybeReportTestSuccess(n)}else e&&e(!1)},ze.App.prototype.maybeHandleMultiPartZipFollowUpActions=function(){if(!(this.numExtraZipParts<=0)){var e=[],t=0;e[0]=0;for(var i=1;i<=this.numExtraZipParts;i++){var r=this.extraZipPartsMap["zipPart-"+i];if(!r)throw new Error("Error: Blob part is null in this.extraZipPartsMap for index "+i);t+=r.size,e[i]=t}for(var s=this.zipEntryTree.originalEntries,n=0;n<s.length;n++)s[n].offset+=e[s[n].diskNumberStart];this.extraZipPartsMap={},this.numExtraZipParts=0,this.zipPartsLoadedMask=[]}},ze.App.prototype.areAdditionalZipPartsRequired=function(){for(var e=1;e<=this.numExtraZipParts;e++){if(!this.extraZipPartsMap["zipPart-"+e])return!0}return!1},ze.App.prototype.getAdditionalZipPartsRequiredExtensionString=function(){for(var e="",t=1;t<=this.numExtraZipParts;t++){this.extraZipPartsMap["zipPart-"+t]||(e+=t<=9?".z0"+t:".z"+t,t<this.numExtraZipParts&&(e+=", "))}return e=e.trim(),ze.App.endsWith(e,",")&&(e=e.substring(0,e.length-1)),e},ze.App.prototype.addZipPartFilesToMapAndCreateMaskIndex=function(e,t){this.zipPartsLoadedMask=new Array(this.numExtraZipParts);for(var i="zipPart-",r=0;r<e.length;r++){var s,n=e[r];!ze.App.filePrefixesMatch(n.name,t)||null!=(s=ze.App.translateZipPartFilenameToIndex(n.name))&&""!==s&&(this.extraZipPartsMap[i+s]=n)}var o=i.length;for(var p in this.extraZipPartsMap){var a=ze.App.stringSuffixAt(p,o),l=parseInt(a);this.zipPartsLoadedMask[l-1]=!0}},ze.App.filePrefixesMatch=function(e,t){var i=ze.App.getBaseFilenameNoExtension(e);return null!=i&&i==ze.App.getBaseFilenameNoExtension(t)},ze.App.translateZipPartFilenameToIndex=function(e){var t=ze.App.getFileExtension(e.toLowerCase());if(!ze.App.startsWith(t,"z"))return null;var i=ze.App.stringSuffixAt(t,1);try{var r=parseInt(i);return isNaN(r)?null:r}catch(e){return null}},ze.App.prototype.getConsolidatedZipBlobFromZipPartsMap=function(e){if(!e)throw new Error("Expected non-null blob part for finalMainZipBlob");for(var t=[],i=1;i<=this.numExtraZipParts;i++){var r=this.extraZipPartsMap["zipPart-"+i];if(!r)throw new Error("Expected non-null blob part for index: "+i);t.push(r)}return t.push(e),new Blob(t)},ze.App.prototype.setReadyToExtract=function(e,t){this.setAppState(ze.App.APP_STATE.READY_TO_EXTRACT,e,t),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPRENDER]=!0,logImpression("ready_to_extract",this.currentArchiveTypeString.toLowerCase(),"correctPassword: "+!!e)},ze.App.prototype.maybeShowZipFileCommentOrEncryptedState=function(){var e,t,i=this.zipEntryTree.zipFileComment&&!ze.App.startsWith(this.zipEntryTree.zipFileComment,"Created by ZIP Extractor")?"<b>ZIP Comment:</b> "+ze.App.htmlEscape(this.zipEntryTree.zipFileComment):"";this.zipEntryTree.empty&&(e="This "+this.currentArchiveTypeString+" file does not ",this.isInZipEditMode?e+="yet contain any files. Click a button above to add files":e+="contain any files",i=i?i+"<br>"+e:e),this.zipEntryTree.isEncrypted&&this.wasZipFileCreatedLocally&&(t="This "+this.currentArchiveTypeString+" file is encrypted with a password",this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_WINZIPAES?t+=" using strong encryption":t+="",i=i?i+"<br>"+t:t),i?(this.fileTableSubHeaderLabel.innerHTML=i,this.showEl(this.fileTableSubHeader,!0)):(this.fileTableSubHeaderLabel.textContent="",this.showEl(this.fileTableSubHeader,!1))},ze.App.prototype.checkPassword=function(){var e;this.wasCheckPasswordCancelled=!1,this.currentArchiveHeaderIsEncrypted?this.readArchive(this.zipFilename,this.zipFileSize,this.zipMimeType,this.zipBlob,void 0,void 0,this.getZipPasswordCharCodeByteArray()):(e=this.zipEntryTree.passwordCheckEntry)?(logImpression("check_password","pwd_flow","begin_decompress"),ze.App.decompressArchiveEntry(this.zipBlob,e,!0,bindFn(this.checkPasswordSuccess,this,e),bindFn(this.checkPasswordError,this,e),bindFn(this.archiveReadProgress,this),bindFn(this.generalDecompressionCheckCancelFn,this),this.getZipPasswordCharCodeByteArray(),!0)):this.checkPasswordError(null,"no check entry available")},ze.App.prototype.checkPasswordSuccess=function(e){logImpression("check_password","pwd_flow","success"),this.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED)},ze.App.prototype.checkPasswordError=function(e,t,i){console.log(t),i?(logImpression("check_password_canceled","pwd_flow"),this.setAppState(ze.App.APP_STATE.CHECK_PASSWORD_CANCELLED)):(logImpression("check_password","pwd_flow","error: "+t),this.setAppState(ze.App.APP_STATE.PASSWORD_INCORRECT,!0))},ze.App.prototype.doExtract=function(e){logImpression("extract_"+this.currentArchiveTypeString.toLowerCase(),this.currentArchiveTypeString.toLowerCase(),"is_for_auto_retry="+e),this.sessionPropMap[ze.App.SESS_PROP.DIDEXTRACTZIP]=!0,this.setAppState(ze.App.APP_STATE.EXTRACTING),this.executeSession(e)},ze.App.prototype.handleExtractionComplete=function(e){var t,i,r=this.currentArchiveTypeString.toLowerCase();logImpression(r+"_extracted",r),this.zipEntryTree&&this.zipEntryTree.isEncrypted&&logImpression("encrypted_"+r+"_extraction_complete","crypto"),e?this.setAppState(ze.App.APP_STATE.EXTRACTION_CANCELED):(t=0<this.getNumFilesWithUploadErrors())&&!this.sessionHasBeenRetried?(this.parentFolderId=null,this.queueEntry(this.zipEntryTree),this.queueEntryChildren(this.zipEntryTree),this.doExtract(!0)):(i=t?ze.App.APP_STATE.COMPLETE_WITH_ERRORS:ze.App.APP_STATE.EXTRACTION_COMPLETE,this.setAppState(i))},ze.App.prototype.getNewParentId=function(){return this.zipEntryTree?this.zipEntryTree.driveFileId:null},ze.App.prototype.buildEntryTree=function(e,t,i,r){this.setAppState(ze.App.APP_STATE.MODEL_BUILDING),this.buildEntryTreeInternal(e,i,r),t(),console.log("---\x3e AFTER callbackFn() in buildEntryTree.")},ze.App.prototype.buildEntryTreeInternal=function(e,t,i){if(this.zipEntryTree)throw new Error("Existing ZIP Entry Tree must be cleared before being built (log: "+this.appStateLog+")");this.numExtraZipParts=i||0;var r=ze.App.getFolderName(this.zipFilename);this.zipEntryTree={directory:!0,root:!0,name:r,path:r,children:{},state:ze.App.APP_STATE.DEFAULT,passwordCheckEntry:null,originalEntries:e},t&&(this.zipEntryTree.zipFileComment=t),null==e?(logImpression("error_null_entries",this.currentArchiveTypeString.toLowerCase()),e=[],this.zipEntryTree.empty=!0):0==e.length&&(this.zipEntryTree.empty=!0);for(var s=Number.MAX_SAFE_INTEGER,n=0;n<e.length;n++){var o=e[n];o.isEncrypted&&(this.zipEntryTree.isEncrypted=!0,this.zipEntryTree.encryptionMode=o.encryptionMode),o.isZip64&&(this.zipEntryTree.isZip64=!0),o.filenameHasExtendedChar&&(this.zipEntryTree.filenameHasExtendedChar=!0),!o.directory&&0<o.compressedSize&&null!=o.encryptionMode&&""!=o.encryptionMode&&o.encryptionMode!=ze.App.ENCRYPTION_MODE_NONE&&o.encryptionMode!=ze.App.ENCRYPTION_MODE_UNKNOWN&&o.compressedSize<s&&(s=o.compressedSize,this.zipEntryTree.passwordCheckEntry=o),this.insertZipEntry(this.zipEntryTree,o)}},ze.App.prototype.insertZipEntry=function(e,t){var i=t.filename||"";t.error&&(i&&(i+=" "),i+="ERROR ["+ ++this.errorCounter+"]: "+ze.App.htmlEscape(t.error).replace("/","--")),ze.App.endsWith(i,"/")&&(i=i.substring(0,i.length-1));for(var r=i.split("/"),s=e,n=null,o=0;o<r.length;o++){var p=r[o],n=null===n?p:n+"/"+p,a=s.children[p];a||(o<r.length-1||t.directory?(a={directory:!0,children:{}},t.zipTreeEntry=a):a=t,a.state=ze.App.ESTATE.DEFAULT,a.path=n,a.name=p,(a.parentEntry=s).children[p]=a),s=a}},ze.App.prototype.addDocumentReferences=function(){for(var e=0;e<ze.App.DOCUMENT_REFERENCES.length;e++)this[ze.App.DOCUMENT_REFERENCES[e]]=document.getElementById(ze.App.DOCUMENT_REFERENCES[e])},ze.App.prototype.addEventListeners=function(){this.addButtonListeners(),this.openLocalZipFileInputEl.onchange=bindFn(this.handleOpenLocalZipFileInputElChange,this),this.addLocalFileInputEl.onchange=bindFn(this.handleAddLocalFileInputElChange,this),this.addLocalFolderInputEl.onchange=bindFn(this.handleAddLocalFolderInputElChange,this),this.openLocalZipPartFileInputEl.onchange=bindFn(this.handleOpenLocalZipPartFileInputElChange,this),this.selectAllCheckbox.onclick=bindFn(this.handleSelectAllCheckboxClick,this),this.encryptionPromptCheckbox.onclick=bindFn(this.handleEncryptionPromptCheckboxClick,this),this.encryptionPromptText.onclick=bindFn(this.handleEncryptionPromptCheckboxClick,this),this.previewCloseButton.onclick=bindFn(this.handlePreviewCloseButtonClick,this),this.previewDownloadButton.onclick=bindFn(this.handlePreviewDownloadButtonClick,this),this.previewOpenInDriveButton.onclick=bindFn(this.handlePreviewOpenInDriveButtonClick,this),this.previewSaveToDriveButton.onclick=bindFn(this.handlePreviewSaveToDriveButtonClick,this),this.previewPrevButton.onclick=bindFn(this.handlePreviewPrevButtonClick,this),this.previewNextButton.onclick=bindFn(this.handlePreviewNextButtonClick,this),this.secondaryLabelLink.onclick=bindFn(this.handleSecondaryLabelLinkClick,this),this.profileImageImg.onclick=bindFn(this.handleProfileImageImgClick,this),document.addEventListener("keydown",bindFn(this.handleBodyKeydown,this)),this.zipPasswordInput.addEventListener("keydown",bindFn(this.handleZipPasswordKeyDown,this)),this.zipFilenameInput.addEventListener("keydown",bindFn(this.handleZipFilenameKeyDown,this)),this.zipPasswordInput.addEventListener("input",bindFn(this.handleZipFilenameInputChange,this)),window.addEventListener("beforeunload",bindFn(this.handleBeforeUnload,this)),this.zipFilenameInput.addEventListener("focus",function(){this.select()}),this.zipFilenameInput.addEventListener("blur",bindFn(this.handleZipFilenameInputBlur,this)),this.mainScrollableContent.ondragenter=bindFn(this.handleZipDropAreaDragEnter,this),this.mainScrollableContent.ondragleave=bindFn(this.handleZipDropAreaDragLeave,this),this.mainScrollableContent.ondragover=bindFn(this.handleZipDropAreaDragOver,this),this.mainScrollableContent.ondrop=bindFn(this.handleZipDropAreaDrop,this);var t="zipDropArea";window.addEventListener("dragenter",function(e){e.target.id!=t&&(e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")},!1),window.addEventListener("dragleave",function(e){e.target.id!=t&&(e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")},!1),window.addEventListener("dragover",function(e){e.target.id!=t&&(e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")}),window.addEventListener("drop",function(e){e.preventDefault(),e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none"})},ze.App.prototype.handleProfileImageImgClick=function(){this.switchAccount()},ze.App.prototype.isGapiLibraryLoaded=function(){return"gapi"in window},ze.App.prototype.switchAccount=function(){var t;isFirstAuthPending()||(logImpression("switch_account","auth","start. currentAuthUser="+CURRENT_AUTH_USER),this.isGapiLibraryLoaded()&&gapi.auth2?((t=this).setAuthText("Choose the Google account you would like to use with ZIP Extractor."),authorize(!1,function(){logImpression("switch_account","auth","success. currentAuthUser="+CURRENT_AUTH_USER),t.setAuthText("Signed in as "+getUserEmail()),t.updateUserInfoUi()},function(e){logImpression("switch_account","auth","error: "+e),"idpiframe_initialization_failed"==e?(t.setAuthText("Cookies are not enabled, but are required in order to authorize with a Google account"),t.showEnableCookiesInfoPage()):t.setAuthText("")},void 0,void 0,!0,"switchAccount")):logImpression("switch_account","auth","error: gapi_auth2_not_loaded"))},ze.App.prototype.showEnableCookiesInfoPage=function(){window.console.log("Showing Enable Cookies info."),logImpression("show_enable_cookies_info_text","misc"),this.enableCookiesImg1.src=this.enableCookiesImg1.dataset.src,this.enableCookiesImg2.src=this.enableCookiesImg2.dataset.src,this.enableCookiesImg3.src=this.enableCookiesImg3.dataset.src,this.showEl(this.mainScrollableContent,!1),this.showEl(this.enableCookiesContent,!0),revertUrlState()},ze.App.prototype.handleBeforeUnload=function(e){this.sendFinalSessionState();var t=this.appState==ze.App.APP_STATE.CHECKING_PASSWORD;if(!this.areAllStatesTerminal()||this.isSavingToDrive||this.isPreviewDecompressing||this.isCurrentlyInJumpToZipOperation||t){var i="ZIP Extraction is still in process. Are you sure you want to leave?";return e.returnValue=i}},ze.App.prototype.sendFinalSessionState=function(){var e,t="session_state2";for(var i in logImpression("final_state_recorded",t,!0,void 0,void 0,!0),logImpression(this.appStateLog,"app_state_log",void 0,void 0,void 0,!0),logImpression("recorded","final_app_state",!0,void 0,void 0,!0),logImpression(this.appState,"final_app_state",void 0,void 0,void 0,!0),ze.App.SESS_PROP){!ze.App.SESS_PROP.hasOwnProperty(i)||null!=(e=this.sessionPropMap[ze.App.SESS_PROP[i]])&&logImpression(ze.App.SESS_PROP[i],t,e,void 0,void 0,!0)}},ze.App.prototype.handleZipFilenameInputBlur=function(e){var t;""==this.zipFilenameInput.value?this.zipFilenameInput.value=ze.App.DEFAULT_ZIP_FILENAME:this.zipFilenameInput.value=this.zipFilenameInput.value.trim(),ze.App.endsWith(this.zipFilenameInput.value.toLowerCase(),".zip")||(this.zipFilenameInput.value+=".zip"),this.zipFilename=this.zipFilenameInput.value,this.fileTableHeaderLabel.textContent=this.zipFilenameInput.value,ze.App.updatePageTitle(this.zipFilename),this.zipEntryTree&&(t=ze.App.getFolderName(this.zipFilename),this.zipEntryTree.name=t,this.zipEntryTree.path=t)},ze.App.prototype.handleZipPasswordKeyDown=function(e){return"Escape"===e.key||"Esc"===e.key?""==this.zipPasswordInput.value?void 0:(e.stopPropagation(),e.preventDefault(),this.zipPasswordInput.value="",this.zipPasswordInput.focus(),!1):"Enter"===e.key?(e.stopPropagation(),e.preventDefault(),this.isElementShown(this.zipPasswordInputContainer)&&(this.isElementShown(this.setPasswordButton)&&this.isElementEnabled(this.setPasswordButton)?this.setPasswordButton.click():this.isElementShown(this.checkPasswordButton)&&this.isElementEnabled(this.checkPasswordButton)&&this.checkPasswordButton.click()),!1):void 0},ze.App.prototype.handleZipFilenameInputChange=function(e){this.isElementShown(this.zipPasswordInputContainer)&&(this.isElementShown(this.setPasswordButton)?this.enableEl(this.setPasswordButton,0<this.zipPasswordInput.value.length):this.isElementShown(this.checkPasswordButton)&&this.enableEl(this.checkPasswordButton,0<this.zipPasswordInput.value.length))},ze.App.prototype.handleZipFilenameKeyDown=function(e){return"Escape"===e.key||"Esc"===e.key?(e.stopPropagation(),e.preventDefault(),""!=this.zipFilenameInput.value?this.zipFilenameInput.value="":(this.zipFilenameInput.value=this.zipFilename||"",this.zipFilenameInput.blur()),!1):"Enter"===e.key?(e.stopPropagation(),e.preventDefault(),this.zipFilenameInput.blur(),!1):void 0},ze.App.prototype.handleBodyKeydown=function(e){"Escape"===e.key||"Esc"===e.key?this.isPreviewShown()?(e.preventDefault(),this.isElementShown(this.previewCancelButton)&&this.isElementEnabled(this.previewCancelButton)?this.handleCancelPreview():this.closePreview()):this.appState==ze.App.APP_STATE.ADDING_FILES_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED?(e.preventDefault(),this.addFilesToZipOrEncryptZipCancelRequested=!0,this.enableEl(this.cancelButton,!1)):this.isElementShown(this.zipPasswordInputContainer)&&this.isElementShown(this.setPasswordButton)?this.handleCancelAddPasswordToZip():this.isInZipEditMode?(e.preventDefault(),this.closeZipEditMode(),this.zipEntryTree&&this.zipEntryTree.originalEntries&&0==this.zipEntryTree.originalEntries.length&&this.canCloseSession()&&(e.preventDefault(),this.closeSession(),this.mainScrollableContent.scrollTop=0)):this.canCancel()?(e.preventDefault(),this.handleButtonClick("cancelButton")):this.canCloseSession()&&(logImpression("close","user_button"),e.preventDefault(),this.closeSession(),this.mainScrollableContent.scrollTop=0):"ArrowUp"===e.key||"Up"===e.key||"ArrowLeft"===e.key||"Left"===e.key?this.isPreviewShown()&&(e.preventDefault(),this.isElementShown(this.previewPrevButton)&&this.isElementEnabled(this.previewPrevButton)&&this.handlePreviewPrevButtonClick()):"ArrowDown"===e.key||"Down"===e.key||"ArrowRight"===e.key||"Right"===e.key?this.isPreviewShown()&&(e.preventDefault(),this.isElementShown(this.previewNextButton)&&this.isElementEnabled(this.previewNextButton)&&this.handlePreviewNextButtonClick()):"Enter"===e.key&&(this.isPreviewShown()&&this.isElementShown(this.previewDownloadButton)&&this.isElementEnabled(this.previewDownloadButton)&&!this.isElementShown(this.previewErrorContent)?(e.preventDefault(),this.handlePreviewDownloadButtonClick()):this.canRetry())},ze.App.prototype.addButtonListeners=function(){for(var e=0;e<ze.App.DOCUMENT_REFERENCES.length;e++){var t=ze.App.DOCUMENT_REFERENCES[e];t&&ze.App.endsWith(t,"Button")&&(this[t].onclick=bindFn(this.handleButtonClick,this,t))}},ze.App.prototype.showEl=function(e,t){e.hidden=!t},ze.App.prototype.enableEl=function(e,t){e.disabled=!t},ze.App.prototype.isElementShown=function(e){return!e.hidden},ze.App.prototype.isElementEnabled=function(e){return!e.disabled},ze.App.prototype.handleButtonClick=function(e){switch(e){case"checkPasswordButton":if(0==this.zipPasswordInput.value.length)return this.zipPasswordInput.select(),void this.zipPasswordInput.focus();logImpression("check_password","pwd_flow"),this.setAppState(ze.App.APP_STATE.CHECKING_PASSWORD),this.checkPassword();break;case"authButton":logImpression("manual_authorize_button","user_button"),this.initiateManualAuth();break;case"addFilesFromComputerButton":logImpression("add_files_from_computer","user_button"),this.addLocalFileInputEl.click();break;case"addFolderButton":logImpression("add_folder_button","user_button"),this.addLocalFolderInputEl.click();break;case"addFilesToZipFromDriveButton":!isAuthorized()||isTokenExpired()?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),this.setResumeFlags(!1,!1,!1,!1,!1,!0),this.initiateManualAuth()):this.addFilesToZipFromDrive();break;case"downloadZipButton":var t=this.zipEntryTree?this.zipEntryTree.encryptionMode:"null zipEntryTree";logImpression("download_zip","create_zip","encryptionMode: "+t),this.downloadBlobToBrowser(this.zipFilename,new Blob([this.zipBlob],{type:"application/zip"}));break;case"saveZipToDriveButton":this.saveZipToDrive();break;case"openZipInDriveButton":null!=this.createdZipSavedToDriveId&&ze.App.openItemInDrive(this.createdZipSavedToDriveId);break;case"editZipButton":this.configureUiForZipEditMode();break;case"doneEditingZipButton":this.closeZipEditMode();break;case"fixEncodingButton":this.fixEncoding();break;case"extractButton":!isAuthorized()||isTokenExpired()?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),this.setResumeFlags(!1,!0,!1,!1,!1,!1),this.initiateManualAuth()):(this.sessionHasBeenRetried=!1,this.doExtract(!1));break;case"viewFilesButton":logImpression("view_files","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDVIEWFILES]=!0;var i=ze.App.createDriveFolderLink(this.getNewParentId()),r=window.open(i,"_blank");r&&r.focus&&r.focus();break;case"sendFeedbackButton":logImpression("send_feedback","user_button"),this.sendFeedbackEmail();break;case"rateAppButton":logImpression("rate_app","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRATEAPP]=!0;var s="https://gsuite.google.com/marketplace/app/zip_extractor/824911851129?authuser="+CURRENT_AUTH_USER,n=window.open(s,"_blank");n&&n.focus&&n.focus();break;case"previewCancelButton":this.handleCancelPreview();break;case"cancelButton":this.appState==ze.App.APP_STATE.EXTRACTING?(logImpression("cancel_extraction","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDCANCELEXTRACTION]=!0,this.setAppState(ze.App.APP_STATE.EXTRACTION_CANCEL_REQUESTED),this.abortSession()):this.appState==ze.App.APP_STATE.DOWNLOADING||this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA?(logImpression("cancel_download","user_button","app_state: "+this.appState),this.sessionPropMap[ze.App.SESS_PROP.DIDCANCELDOWNLOAD]=!0,this.setAppState(ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED),ze.Dapi.abortDownload()):this.appState==ze.App.APP_STATE.ADDING_FILES_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP||this.appState==ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED?(this.addFilesToZipOrEncryptZipCancelRequested=!0,this.enableEl(this.cancelButton,!1),this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED||ze.Dapi.abortDownload()):this.appState==ze.App.APP_STATE.CHECKING_PASSWORD?(this.enableEl(this.cancelButton,!1),this.wasCheckPasswordCancelled=!0):this.isSavingToDrive?(this.enableEl(this.cancelButton,!1),this.wasSaveToDriveCancelled=!0,ze.Dapi.abortAllRequests()):!this.isCurrentlyInJumpToZipOperation&&this.appState!=ze.App.APP_STATE.ZIP_READING||(this.enableEl(this.cancelButton,!1),this.wasArchiveDecompressionProcessCancelled=!0);break;case"closeButton":logImpression("close","user_button"),this.isElementShown(this.zipPasswordInputContainer)&&this.isElementShown(this.setPasswordButton)?this.handleCancelAddPasswordToZip():(this.closeSession(),this.mainScrollableContent.scrollTop=0);break;case"retryButton":this.appState==ze.App.APP_STATE.COMPLETE_WITH_ERRORS?(logImpression("retry_errors","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYEXTRACTION]=!0,this.sessionHasBeenRetried=!1,this.doExtract(!1)):this.appState==ze.App.APP_STATE.EXTRACTION_CANCELED?(logImpression("retry_after_extraction_canceled","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYEXTRACTION]=!0,this.sessionHasBeenRetried=!1,this.doExtract(!1)):this.appState==ze.App.APP_STATE.DOWNLOAD_ERROR||this.appState==ze.App.APP_STATE.DOWNLOAD_CANCELED?(logImpression("retry_download","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYDOWNLOAD]=!0,this.hasDownloadBeenAutoRetried=!1,this.downloadFileById(this.lastDownloadId)):this.appState==ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH?(logImpression("retry_download_after_manual_auth","user_button"),this.initiateManualAuth(!0)):this.appState==ze.App.APP_STATE.AUTH_MISMATCH||this.appState==ze.App.APP_STATE.AUTH_ERROR?this.initiateManualAuth(!0):this.appState==ze.App.APP_STATE.ZIP_READ_CANCELLED&&this.readArchive(this.zipFilename,this.zipFileSize,this.zipMimeType,this.zipBlob,void 0,void 0);break;case"openZipFromDriveButton":logImpression("open_zip_from_drive","user_button","is_authorized="+isAuthorized()),!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!0,!1,!1,!1,!1,!1),this.initiateManualAuth()):ze.App.showPicker(bindFn(this.handlePickerZipFileSelected,this));break;case"openZipFromComputerButton":logImpression("open_zip_from_computer","user_button","is_authorized="+isAuthorized()),this.openLocalZipFileInputEl.click();break;case"createNewZipButton":logImpression("create_new_zip","user_button","is_authorized="+isAuthorized()),logImpression("create_new_zip_button_press","create_new_zip"),this.doCreateNewZip();break;case"addZipPartFromDriveButton":logImpression("add_zip_part_from_drive","user_button");var o=ze.App.getBaseFilenameNoExtension(this.zipFilename);this.handleAddZipPartsFromDrive(o);break;case"addZipPartFromComputerButton":logImpression("add_zip_part_from_computer","user_button"),this.openLocalZipPartFileInputEl.click();break;case"addPasswordButton":var p=this.zipEntryTree&&this.zipEntryTree.originalEntries?this.zipEntryTree.originalEntries.length:-1;logImpression("add_password_button","encrypt_zip","entryCount: "+p),this.handleAddPasswordToZip();break;case"setPasswordButton":this.hideZipPasswordChars();var a=ze.App.isCheckboxIconButtonChecked(this.encryptionPromptCheckbox);logImpression("set_password_button","encrypt_zip","useAes: "+a),this.encryptZip(a);break;case"showZipPasswordButton":this.showZipPasswordChars();break;case"hideZipPasswordButton":this.hideZipPasswordChars()}},ze.App.prototype.showZipPasswordChars=function(){this.zipPasswordInput.type="text",this.showEl(this.hideZipPasswordButton,!0),this.showEl(this.showZipPasswordButton,!1)},ze.App.prototype.hideZipPasswordChars=function(){this.zipPasswordInput.type="password",this.showEl(this.hideZipPasswordButton,!1),this.showEl(this.showZipPasswordButton,!0)},ze.App.prototype.doCreateNewZip=function(e){this.isInZipEditMode=!0,this.createNewEmptyZip(void 0,e)},ze.App.prototype.canCancel=function(){return this.isElementShown(this.cancelButton)&&this.isElementEnabled(this.cancelButton)},ze.App.prototype.canRetry=function(){return this.isElementShown(this.retryButton)&&this.isElementEnabled(this.retryButton)},ze.App.prototype.canCloseSession=function(){return this.isElementShown(this.closeButton)},ze.App.prototype.configureUiForZipEditMode=function(e,t,i){this.isInZipEditMode=!0,this.setAppState(ze.App.APP_STATE.EDIT_ZIP,e,t,i),this.refreshZipEntryTreeIconsFromCurrentState(!1,!0)},ze.App.prototype.closeZipEditMode=function(){this.isInZipEditMode=!1,this.setAppState(ze.App.APP_STATE.READY_TO_EXTRACT,void 0,this.wasZipFileCreatedLocally),this.refreshZipEntryTreeIconsFromCurrentState(!1,!1)},ze.App.prototype.handleCancelPreview=function(){logImpression("preview_cancel","user_button","isPreviewDecompressing: "+this.isPreviewDecompressing),this.enableEl(this.previewCancelButton,!1),this.isSavingToDrive&&(this.wasSaveToDriveCancelled=!0,ze.Dapi.abortAllRequests()),this.isPreviewDecompressing&&(this.wasPreviewDecompressionCancelled=!0)},ze.App.prototype.updateViewFromAppState=function(e,t,i,r){if(this.isInitialized)switch(this.appState){case ze.App.APP_STATE.API_LOADED:break;case ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP:var s="phone"==detectDevice()?"Add password":"Add password to ZIP file";this.updateLabelsAndProgress(s,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SECURITY),this.showEl(this.secondaryLabelLinkCombo,!1),ze.App.setCheckboxIconButtonChecked(this.encryptionPromptCheckbox,!1),this.enableEl(this.zipPasswordInput,!0),this.showEl(this.zipPasswordInputContainer,!0),this.showEl(this.setPasswordButton,!0),this.hideZipPasswordChars(),this.enableEl(this.setPasswordButton,!1),this.showEl(this.encryptionPrompt,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0);break;case ze.App.APP_STATE.ENCRYPTING_ZIP:var n="phone"==detectDevice()?"Encrypting ZIP file...":"Encrypting ZIP file with password...";this.updateLabelsAndProgress(n,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.showEl(this.addPasswordButton,!1),this.showEl(this.setPasswordButton,!1),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.zipPasswordInputContainer,!1),this.showEl(this.encryptionPrompt,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!0);break;case ze.App.APP_STATE.MULTI_PART_ZIP:this.showOrHideOpenZipPartButtons(!0),this.showEl(this.extractButton,!1),this.updateLabelsAndProgress("Multi-part ZIP file detected; please add additional ZIP parts","ZIP parts required: "+e),this.showEl(this.closeButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING);break;case ze.App.APP_STATE.DOWNLOADING_MULTIPLE_METADATA:this.updateLabelsAndProgress("Adding additional files to ZIP...","Reading file data from Google Drive...");break;case ze.App.APP_STATE.ADDING_FILES_TO_ZIP:var o=!!e,p=o?"folder":"files";o&&t&&(p+=' "'+t+'"'),this.updateLabelsAndProgress("Adding "+p+" to ZIP...","Preparing files..."),this.setProgressBarPercent(0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.openZipInDriveButton,!1);break;case ze.App.APP_STATE.ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE:var a=e?"Password set":this.getFilesChangedStatusString(t,i,r);null==a&&(a="Files added to ZIP"),this.updateLabelsAndProgress(a,"",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.addFilesButtonContainer,!0);break;case ze.App.APP_STATE.FILES_ADDED_TO_ZIP:var l=e,h=t;this.zipEntryTree=null,ze.App.clearTable(this.fileTableItems),this.readArchive(this.zipFilename,l.size,ze.App.CANONICAL_MIME_TYPES.ZIP,l,void 0,h);break;case ze.App.APP_STATE.ZIP_CREATION_ERROR:this.updateLabelsAndProgress("Error when adding to ZIP",e,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR),this.maybeShowAddPasswordButton(),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.downloadZipButton,!0);break;case ze.App.APP_STATE.ZIP_CREATION_CANCELLED:this.updateLabelsAndProgress("Adding to ZIP was canceled","",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.enableEl(this.cancelButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.downloadZipButton,!0);break;case ze.App.APP_STATE.ZIP_ENCRYPTION_ERROR:this.updateLabelsAndProgress("Error when adding password to ZIP",e,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR);break;case ze.App.APP_STATE.ZIP_ENCRYPTION_CANCELLED:this.updateLabelsAndProgress("Adding password to ZIP was canceled","",100);break;case ze.App.APP_STATE.EDIT_ZIP:var d=this.getFilesChangedStatusString(e,t,i);null==d&&(d=0==(this.zipEntryTree&&this.zipEntryTree.originalEntries?this.zipEntryTree.originalEntries.length:0)?"Creating new ZIP file":"Editing ZIP"),this.updateLabelsAndProgress(d,"",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO);var E=null!=this.createdZipSavedToDriveId;this.showEl(this.saveZipToDriveButton,!E),this.showEl(this.openZipInDriveButton,E),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.closeButton,!0),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.showEl(this.downloadZipButton,!0),this.showEl(this.extractButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.closeButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.zipFilenameInputContainer,!0),this.showEl(this.fileTableHeaderLabel,!1),""==this.zipFilenameInput.value&&(this.zipFilename=this.zipFilenameInput.value,this.zipFilenameInput.focus());break;case ze.App.APP_STATE.PASSWORD_REQUIRED:var A=e,c="This "+this.currentArchiveTypeString+" file requires a password";"phone"!=detectDevice()&&(c+=" to open"),this.updateLabelsAndProgress(c,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SECURITY),this.showPasswordPrompt(),this.showEl(this.closeButton,!0),this.hideZipPasswordChars(),this.enableEl(this.checkPasswordButton,!1),this.enableEl(this.zipPasswordInput,!0),A&&(this.fileTableSubHeaderLabel.textContent="File names in this "+this.currentArchiveTypeString+" file are encrypted and will be shown once a correct password is provided",this.showEl(this.fileTableSubHeader,!0));break;case ze.App.APP_STATE.PASSWORD_INCORRECT:this.updateLabelsAndProgress("Incorrect password. Please try again",void 0,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showPasswordPrompt(),this.showEl(this.closeButton,!0),this.zipPasswordInput.select(),this.zipPasswordInput.focus(),this.flashElement(this.zipPasswordInput,"#d00000",2,100),this.enableEl(this.checkPasswordButton,!0),this.enableEl(this.zipPasswordInput,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0);break;case ze.App.APP_STATE.CHECK_PASSWORD_CANCELLED:this.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED),this.enableEl(this.checkPasswordButton,!0),this.enableEl(this.zipPasswordInput,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.closeButton,!0);break;case ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED:this.updateLabelsAndProgress("Unsupported ZIP password format","ZIP Extractor can't open this password-protected ZIP format yet. Extraction cannot proceed"),this.showEl(this.closeButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING);break;case ze.App.APP_STATE.PASSWORD_VERIFIED:this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.checkPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0),this.setReadyToExtract(!0),this.refreshZipEntryTreeItemState(void 0,!0);break;case ze.App.APP_STATE.AUTH_PENDING_AUTO:break;case ze.App.APP_STATE.AUTH_PENDING_USER:this.setAuthText('Authorization is pending your approval. Click "Allow" in the popup window to use ZIP Extractor.');break;case ze.App.APP_STATE.AUTH_MISMATCH:var u="The account you authorized ("+getUserEmail()+") does not match the account you used to open the file. Please try again.";this.setAuthText(u),this.updateUiForDownloadError(u,!0);break;case ze.App.APP_STATE.AUTH_ERROR:var T=!1,z="";"popup_closed_by_user"==e?z="You closed the popup window before completing authorization. Please try again.":("idpiframe_initialization_failed"==e?(z="There was a problem showing the authorization screen; please try again.",T=!0):"popup_blocked_by_browser"==e?z="Your web browser blocked the Google authorization popup window. Please enable popups.":"access_denied"==e?(z="You chose not grant access to ZIP Extractor. You may try again with the button above.",t=""):z="General authorization error; please try again.",t&&(z+=" (Details: "+t+")")),this.setAuthText(z),this.doResumeOpenFromDriveAfterManualAuth?this.doResumeOpenFromDriveAfterManualAuth=!1:this.doResumeExtractToDriveAfterManualAuth?(this.doResumeExtractToDriveAfterManualAuth=!1,this.enableEl(this.extractButton,!0)):this.doResumeSavePreviewItemToDriveAfterManualAuth?(this.doResumeSavePreviewItemToDriveAfterManualAuth=!1,this.enableEl(this.previewSaveToDriveButton,!0)):this.doResumeSaveZipToDriveAfterManualAuth?(this.doResumeSaveZipToDriveAfterManualAuth=!1,this.enableEl(this.saveZipToDriveButton,!0)):this.doResumeChooseFolderLocationAfterManualAuth?this.doResumeChooseFolderLocationAfterManualAuth=!1:this.doResumeAddFilesToZipFromDriveAfterManualAuth?(this.doResumeAddFilesToZipFromDriveAfterManualAuth=!1,this.enableEl(this.addFilesToZipFromDriveButton,!0)):(this.showEl(this.authButton,!0),this.showEl(this.authButtonDetails,!0)),T&&this.showEnableCookiesInfoPage();break;case ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED:this.enableEl(this.cancelButton,!1);break;case ze.App.APP_STATE.DOWNLOAD_CANCELED:this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.retryButton,!0),this.showEl(this.closeButton,!0),this.updateLabelsAndProgress("Opening canceled","Click Retry to open this file again"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.setProgressBarPercent(100);break;case ze.App.APP_STATE.DOWNLOADING_METADATA:this.showEl(this.buttonContainer,!0);this.updateDownloadingFilename(""),this.showEl(this.selectAllCheckbox,!1),this.showEl(this.rootStatusSpinner,!0),this.showEl(this.rootStatusIconContainer,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.retryButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.editZipButton,!1),this.updateLabelsAndProgress("Checking file in Google Drive...","This may take a few moments"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED:case ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP:this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);var _=e?'Downloading: "'+e+'"':"Downloading file data...";null!=t&&0!==t&&(_+=" ("+ze.App.formatSize(t)+")"),this.updateLabelsAndProgress("Adding files to ZIP...",_);break;case ze.App.APP_STATE.DOWNLOADING:e&&(this.updateDownloadingFilename(e,t),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="cloud_download",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0));break;case ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED:break;case ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED:this.updateLabelsAndProgress("Opening file from Google Drive..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.DOWNLOADED:this.showEl(this.cancelButton,!1),this.updateLabelsAndProgress("File downloaded",null,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO);break;case ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP:this.showEl(this.cancelButton,!1);break;case ze.App.APP_STATE.DOWNLOAD_ERROR:this.updateUiForDownloadError(e);break;case ze.App.APP_STATE.DOWNLOAD_ERROR_DUE_TO_AUTH:this.updateUiForDownloadError(e,!0);break;case ze.App.APP_STATE.INIT:break;case ze.App.APP_STATE.ZIP_READ_CANCELLED:this.updateLabelsAndProgress("Opening canceled","Click Retry to open this file again",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showEl(this.closeButton,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.enableEl(this.retryButton,!0),this.showEl(this.retryButton,!0);break;case ze.App.APP_STATE.MODULE_LOAD_ERROR:case ze.App.APP_STATE.ZIP_READ_ERROR:console.trace();var P=e;P&&console.log(P.stack);var S,I=e,D=t,R=i,m=r;I&&I.target&&I.target.toString&&(I=(S=I.target.toString())&&-1!=S.indexOf("Worker")?"ZIP Worker Error":I&&"error"==I.type&&I.target&&I.target.src?"Target source: "+I.target.src:S);var v=null,v=this.appState==ze.App.APP_STATE.MODULE_LOAD_ERROR?"Error Loading Code Module":"Error reading "+this.currentArchiveTypeString+" file",y=ze.App.getStackInfoFromErrorObj(P);y&&(I+=" ("+y+")"),this.updateLabelsAndProgress(v,"Error details: "+I),this.showEl(this.buttonContainer,!0),this.showEl(this.closeButton,!0),this.showEl(this.cancelButton,!1),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.setProgressBarPercent(100),this.showEl(this.sendFeedbackButton,!0),ze.App.maybeReportTestError(I),D&&this.maybeDisplayAlternateViewOfMistypedZip(m,R);break;case ze.App.APP_STATE.MODEL_BUILDING:this.updateLabelsAndProgress("Processing "+this.currentArchiveTypeString+" file...","");break;case ze.App.APP_STATE.SESSION_CANCELED:break;case ze.App.APP_STATE.EXTRACTION_CANCEL_REQUESTED:this.updateUiForExtractionCancelRequested();break;case ze.App.APP_STATE.EXTRACTION_CANCELED:this.updateUiForExtractionComplete(!0);break;case ze.App.APP_STATE.RENDER_ZIP_UI:this.updateLabelsAndProgress("Displaying "+this.currentArchiveTypeString+" file...","");break;case ze.App.APP_STATE.READY_TO_EXTRACT:this.promptToExtract(e,t);break;case ze.App.APP_STATE.ZIP_READING:this.updateLabelsAndProgress("Reading "+this.currentArchiveTypeString+" file..."),this.showEl(this.buttonContainer,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.EXTRACTING:this.updateUiForExtractionStart(),this.handleProgress(0,100);break;case ze.App.APP_STATE.LIBRARY_LOADING:this.updateLabelsAndProgress("Loading code module..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.NEW_SESSION:break;case ze.App.APP_STATE.EXTRACTION_COMPLETE:case ze.App.APP_STATE.COMPLETE_WITH_ERRORS:this.updateUiForExtractionComplete(!1);break;case ze.App.APP_STATE.CHECKING_PASSWORD:this.updateLabelsAndProgress("Checking password..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.hideZipPasswordChars(),this.enableEl(this.checkPasswordButton,!1),this.enableEl(this.zipPasswordInput,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.cancelButton,!0),this.showEl(this.closeButton,!1);break;default:throw new Error("Unexpected state: "+this.appState)}},ze.App.prototype.showOrHideOpenZipPartButtons=function(e){"drive"==this.zipBlobSource?this.showEl(this.addZipPartFromDriveButton,e):this.showEl(this.addZipPartFromComputerButton,e)},ze.App.prototype.maybeDisplayAlternateViewOfMistypedZip=function(e,t){var i;t&&ze.App.startsWith(t,"image/")&&(i=(window.URL||window.webkitURL).createObjectURL(e),this.cachedMistypedZipImageUri=i,this.fileTableAlternateImageImg.src=i,this.showEl(this.fileTableAlternateImage,!0),this.showEl(this.fileTableContainer,!0))},ze.App.prototype.getFilesChangedStatusString=function(e,t,i){var r=i?"Creating new ZIP: ":"Editing ZIP: ";return null!=e?r+(1==e?" 1 file added":e+" files added"):null!=t?r+(1==t?"1 file removed":t+" files removed"):null},ze.App.prototype.showPasswordPrompt=function(){this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.zipPasswordInputContainer,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.checkPasswordButton,!0),this.setProgressBarPercent(0)},ze.App.prototype.maybeShowAddPasswordButton=function(){this.zipEntryTree&&this.zipEntryTree.isEncrypted||this.showEl(this.addPasswordButton,!0)},ze.App.prototype.setMainIcon=function(e){var t;e==ze.App.MAIN_ICON_TYPE.SPINNER?(this.mainLabel.style.color="",this.showEl(this.mainIcon,!1),this.showEl(this.mainSpinner,!0),this.mainAppHeaderContent.style.backgroundColor=""):(t=this.getMainHeaderConfigByType(e),this.mainIcon.textContent=t.iconKey,this.mainIcon.style.color=t.color,this.mainLabel.style.color=t.color,this.mainAppHeaderContent.style.backgroundColor=t.backgroundColor||"",this.showEl(this.mainIcon,!0),this.showEl(this.mainSpinner,!1))},ze.App.prototype.getMainHeaderConfigByType=function(e){var t={};switch(e){case ze.App.MAIN_ICON_TYPE.WARNING:t.iconKey="warning",t.color="#d00000",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.ERROR:t.iconKey="error_outline",t.color="#d00000",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.CANCEL:t.iconKey="warning",t.color="#d00000";break;case ze.App.MAIN_ICON_TYPE.SUCCESS:t.iconKey="check_circle",t.color="#1a73e8";break;case ze.App.MAIN_ICON_TYPE.SECURITY:t.iconKey="security",t.color="#1a73e8",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.LOCKED:t.iconKey="lock",t.color="",t.backgroundColor="";break;case ze.App.MAIN_ICON_TYPE.UNLOCKED:t.iconKey="lock_open",t.color="",t.backgroundColor="";break;case ze.App.MAIN_ICON_TYPE.ADD:t.iconKey="add_circle_outline",t.backgroundColor="",t.color="";break;case ze.App.MAIN_ICON_TYPE.INFO:t.iconKey="info_outline",t.backgroundColor="",t.color="";break;default:t.iconKey="info_outline",t.color="",t.backgroundColor=""}return t},ze.App.prototype.handleProgress=function(e,t){return this.handleGenericMainProgress(e,t)},ze.App.prototype.updateUiForFileComplete=function(e){var t;e.root||(ze.App.getFilenameCell(e).style.color="#1a73e8",(t=ze.App.getIconCell(e)).style.color="#1a73e8",t.style.opacity="0.8")},ze.App.prototype.handleEncryptionPromptCheckboxClick=function(e){var t=ze.App.isCheckboxIconButtonChecked(this.encryptionPromptCheckbox);ze.App.setCheckboxIconButtonChecked(this.encryptionPromptCheckbox,!t)},ze.App.prototype.handleSelectAllCheckboxClick=function(e){var t=ze.App.isCheckboxIconButtonChecked(this.selectAllCheckbox);ze.App.setCheckboxIconButtonChecked(this.selectAllCheckbox,!t),ze.App.setChildEntriesCheckState(this.zipEntryTree,!t)},ze.App.prototype.handleSecondaryLabelLinkClick=function(e){logImpression("choose_folder","user_button","app_state: "+this.appState),!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!1,!1,!1,!1,!0,!1),this.initiateManualAuth()):ze.App.showPicker(bindFn(this.handlePickerFolderSelected,this),!0)},ze.App.prototype.setProgressBarPercent=function(e){ze.App.doSetProgressBarPercent(e,this.mainProgressBar)},ze.App.prototype.setPreviewProgressBarPercent=function(e){ze.App.doSetProgressBarPercent(e,this.previewProgressBar)},ze.App.doSetProgressBarPercent=function(e,t){-1===e||(t.firstElementChild.style.width=e.toString()+"%")},ze.App.prototype.setAuthText=function(e){var t=!!(this.authButtonDetails.textContent=e);this.showEl(this.authButtonDetails,t),this.showEl(this.authButtonContainer,t)},ze.App.prototype.updateLabelsAndProgress=function(e,t,i){null!=e&&(this.showEl(this.mainAppHeader,!0),this.mainLabel.textContent=e),null!=t&&""!==(this.secondaryLabel.childNodes[0].nodeValue=t)||this.setSecondaryLabelLinkText(""),null!=i&&this.setProgressBarPercent(i)},ze.App.prototype.updateDownloadingFilename=function(e,t){this.fileTableHeaderLabel.textContent=e,this.showEl(this.fileTableHeaderLabel,!0);var i=null!=t&&""!==t?ze.App.formatSize(t):"";this.fileTableHeaderSize.textContent=i,this.showEl(this.fileTableContainer,!0)},ze.App.prototype.isTableEntrySelected=function(e){return!!e.root||ze.App.isChecked(e)},ze.App.prototype.renderZipTableUi=function(e){var t,i;this.setAppState(ze.App.APP_STATE.RENDER_ZIP_UI),this.fileTableHeaderLabel.textContent=this.zipFilename,null!=this.zipFileSize?(i=1==(t=this.zipEntryTree.originalEntries.length)?t+" file":t+" files",this.fileTableHeaderSize.textContent=i+", "+ze.App.formatSize(this.zipFileSize)):this.fileTableHeaderSize.textContent="",ze.App.generateZipTable(this.fileTableItems,this.zipEntryTree,bindFn(this.zipTableUiRendered,this,e))},ze.App.prototype.configurePasswordPrompt=function(){var e,t=this.isArchivePasswordFormatSupported(this.zipEntryTree.encryptionMode);logImpression("render_password_prompt","crypto","supported="+t+"; mode="+this.zipEntryTree.encryptionMode),t?this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_WINZIPAES||this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_RAR||this.zipEntryTree.encryptionMode==ze.App.ENCRYPTION_MODE_7ZAES?(e=this,ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){e.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED)})):this.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED):this.setAppState(ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED,this.zipEntryTree.encryptionMode),this.refreshZipEntryTreeItemState(ze.App.ESTATE.DEFAULT)},ze.App.prototype.isArchivePasswordFormatSupported=function(e){return e==ze.App.ENCRYPTION_MODE_PKZIPSTANDARD||e==ze.App.ENCRYPTION_MODE_RAR||e==ze.App.ENCRYPTION_MODE_WINZIPAES||e==ze.App.ENCRYPTION_MODE_7ZAES},ze.App.prototype.zipTableUiRendered=function(e){this.showEl(this.fileTableContainer,!0),this.fileTableContainer.scrollTop=0,this.showEl(this.selectAllCheckbox,!0),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.rootStatusIconContainer,!1),e()},ze.App.prototype.getEntriesByState=function(e){return this.zipEntryStateMap[e]},ze.App.prototype.getFirstEntryByState=function(e){var t=this.getEntriesByState(e);if(t){var i=Object.keys(t);if(i&&0<i.length)return t[i[0]]}return null},ze.App.prototype.getNumEntriesByState=function(e){var t=this.getEntriesByState(e);if(t){var i=Object.keys(t);if(i&&null!=i.length)return i.length}return 0},ze.App.prototype.getNumFilesExtracted=function(){return Math.max(this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_COMPLETE)-1,0)},ze.App.prototype.getNumFilesWithUploadErrors=function(){return this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_ERROR)},ze.App.prototype.getFirstErrorInfo=function(){var e=this.getFirstEntryByState(ze.App.ESTATE.UPLOAD_ERROR);if(e=e||this.getFirstEntryByState(ze.App.ESTATE.DECOMPRESSION_ERROR)){var t=e.error||"",i=e.message;return i&&(t+=" - "+i),t}return""},ze.App.prototype.getNumFilesWithDecompressionErrors=function(){return this.getNumEntriesByState(ze.App.ESTATE.DECOMPRESSION_ERROR)},ze.App.prototype.getNumFilesSkipped=function(){return this.getNumEntriesByState(ze.App.ESTATE.SKIPPED)+this.getNumEntriesByState(ze.App.ESTATE.PARSE_ERROR)+this.getNumEntriesByState(ze.App.ESTATE.ENTRY_DISK_MISSING)},ze.App.prototype.getNumFilesCanceled=function(){return this.getNumEntriesByState(ze.App.ESTATE.CANCELED)+this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_ABORTED)+this.getNumEntriesByState(ze.App.ESTATE.DECOMPRESSION_CANCELED)},ze.App.prototype.updateUiForExtractionComplete=function(e){var t,i,r,s,n,o,p,a,l,h,d,E,A,c,u,T,z,_,P;null!=this.zipEntryTree&&(this.sessionPropMap[ze.App.SESS_PROP.DIDZIPEXTRACT]=!0,this.setProgressBarPercent(100),this.fileTableContainer.scrollTop=0,t=this.getNumFilesExtracted(),i=this.getNumFilesWithUploadErrors(),r=this.getNumFilesWithDecompressionErrors(),s=this.getNumFilesCanceled(),o=0<(n=this.getNumFilesSkipped()),p=0<s,l=0<(a=i+r),h=0<i,E=d="",this.updateRootEntryUi(this.zipEntryTree),this.showEl(this.closeButton,!0),this.showEl(this.viewFilesButton,!0),c=(A=getUserLocale())&&ze.App.startsWith(A.toLowerCase(),"en"),u="adLoadedDuringInit"in window&&!!adLoadedDuringInit,T="adsenseScriptLoadError"in window&&!!adsenseScriptLoadError,z="computer"==detectDevice(),_=!u||T,!l&&!p&&!e&&z&&u&&T&&c?this.showEl(this.rateAppButton,!0):(l||p)&&_&&c&&this.showEl(this.sendFeedbackButton,!0),this.showEl(this.cancelButton,!1),this.wasZipFileCreatedLocally?(P=null!=this.createdZipSavedToDriveId,this.showEl(this.saveZipToDriveButton,!P),this.showEl(this.openZipInDriveButton,P),this.showEl(this.downloadZipButton,!0)):(this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1)),e?(d="Extraction canceled",this.showEl(this.retryButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)):(d=l?"Extraction complete, but with errors":"Extraction complete",this.showEl(this.extractButton,!1),this.showEl(this.retryButton,h),this.showEl(this.editZipButton,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0)),E=1==t?"1 file extracted. ":t+" files extracted. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS),p&&(E+=1==s?"1 file was canceled. ":s+" files were canceled. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)),l&&(E+=1==a?"1 file had an error. ":a+" files had errors. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)),o&&(E+=1==n?"1 file was skipped. ":n+" files were skipped. "),E=E.trim(),ze.App.endsWith(E,".")&&(E=E.substring(0,E.length-1)),this.updateLabelsAndProgress(d,E),l?ze.App.maybeReportTestError("Extraction Completed with "+a+" errors"):o?ze.App.maybeReportTestError("Extraction Completed with no errors but with "+n+" skipped items"):ze.App.maybeReportTestSuccess("Extraction complete with "+t+" item(s) extracted"))},ze.App.prototype.updateUiForExtractionStart=function(){this.showEl(this.extractButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.editZipButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.rateAppButton,!1),this.showEl(this.sendFeedbackButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.fixEncodingButton,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0),this.setSecondaryLabelLinkText(""),this.updateLabelsAndProgress("Extracting "+this.currentArchiveTypeString+" file to Google Drive...","",0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER)},ze.App.prototype.updateSecondaryProgressString=function(e){this.updateLabelsAndProgress(void 0,this.getNumItemsUploadedString(e))},ze.App.prototype.getItemsRemainingString=function(e){var t=this.getNumItemsRemaining(),i=t.toString()+" "+(1==t?"file":"files")+" remaining";return null!=e&&-1!=e&&(i+=" ("+e+"%)"),i},ze.App.prototype.getNumItemsUploadedString=function(e){var t=this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_COMPLETE);this.zipEntryTree&&null!=this.zipEntryTree.driveFileId&&t--;var i=t+this.getNumItemsRemaining(),r=t.toString()+" of "+i+" "+(1==i?"file":"files")+" extracted";return null!=e&&-1!=e&&(r+=" ("+e+"%)"),r},ze.App.prototype.getNumItemsRemaining=function(){var e=Object.keys(this.zipEntriesInProcessMap).length;return this.zipEntryTree&&null==this.zipEntryTree.driveFileId?e-1:e},ze.App.prototype.startNewManualSession=function(e){this.setAppState(ze.App.APP_STATE.NEW_SESSION),e||this.showEl(this.mainAppHeader,!1),this.mainAppSubTitle.textContent="Free app for opening ZIP files",this.showEl(this.zipTable,!1),this.fileTableContainer.scrollTop=0,this.zipPasswordInput.value="",this.zipFilenameInput.value="",this.showEl(this.extractButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.rateAppButton,!1),this.showEl(this.sendFeedbackButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.fileTableSubHeader,!1),this.showEl(this.secondaryLabelLink,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.addZipPartFromComputerButton,!1),this.showEl(this.addZipPartFromDriveButton,!1),this.showEl(this.checkPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.fixEncodingButton,!1),this.showEl(this.fileTableAlternateImage,!1),this.secondaryLabel.childNodes[0].nodeValue="",this.mainLabel.textContent="",this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.fileTableContainer,!1),this.showEl(this.buttonContainer,!1),this.showEl(this.selectAllCheckbox,!1),ze.App.setCheckboxIconButtonChecked(this.selectAllCheckbox,!0),this.setProgressBarPercent(0),this.highestZipEntryIndexUploadedInSession=0,e||this.configureStartPageForNewManualSession(),this.showEl(this.mainScrollableContent,!0)},ze.App.prototype.promptToExtract=function(e,t){this.showEl(this.closeButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.extractButton,!0),this.enableEl(this.extractButton,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.editZipButton,!0),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.buttonContainer,!0),this.showEl(this.editZipButton,!!t),this.cancelButton.style.visibility="",this.updateLabelsForReadyToExtract(e)},ze.App.prototype.hideWelcomeText=function(){this.showEl(this.generalButtonContainer,!1),this.showEl(this.authButtonContainer,!1),this.showEl(this.startPagePrompt,!1)},ze.App.prototype.updateLabelsForReadyToExtract=function(e){var t=e?"Password correct. ":"",i="Ready to extract ",r=detectDevice();"phone"==r&&e||(i+=this.currentArchiveTypeString+" file"),"phone"!=r&&this.currentAutodetectedEncoding&&(i+=' (encoding: "'+this.currentAutodetectedEncoding+'")'),this.updateLabelsAndProgress(t+i,"Location for extracted files: ",100),this.setSecondaryLabelLinkText("Google Drive"),e?this.setMainIcon(ze.App.MAIN_ICON_TYPE.UNLOCKED):this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO)},ze.App.prototype.setSecondaryLabelLinkText=function(e){e?(this.secondaryLabelLink.textContent=e,this.showEl(this.secondaryLabelLink,!0)):(this.secondaryLabelLink.textContent="",this.showEl(this.secondaryLabelLink,!1))},ze.App.prototype.updateUiForExtractionCancelRequested=function(){this.enableEl(this.cancelButton,!1),this.updateLabelsAndProgress("Canceling extraction..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER)},ze.App.prototype.updateUiForDownloadError=function(e,t){this.showEl(this.cancelButton,!1),this.showEl(this.retryButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.fileTableContainer,!1);var i=e||"Unknown error";this.updateLabelsAndProgress("Unable to open ZIP file",i),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)},ze.App.prototype.handlePreviewCloseButtonClick=function(e){this.closePreview()},ze.App.prototype.isPreviewShown=function(){return null!=this.previewedEntry},ze.App.prototype.closePreview=function(){this.showEl(this.previewDownloadButton,!1),this.showEl(this.previewSaveToDriveButton,!1),this.showEl(this.previewOpenInDriveButton,!1),this.showEl(this.preview,!1),this.mainScrollableContent.scrollTop=0,this.showEl(this.zipTable,!0),this.resetPreview()},ze.App.prototype.handlePreviewDownloadButtonClick=function(e){logImpression("preview_download","user_button","previewed_entry_is_null: "+(null==this.previewedEntry)),this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADSUBITEM]=!0;var t=this;this.previewedBlob?(this.enableEl(this.previewDownloadButton,!1),this.downloadBlobToBrowser(this.previewedEntry.name,new Blob([this.previewedBlob],{type:"application/octet-stream"})),this.enableEl(this.previewDownloadButton,!0)):(this.willDownloadAfterDecompression=!0,this.decompressPreviewedBlob(this.previewedEntry,function(){t.isPreviewDecompressing=!1,t.wasPreviewDecompressionCancelled=!1,t.willDownloadAfterDecompression=!1,t.updatePreviewFilenameLabel(),t.downloadBlobToBrowser(t.previewedEntry.name,new Blob([t.previewedBlob],{type:"application/octet-stream"})),t.configurePreviewActionButtonsForWorkingOperation(!1)},bindFn(this.previewDecompressionErrorOrCancel,this,this.previewedEntry),bindFn(this.previewDecompressionProgressFunction,this,this.previewedEntry,!0),bindFn(this.generalDecompressionCheckCancelFn,this)))},ze.App.prototype.updatePreviewFilenameLabel=function(){this.previewZipFilenameAndStatus.textContent=this.zipFilename},ze.App.prototype.storeDecompressedPreviewedBlob=function(e,t){var i={};"pdf"==ze.App.getFileExtension(e.name)&&(i.type="application/pdf"),this.previewedBlob=new Blob([t],i)},ze.App.prototype.decompressPreviewedBlob=function(t,i,e,r,s){this.configurePreviewActionButtonsForWorkingOperation(!0,!0),t.isEncrypted&&r?this.previewZipFilenameAndStatus.textContent="Decrypting...":this.previewZipFilenameAndStatus.textContent="Decompressing...",this.isPreviewDecompressing=!0,this.wasPreviewDecompressionCancelled=!1;var n=this;ze.App.decompressArchiveEntry(this.zipBlob,t,!0,function(e){n.isPreviewDecompressing=!1,n.wasPreviewDecompressionCancelled=!1,n.storeDecompressedPreviewedBlob(t,e),i()},e,r,s,this.getZipPasswordCharCodeByteArray())},ze.App.prototype.handlePreviewNextButtonClick=function(e){var t;!this.previewedEntry||(t=this.getNextOrPrevEntry(this.previewedEntry,!0))&&this.updateCurrentPreview(t)},ze.App.prototype.handlePreviewPrevButtonClick=function(e){var t;!this.previewedEntry||(t=this.getNextOrPrevEntry(this.previewedEntry,!1))&&this.updateCurrentPreview(t)},ze.App.prototype.getNextOrPrevEntry=function(e,t){var i=e.tableRow;if(i){var r=t?i.nextElementSibling:i.previousElementSibling;if(r){var s=r.entry;return s.directory?this.getNextOrPrevEntry(s,t):s}var n=t?i.parentElement.firstElementChild:i.parentElement.lastElementChild;if(n&&n.entry!=e){var o=n.entry;return o.directory?this.getNextOrPrevEntry(o,t):o}return null}return null},ze.App.prototype.updateCurrentPreview=function(e){this.resetPreview(),this.previewItem(e)},ze.App.prototype.handlePreviewSaveToDriveButtonClick=function(e){logImpression("preview_save_to_drive","user_button"),!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!1,!1,!0,!1,!1,!1),this.initiateManualAuth()):this.previewedBlob?this.savePreviewedBlobToDrive():(this.willSaveToDriveAfterDecompression=!0,this.decompressPreviewedBlob(this.previewedEntry,bindFn(this.savePreviewedBlobToDrive,this,this.previewedEntry),bindFn(this.previewDecompressionErrorOrCancel,this,this.previewedEntry),bindFn(this.previewDecompressionProgressFunction,this,this.previewedEntry,!0),bindFn(this.generalDecompressionCheckCancelFn,this)))},ze.App.prototype.configurePreviewActionButtonsForWorkingOperation=function(e,t,i){this.showEl(this.previewDownloadButton,!e),this.showEl(this.previewNextButton,!e),this.showEl(this.previewPrevButton,!e),this.showEl(this.previewCloseButton,!e),this.showEl(this.previewSpinner,e),this.showEl(this.previewItemIcon,!e),this.showEl(this.previewOpenInDriveButton,!e&&!!i),this.showEl(this.previewSaveToDriveButton,!e&&!i),t?(this.showEl(this.previewCancelButton,e),this.enableEl(this.previewCancelButton,e)):this.showEl(this.previewCancelButton,!1)},ze.App.prototype.fixEncoding=function(){this.enableEl(this.fixEncodingButton,!1),ze.App.ensureLibLoadedAndCallback(ze.App.LIB_JSCHARDET_WINDOW_OBJECT_CHECK,ze.App.LIB_JSCHARDET_SCRIPT_NAME,bindFn(this.doFixEncoding,this))},ze.App.prototype.doFixEncoding=function(){logImpression("fix_encoding","encoding");var e,t,i,r,s=this.autodetectEncoding();logImpression("detected_encoding","encoding",s),null!=s&&(e=this.zipFilename,t=this.zipBlob,i=this.isTarFile,this.closeSession(),this.currentAutodetectedEncoding=s,r=null,i&&(r=ze.App.CANONICAL_MIME_TYPES.TAR),this.loadArchiveSessionFromManualBlobs(e,t,void 0,void 0,r))},ze.App.prototype.autodetectEncoding=function(){if(!(this.zipEntryTree&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length))return null;for(var e="",t=0;t<this.zipEntryTree.originalEntries.length;t++){var i=this.zipEntryTree.originalEntries[t];if(i.rawFilenameBytes)for(var r=0;r<i.rawFilenameBytes.length;r++)e+=String.fromCharCode(i.rawFilenameBytes[r]);else e+=i.filename;e+=" "}var s=jschardet.detect(e);return window.console.log(s),s&&s.encoding?s.encoding.toLowerCase():null},ze.App.prototype.setResumeFlags=function(e,t,i,r,s,n){this.doResumeOpenFromDriveAfterManualAuth=e,this.doResumeExtractToDriveAfterManualAuth=t,this.doResumeSavePreviewItemToDriveAfterManualAuth=i,this.doResumeSaveZipToDriveAfterManualAuth=r,this.doResumeChooseFolderLocationAfterManualAuth=s,this.doResumeAddFilesToZipFromDriveAfterManualAuth=n},ze.App.prototype.handleAddZipPartsFromDrive=function(e){ze.App.showPicker(bindFn(this.handleAddZipPartsFromDrivePickerCallback,this,e),!1,void 0,"Select parts to add to ZIP (.z01, .z02, etc.)...",!0,!0,e)},ze.App.prototype.handleAddZipPartsFromDrivePickerCallback=function(e,t){var i=ze.App.getArchiveFilesProperties(t,e),r=null;if(i.hasMultiPartArchiveParts){r=[];for(var s=0;s<i.multiPartArchivePartsIdx.length;s++)r.push(t[i.multiPartArchivePartsIdx[s]])}if(console.log("Picked multiple file parts from drive! ",r),r&&0<r.length){for(var n=[],o=0;o<r.length;o++)n.push(r[o].id);this.downloadAndAddMultipleFilePartIdsToExistingArchive(n)}else console.log("No viable matching Zip Parts selected.")},ze.App.prototype.downloadAndAddMultipleFilePartIdsToExistingArchive=function(e){var r=this;this.downloadMultipleFileIds(e,function(e,t){for(var i=0;i<e.length;i++)e[i].name=t[i].name;r.addZipPartBlobsToExistingMultiPartArchive(e)},function(e){console.trace(),console.log("download multipart ERROR",e),r.updateLabelsAndProgress(void 0,"Multi-Download Error (B): "+e,100)})},ze.App.prototype.downloadMultipleFileIds=function(e,t,i,r){this.doDownloadMultipleFileIds(e,0,[],[],t,i)},ze.App.prototype.doDownloadMultipleFileIds=function(i,r,s,n,o,p,a){try{if(r>=i.length)return logImpression("add_parts_from_drive","multipart","success"),void o(s,n);var l=i[r],h=this,e=ze.Dapi.generateCallbacks(function(e){var t;n.push(e),a?h.doDownloadMultipleFileIds(i,r+1,s,n,o,p):(t=ze.Dapi.generateCallbacks(function(e){s.push(e),h.doDownloadMultipleFileIds(i,r+1,s,n,o,p)},p,bindFn(h.onDownloadProgress,h,!0,e.name,e.size),p),h.lastDownloadId=l,ze.Dapi.downloadFileBytes(l,t))},p,void 0,p);this.updateLabelsAndProgress(void 0,"Downloading ZIP part...",0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),ze.Dapi.get(l,e)}catch(e){this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),p(e)}},ze.App.prototype.downloadMultiPartZipPart=function(i,r,e){var t=i[r],s=ze.App.getProcessedSizeFromDriveFileObj(t),n=t.name.trim(),o=t.mimeType,p=this,a=ze.Dapi.generateCallbacks(function(e){var t=new Blob([e],{type:o});t.name=n,p.addFilesToZip([t],!0,function(){p.doAddFileOrFileStubToZipFromDrive(i,r+1,numFilesAdded+1,opt_isForCreate)})},function(e,t){p.addFilesToZipOrEncryptZipCancelRequested?p.handleZipCreateError("Adding files to ZIP canceled",!0):(p.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),p.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),p.configureUiForZipEditMode(void 0,void 0,opt_isForCreate),p.doAddFileOrFileStubToZipFromDrive(i,r+1,numFilesAdded,opt_isForCreate))},bindFn(this.onDownloadProgress,this,!0,n,s),function(e){p.addFilesToZipOrEncryptZipCancelRequested?p.handleZipCreateError("Adding files to ZIP canceled",!0):(p.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),p.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),p.configureUiForZipEditMode(),p.doAddFileOrFileStubToZipFromDrive(i,r+1,numFilesAdded,opt_isForCreate))});this.lastDownloadId=t.id,ze.Dapi.downloadFileBytes(t.id,a)},ze.App.prototype.addFilesToZipFromDrive=function(e){ze.App.showPicker(bindFn(this.handleAddFilesToZipFromDrivePickerCallback,this),!1,e,"Select files to add to ZIP...",!0,!0)},ze.App.prototype.handleAddFilesToZipFromDrivePickerCallback=function(e){logImpression("add_files_from_drive_picker","create_zip","start. count: "+e.length);var t=this.zipEntryTree.originalEntries&&0==this.zipEntryTree.originalEntries.length;this.doAddFileOrFileStubToZipFromDrive(e,0,0,t)},ze.App.prototype.doAddFileOrFileStubToZipFromDrive=function(i,r,s,n){if(r>=i.length)return logImpression("add_files_from_drive","create_zip","success"),this.numFilesRecentlyAdded=s,this.numFilesRecentlyRemoved=null,void this.setAppState(ze.App.APP_STATE.ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE,void 0,s,void 0,n);this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1;var o,e,t=i[r];t.needsMetadata?(this.setAppState(ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP),o=this,e=ze.Dapi.generateCallbacks(function(e){t.size=e.size,t.name=e.name,t.mimeType=e.mimeType,o.doAddFileToZipFromDriveWithFullMetadata(i,r,s,n)},function(e,t){o.doAddFileOrFileStubToZipFromDrive(i,r+1,s,n)},void 0,function(e){o.doAddFileOrFileStubToZipFromDrive(i,r+1,s,n)}),ze.Dapi.get(t.id,e)):this.doAddFileToZipFromDriveWithFullMetadata(i,r,s,n)},ze.App.prototype.doAddFileToZipFromDriveWithFullMetadata=function(i,r,s,n){var e=i[r],t=ze.App.getProcessedSizeFromDriveFileObj(e),o=e.name.trim();this.setAppState(ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP,o,t);var p=e.mimeType,a=this,l=ze.Dapi.generateCallbacks(function(e){a.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP);var t=new Blob([e],{type:p});t.name=o,a.addFilesToZip([t],!0,function(){a.doAddFileOrFileStubToZipFromDrive(i,r+1,s+1,n)})},function(e,t){a.addFilesToZipOrEncryptZipCancelRequested?a.handleZipCreateError("Adding files to ZIP canceled",!0):(a.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),a.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),a.configureUiForZipEditMode(void 0,void 0,n),a.doAddFileOrFileStubToZipFromDrive(i,r+1,s,n))},bindFn(this.onDownloadProgress,this,!0,o,t),function(e){a.addFilesToZipOrEncryptZipCancelRequested?a.handleZipCreateError("Adding files to ZIP canceled",!0):(a.setAppState(ze.App.APP_STATE.DOWNLOADED_FILE_TO_ADD_TO_ZIP),a.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),a.configureUiForZipEditMode(),a.doAddFileOrFileStubToZipFromDrive(i,r+1,s,n))});this.lastDownloadId=e.id,ze.App.isExportableGoogleDocsMimeType(e.mimeType)?(o+=".pdf",ze.Dapi.exportGoogleDocFileBytes(e.id,l)):ze.Dapi.downloadFileBytes(e.id,l)},ze.App.prototype.saveZipToDrive=function(){var e,t,i;!isAuthorized()||isTokenExpired()?(this.setResumeFlags(!1,!1,!1,!0,!1,!1),this.initiateManualAuth()):(e=this.zipEntryTree?this.zipEntryTree.encryptionMode:"null zipEntryTree",logImpression("save_zip_to_drive","create_zip","start. encryptionMode: "+e),this.updateLabelsAndProgress("Saving ZIP file to Google Drive...","Saving..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.isSavingToDrive=!0,this.wasSaveToDriveCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.showEl(this.doneEditingZipButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.rateAppButton,!1),this.showEl(this.sendFeedbackButton,!1),this.enableEl(this.saveZipToDriveButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.setProgressBarPercent(0),t=ze.Dapi.generateCallbacks(bindFn(this.saveZipToDriveUploadComplete,this),bindFn(this.saveZipToDriveUploadError,this),bindFn(this.saveZipToDriveUploadProgress,this,this.zipBlob.size),bindFn(this.saveZipToDriveUploadAborted,this)),i=STATE.folderId||this.parentFolderId,ze.Dapi.uploadFile(t,this.zipFilename,this.zipBlob,i))},ze.App.prototype.saveZipToDriveUploadComplete=function(e){logImpression("save_zip_to_drive","create_zip","success"),this.setProgressBarPercent(100),this.createdZipSavedToDriveId=e.id,this.isSavingToDrive=!1,this.showEl(this.cancelButton,!1),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.downloadZipButton,!0),this.showEl(this.saveZipToDriveButton,!1),this.enableEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!0),this.enableEl(this.openZipInDriveButton,!0),this.updateLabelsAndProgress("ZIP file saved to Google Drive"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.refreshZipEntryTreeItemState(ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE)},ze.App.prototype.saveZipToDriveUploadProgress=function(e,t,i){var r=null!=i&&0!==i?i:e;this.handleGenericMainProgress(t,r,!0,"Saving")},ze.App.prototype.saveZipToDriveUploadError=function(e,t,i){logImpression("save_zip_to_drive","create_zip","error: "+t),this.enableEl(this.saveZipToDriveButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.setProgressBarPercent(100),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.showEl(this.cancelButton,!1),this.updateLabelsAndProgress("Error when saving ZIP file"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.downloadZipButton,!0),this.updateLabelsAndProgress(null,"Error details: "+(t||""))},ze.App.prototype.saveZipToDriveUploadAborted=function(e,t){logImpression("save_zip_to_drive","create_zip","aborted. message: "+(t||"")),this.enableEl(this.saveZipToDriveButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.setProgressBarPercent(100),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.showEl(this.cancelButton,!1),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.downloadZipButton,!0);var i=this.wasSaveToDriveCancelled?"Save ZIP to Drive canceled":"Error when saving ZIP file. ",r=this.wasSaveToDriveCancelled?'You may try again with the "Save ZIP to Drive" button. ':"There was a network problem. "+(t||"");this.updateLabelsAndProgress(i,r);var s=this.wasSaveToDriveCancelled?ze.App.MAIN_ICON_TYPE.WARNING:ze.App.MAIN_ICON_TYPE.ERROR;this.setMainIcon(s)},ze.App.prototype.savePreviewedBlobToDrive=function(e){var t;logImpression("preview_upload_file","preview","start"),null!=this.previewedEntry&&null!=this.previewedBlob&&(null!=e&&e!=this.previewedEntry||(this.configurePreviewActionButtonsForWorkingOperation(!0,!0),this.previewZipFilenameAndStatus.textContent="Saving to Drive...",this.isSavingToDrive=!0,this.wasSaveToDriveCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.setPreviewProgressBarPercent(0),t=ze.Dapi.generateCallbacks(bindFn(this.previewFileUploadComplete,this,this.previewedEntry),bindFn(this.previewFileUploadError,this,this.previewedEntry),bindFn(this.previewFileUploadProgress,this,this.previewedEntry,!0,this.previewedBlob.size),bindFn(this.previewFileUploadAborted,this,this.previewedEntry)),ze.Dapi.uploadFile(t,this.previewedEntry.name,this.previewedBlob,null)))},ze.App.prototype.previewFileUploadComplete=function(e,t){logImpression("preview_upload_file","preview","success"),this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1),this.updatePreviewFilenameLabel(),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,e.driveFileId=t.id,this.showEl(this.previewOpenInDriveButton,!0),this.showEl(this.previewSaveToDriveButton,!1),this.previewType&&ze.App.startsWith(this.previewType,"drive")?(this.showEl(this.previewDriveSaveToDriveFirst,!1),this.showEl(this.previewSaveToDriveDetails,!1),this.doEmbeddedDrivePreview(e.driveFileId)):(this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0))},ze.App.prototype.previewFileUploadError=function(e,t,i){logImpression("preview_upload_file_error","preview","error: "+i),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.previewZipFilenameAndStatus.textContent="Save to Drive error: "+i,this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1)},ze.App.prototype.previewFileUploadAborted=function(e,t,i){logImpression("preview_upload_file_aborted","preview","message: "+i),this.isSavingToDrive=!1,this.willSaveToDriveAfterDecompression=!1,this.wasSaveToDriveCancelled?this.updatePreviewFilenameLabel():this.previewZipFilenameAndStatus.textContent="Save to Drive error (network problem)",this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1)},ze.App.prototype.previewFileUploadProgress=function(e,t,i,r,s){var n=null!=s&&0!==s?s:i;this.handleGenericPreviewProgress(r,n,t,"Saving to Drive...")},ze.App.prototype.handlePreviewOpenInDriveButtonClick=function(e){null!=this.previewedEntry.driveFileId&&ze.App.openEntryInDrive(this.previewedEntry)},ze.App.prototype.downloadBlobToBrowser=function(e,t){logImpression("download_blob_to_browser_start","download_blob_to_browser");var i=window.URL||window.webkitURL,r=this.downloadAnchorEl,s=i.createObjectURL(t);r.setAttribute("href",s),r.setAttribute("download",e),r.setAttribute("target","_blank"),r.textContent=e;try{r.click(),logImpression("download_blob_to_browser_success","download_blob_to_browser")}catch(e){logImpression("download_blob_to_browser_error","download_blob_to_browser",e)}},ze.App.prototype.downloadZipToBrowser_newWindowMethod=function(t,e){var i=new FileReader,r=new Blob([e],{type:"application/zip"});i.onload=function(e){window.open(t,"_self").location.href=i.result},i.readAsDataURL(r)},ze.App.prototype.handlePickerZipFileSelected=function(e){this.sessionPropMap[ze.App.SESS_PROP.DIDPICKDRIVEZIP]=!0,this.closeSession(!0),this.zipBlobSource="drive",this.downloadFileById(e.id)},ze.App.prototype.handlePickerFolderSelected=function(e){this.sessionPropMap[ze.App.SESS_PROP.DIDPICKEXTRACTLOCATION]=!0,this.parentFolderId=e.id,this.setSecondaryLabelLinkText(e.name)},ze.App.prototype.handleAddLocalFileInputElChange=function(e){var t;this.isProcessingAddLocalFileInputEl||(this.isProcessingAddLocalFileInputEl=!0,(t=e.target.files)&&0<t.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP]=!0,this.addFilesToZip(t,void 0,void 0,!0)),this.addLocalFileInputEl.value="",this.isProcessingAddLocalFileInputEl=!1)},ze.App.prototype.handleAddLocalFolderInputElChange=function(e){var t,i,r,s,n;this.isProcessingAddLocalFolderInputEl||(this.isProcessingAddLocalFolderInputEl=!0,(t=e.target.files)&&0<t.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDADDLOCALFOLDERSTOZIP]=!0,r=i=null,!(s=t[0].relativePath||t[0].webkitRelativePath)||-1!=(n=s.indexOf("/"))&&(i=(r=s.substring(0,n))+".zip"),this.addFilesToZip(t,void 0,void 0,!0,!0,i,r)),this.addLocalFolderInputEl.value="",this.isProcessingAddLocalFolderInputEl=!1)},ze.App.prototype.addZipPartBlobsToExistingMultiPartArchive=function(e){var t,i,r,s,n,o,p,a,l;this.addZipPartFilesToMapAndCreateMaskIndex(e,this.zipFilename),0<this.numExtraZipParts&&this.areAdditionalZipPartsRequired()?(t=this.getAdditionalZipPartsRequiredExtensionString(),this.setAppState(ze.App.APP_STATE.MULTI_PART_ZIP,t),logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","partial. numExtraParts: "+this.numExtraZipParts+"; partsRequiredString: "+t),this.refreshZipEntryMissingDiskStatusFromCurrentState()):(logImpression(this.currentArchiveTypeString.toLowerCase(),"multipart","success. numExtraParts: "+this.numExtraZipParts),i=this.zipFilename,r=this.zipBlob,s=this.extraZipPartsMap,n=this.numExtraZipParts,o=this.zipPartsLoadedMask,p=this.parentFolderId,this.closeSession(!0),this.extraZipPartsMap=s,this.numExtraZipParts=n,this.zipPartsLoadedMask=o,this.parentFolderId=p,a=r.size,l=this.getConsolidatedZipBlobFromZipPartsMap(r),this.loadArchiveSessionFromManualBlobs(i,l,void 0,a))},ze.App.prototype.handleOpenLocalZipPartFileInputElChange=function(e){var t;this.isProcessingOpenLocalZipPartFileInputEl||(this.isProcessingOpenLocalZipPartFileInputEl=!0,(t=e.target.files)&&0<t.length&&this.addZipPartBlobsToExistingMultiPartArchive(t),this.isProcessingOpenLocalZipPartFileInputEl=!1)},ze.App.prototype.handleOpenLocalZipFileInputElChange=function(e){var t;this.isProcessingOpenLocalZipFileInputEl||(this.isProcessingOpenLocalZipFileInputEl=!0,(t=e.target.files)&&0<t.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDPICKLOCALZIP]=!0,this.closeSession(!0),this.maybeCreateLocalSessionFromFiles(t,!1)),this.openLocalZipFileInputEl.value="",this.isProcessingOpenLocalZipFileInputEl=!1)},ze.App.prototype.loadArchiveSessionFromManualBlobs=function(e,t,i,r,s,n){this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO),this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.updateDownloadingFilename(e,t.size),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="cloud_download",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0);var o=this;this.readArchiveWithInferredMimetype(e,t,r,n,function(){i&&0<i.length&&o.addZipPartBlobsToExistingMultiPartArchive(i)},s)},ze.App.getArchiveFilesProperties=function(e,t){for(var i=Math.min(1e4,e.length),r={primaryArchiveIdx:-1,secondaryArchivesIdx:[],otherFilesIdx:[],multiPartArchivePartsIdx:[],isDirectoryTree:!1},s=0;s<i;s++){var n=e[s];if(0!=s&&n.isDirectory)return r.isDirectoryTree=!0,r;var o=n.name.trim(),p=ze.App.getFileExtension(o);p&&""!=p&&-1!=ze.App.SUPPORTED_ARCHIVE_EXTENSIONS.indexOf(p)&&(!(r.hasPrimaryArchive||t&&ze.App.getBaseFilenameNoExtension(o)!=t)?(r.hasPrimaryArchive=!0,r.primaryArchiveBaseName=ze.App.getBaseFilenameNoExtension(o),r.primaryArchiveIdx=s):(r.hasSecondaryArchives=!0,r.secondaryArchivesIdx.push(s)))}for(var a,l,h=t||r.primaryArchiveBaseName,d=0;d<i;d++){d!=r.primaryArchiveIdx&&(a=e[d].name.trim(),l=!1,null!=ze.App.translateZipPartFilenameToIndex(a)&&null!=h&&h==ze.App.getBaseFilenameNoExtension(a)&&(l=!0),l?(r.hasMultiPartArchiveParts=!0,r.multiPartArchivePartsIdx.push(d)):(r.hasOtherFiles=!0,r.otherFilesIdx.push(d)))}return r},ze.App.prototype.readArchiveWithInferredMimetype=function(t,i,r,s,n,e){var o,p;null!=e&&""!=e?this.readArchive(t,p,e,i,r,n,s):(o=this,p=i.size,ze.App.inferArchiveMimetypeFromMagicBlobAsync(i,function(e){o.readArchive(t,p,e,i,r,n,s)},function(e){logImpression("error_inferring_mimetype","misc",e),o.readArchive(t,p,null,i,r,n,s)}))},ze.App.prototype.createNewZipFromFile=function(e,t,i,r){var s=null,s=r&&ze.App.isExportableGoogleDocsMimeType(r)?"Google Docs":ze.App.getFileExtension(e).toUpperCase();this.mainAppSubTitle.textContent="Create ZIP file from "+s+" file",logImpression("create_new_zip_from_file","create_zip",s),this.createZipFromFileAssociatedExtension=s,ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CREATEZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_CREATEZIP_SCRIPT_NAME,bindFn(this.doCreateNewZipFromFile,this,e,t,i,r))},ze.App.prototype.doCreateNewZipFromFile=function(e,t,i,r){logImpression("create_new_zip_from_file","create_zip","init + lib_loaded");var s=ze.App.getZipExtractorCreateZipCommentString(),n=e+".zip",o=zeCreateZipLib.createEmptyZipBlob(s);this.zipFilenameInput.value=n,this.fileTableHeaderLabel.textContent=n;var p={filename:ze.App.sanitizeDriveFilename(e),uncompressedFileBlob:t,mimeType:r};this.wasZipFileCreatedLocally=!0,this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.isInZipEditMode=!0,this.readArchive(n,o.size,ze.App.CANONICAL_MIME_TYPES.ZIP,o,void 0,bindFn(this.addManualItemToEmptyZip,this,o,[p],i,r))},ze.App.prototype.addManualItemToEmptyZip=function(e,t,i,r){this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1,this.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP),zeCreateZipLib.serializeZipFromEntries([],e,t,bindFn(this.renderCreatedZip,this,!1,i,t[0].name,!1,!1,1,void 0,!0,bindFn(this.maybeAddAdditionalFilesToNewlyCreatedZip,this)),bindFn(this.handleZipCreateError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipCreateError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment)},ze.App.prototype.maybeAddAdditionalFilesToNewlyCreatedZip=function(){console.log("In: maybeAddAdditionalFilesToNewlyCreatedZip");var e=[],t=STATE&&STATE.ids&&0<STATE.ids.length;if(STATE&&STATE.ids&&1<STATE.ids.length)for(var i=1;i<STATE.ids.length;i++){var r={};r.id=STATE.ids[i],r.needsMetadata=!0,e.push(r)}var s=t?0:1;if(STATE&&STATE.exportIds&&STATE.exportIds.length>s)for(var n=s;n<STATE.exportIds.length;n++){var o={};o.id=STATE.exportIds[n],o.needsMetadata=!0,e.push(o)}0<e.length&&(logImpression("add_files_from_drive_multi_open_with","create_zip","start. count: "+e.length),this.doAddFileOrFileStubToZipFromDrive(e,0,1,!0))},ze.App.prototype.createNewEmptyZip=function(e,t){this.sessionPropMap[ze.App.SESS_PROP.DIDCREATEZIP]=!0,this.closeSession(!0),this.mainAppSubTitle.textContent="Free app for creating ZIP files",this.wasZipFileCreatedLocally=!0,this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CREATEZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_CREATEZIP_SCRIPT_NAME,bindFn(this.doCreateNewEmptyZip,this,e,t))},ze.App.prototype.doCreateNewEmptyZip=function(e,t){var i=ze.App.getZipExtractorCreateZipCommentString(),r=zeCreateZipLib.createEmptyZipBlob(i);this.isInZipEditMode=!0;var s=this;this.readArchive(e||ze.App.DEFAULT_ZIP_FILENAME,r.size,ze.App.CANONICAL_MIME_TYPES.ZIP,r,void 0,function(){s.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP),s.updateSaveZipAndDownloadZipButtonEnablementAfterZipEntryTreeRender(),t&&t()})},ze.App.prototype.addFilesToZip=function(e,t,i,r,s,n,o){if(null!=this.zipEntryTree){this.zipEntryTree&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length?logImpression("create_zip_add_entries","create_zip","num_files_to_add: "+e.length):logImpression("create_zip_start_new","create_zip","num_files_to_add: "+e.length),this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP,s,o),this.addFilesToZipOrEncryptZipCancelRequested=!1;for(var p=[],a=0;a<e.length;a++){var l,h,d=e[a],E=d.fullPath||d.webkitRelativePath||d.relativePath||d.name,A=r?E:ze.App.sanitizeDriveFilename(E);null==this.zipEntryTree.children[A]&&(l=!!d.isDirectory,h={filename:A,lastModifiedDate:d.lastModifiedDate,uncompressedFileBlob:l?null:d,directory:l},p.push(h))}var c=this.zipEntryTree.originalEntries&&0==this.zipEntryTree.originalEntries.length;n&&(""!=this.zipFilenameInput.value&&this.zipFilenameInput.value!=ze.App.DEFAULT_ZIP_FILENAME||(this.zipFilenameInput.value=n.trim(),this.zipFilename=this.zipFilenameInput.value)),zeCreateZipLib.serializeZipFromEntries(this.zipEntryTree.originalEntries,this.zipBlob,p,bindFn(this.renderCreatedZip,this,!1,null,null,!1,t,p.length,void 0,c,i),bindFn(this.handleZipCreateError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipCreateError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,this.zipEntryTree.encryptionMode,this.getZipPasswordCharCodeByteArray())}},ze.App.prototype.checkAndHandleCreateOrEncryptZipFileCancelled=function(e){return!!this.addFilesToZipOrEncryptZipCancelRequested&&(e("Adding files to ZIP canceled",!0),!0)},ze.App.prototype.renderCreatedZip=function(e,t,i,r,s,n,o,p,a,l){logImpression("create_zip_success","create_zip"),this.numFilesRecentlyAdded=n,this.numFilesRecentlyRemoved=o;var h=bindFn(this.handlePostCreatedZipRenderActions,this,e,t,i,r,a);this.setAppState(ze.App.APP_STATE.FILES_ADDED_TO_ZIP,l,h,r,p),s||this.setAppState(ze.App.APP_STATE.ADD_OR_REMOVE_FILES_TO_ZIP_SESSION_DONE,r,n,o,p),this.createdZipSavedToDriveId=null,this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.openZipInDriveButton,!1),this.enableEl(this.openZipInDriveButton,!1)},ze.App.prototype.updateSaveZipAndDownloadZipButtonEnablementAfterZipEntryTreeRender=function(){var e=this.zipEntryTree&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length;this.enableEl(this.saveZipToDriveButton,e),this.enableEl(this.downloadZipButton,e),this.enableEl(this.extractButton,e)},ze.App.prototype.handlePostCreatedZipRenderActions=function(e,t,i,r,s){var n;t&&(n="Created ZIP file",i&&(n+=" from "+i),this.updateLabelsAndProgress(n),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS)),this.updateSaveZipAndDownloadZipButtonEnablementAfterZipEntryTreeRender(),this.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP,!1),t&&this.zipEntryTree.originalEntries&&1==this.zipEntryTree.originalEntries.length&&(this.zipEntryTree.originalEntries[0].driveFileId=t),e&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length&&this.previewItem(this.zipEntryTree.originalEntries[0],!0),r&&(this.updateLabelsAndProgress("Password set"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.LOCKED)),s&&s()},ze.App.prototype.refreshZipEntryTreeItemState=function(e,t){if(this.zipEntryTree&&(e?this.updateEntryState(this.zipEntryTree,e):this.updateZipEntryUi(this.zipEntryTree,t),this.zipEntryTree.originalEntries))for(var i=0;i<this.zipEntryTree.originalEntries.length;i++){var r=this.zipEntryTree.originalEntries[i];e?this.updateEntryState(r,e):this.updateZipEntryUi(r,t)}},ze.App.prototype.refreshZipEntryTreeIconsFromCurrentState=function(e,t){if(this.zipEntryTree.originalEntries)for(var i=0;i<this.zipEntryTree.originalEntries.length;i++)this.updateZipEntryUi(this.zipEntryTree.originalEntries[i],e,t)},ze.App.prototype.refreshZipEntryMissingDiskStatusFromCurrentState=function(e,t){var i=this.numExtraZipParts,r=this.zipPartsLoadedMask;if(this.zipEntryTree.originalEntries)for(var s=0;s<this.zipEntryTree.originalEntries.length;s++){var n,o,p=this.zipEntryTree.originalEntries[s];p.state==ze.App.ESTATE.ENTRY_DISK_MISSING&&(n=!1,0<i&&(null!=(o=p.diskNumberStart)&&o!=i&&1!=r[o]&&(n=!0)),n||(this.updateEntryState(p,ze.App.ESTATE.DEFAULT,void 0,void 0,!0),ze.App.updateEntryRowStyle(p,!0)))}},ze.App.prototype.maybeRemoveEntryFromZipInEditMode=function(e){var t,i;this.isSavingToDrive||this.isCurrentlyInJumpToZipOperation||this.appState!=ze.App.APP_STATE.ADDING_FILES_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED&&this.appState!=ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP&&(!this.isInZipEditMode||-1!=(i=(t=this.zipEntryTree.originalEntries).indexOf(e))&&(t.splice(i,1),this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=1,zeCreateZipLib.serializeZipFromEntries(t,this.zipBlob,[],bindFn(this.renderCreatedZip,this,!1,null,null,!1,!1,void 0,1,!1,void 0),bindFn(this.handleZipEncryptError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipEncryptError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,this.zipEntryTree.encryptionMode,this.getZipPasswordCharCodeByteArray())))},ze.App.prototype.handleZipCreateError=function(e,t){t?(logImpression("create_zip_canceled","create_zip"),this.setAppState(ze.App.APP_STATE.ZIP_CREATION_CANCELLED)):(logImpression("create_zip_error","create_zip","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_CREATION_ERROR,e)),this.showEl(this.doneEditingZipButton,!0)},ze.App.prototype.handleZipEncryptError=function(e,t){t?(this.setAppState(ze.App.APP_STATE.ZIP_ENCRYPTION_CANCELLED),logImpression("encrypt_zip_canceled","encrypt_zip")):(this.setAppState(ze.App.APP_STATE.ZIP_ENCRYPTION_ERROR,e),logImpression("encrypt_zip_error","encrypt_zip","error: "+e)),this.showEl(this.doneEditingZipButton,!0)},ze.App.prototype.handleZipCreateOrEncryptProgress=function(e,t){this.handleGenericMainProgress(e,t)},ze.App.prototype.previewItem=function(e,t){if(this.appState==ze.App.APP_STATE.PASSWORD_REQUIRED&&this.isElementShown(this.checkPasswordButton)){var i=0<this.zipPasswordInput.value.length?this.checkPasswordButton:this.zipPasswordInput;this.flashElement(i,"#d00000",2,100)}else if(this.appState==ze.App.APP_STATE.PASSWORD_INCORRECT&&this.isElementShown(this.zipPasswordInput))this.flashElement(this.zipPasswordInput,"#d00000",2,100);else if(this.appState!=ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED&&this.areAllStatesTerminal()&&!this.isSavingToDrive&&!this.isCurrentlyInJumpToZipOperation&&this.appState!=ze.App.APP_STATE.CHECKING_PASSWORD&&this.appState!=ze.App.APP_STATE.ADDING_FILES_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP&&this.appState!=ze.App.APP_STATE.DOWNLOADING_FILE_TO_ADD_TO_ZIP_FIRST_BYTE_TRANSFERRED&&this.appState!=ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP&&(this.isSessionAbortedForThePurposesOfPreview=!1,this.wasArchiveDecompressionProcessCancelled=!1,!e.directory)){if(e.error&&e.state!=ze.App.ESTATE.CANCELED&&e.state!=ze.App.ESTATE.UPLOAD_ABORTED&&e.state!=ze.App.ESTATE.DECOMPRESSION_CANCELED)return this.previewedEntry=e,this.configurePreviewForDisplay(e),void this.renderErrorPreview(e,e.error,e.message);if(e.state!=ze.App.ESTATE.ENTRY_DISK_MISSING){logImpression("preview_item","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDPREVIEW]=!0;var r=ze.App.getFileExtension(e.name).toLowerCase(),s=!0,n=null,o="";if(ze.App.isSystemFile(e.name,r,e.directory))o="nopreview-"+r,s=!1,n=bindFn(this.renderGenericPreview,this);else if(ze.App.isHiddenTextViewableDotFile(e.name,r))o="text-"+r,n=bindFn(this.renderTextPreview,this);else if(""===r)o="text-"+r,n=bindFn(this.renderTextPreview,this);else{var p=ze.App.getTypesMapKeyNameByExtension(r),a=ze.App.getPreviewableState(p,r);if(2==a)"pdf"==p?(o="pdf",n=bindFn(this.renderPdfPreview,this)):"archive"==p?o="archive-"+r:ze.App.isTextFileType(e.name,p)?(o="text-"+r,n=bindFn(this.renderTextPreview,this)):"image"==p?(o="image-"+r,n=bindFn(this.renderImagePreview,this)):"video"==p?(o="video-"+r,n=bindFn(this.renderVideoPreview,this)):"audio"==p&&(o="audio-"+r,n=bindFn(this.renderAudioPreview,this));else if(3==a)o="drive-"+r,s=!1,n=bindFn(this.renderDrivePreview,this);else{if(t)return;o="generic-"+r,s=!1,n=bindFn(this.renderGenericPreview,this)}}if(this.previewType=o,logImpression("preview_render","preview","renderer="+o),n)this.configurePreviewForDisplay(e),this.previewedEntry=e,s?this.decompressPreviewedBlob(e,bindFn(this.previewReadyForRender,this,n,e,!1),bindFn(this.previewDecompressionErrorOrCancel,this,e),bindFn(this.previewDecompressionProgressFunction,this,e,!0),bindFn(this.generalDecompressionCheckCancelFn,this)):this.previewReadyForRender(n,e,!1);else if(ze.App.startsWith(this.previewType,"archive")){if(this.isInZipEditMode)return;this.previewedEntry=e,this.isCurrentlyInJumpToZipOperation=!0,this.showEl(this.secondaryLabelLink,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.extractButton,!1),this.updateLabelsAndProgress("Opening "+e.name+"...","Decompressing..."),this.setProgressBarPercent(0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),ze.App.decompressArchiveEntry(this.zipBlob,e,!0,bindFn(this.jumpToZipSuccess,this,e),bindFn(this.jumpToZipErrorOrCancel,this,e),bindFn(this.handleJumpToZipDecompressProgress,this),bindFn(this.generalDecompressionCheckCancelFn,this),this.getZipPasswordCharCodeByteArray())}}else{this.previewedEntry=e,this.configurePreviewForDisplay(e);var l=e.diskNumberStart<=8?".z0"+(e.diskNumberStart+1):".z"+(e.diskNumberStart+1);this.renderErrorPreview(e,"Missing the ZIP part for this entry: "+ze.App.getBaseFilenameNoExtension(this.zipFilename)+l)}}},ze.App.prototype.configurePreviewForDisplay=function(e){this.configurePreviewHeader(e),this.configurePreviewForLoading(e),this.showEl(this.zipTable,!1),this.showEl(this.preview,!0)},ze.App.prototype.getZipPasswordCharCodeByteArray=function(){var e=[];try{for(var t=ze.App.isForTesting()?ze.App.getTestingPassword():this.zipPasswordInput.value,i=0;i<t.length;i++)e.push(255&t.charCodeAt(i))}catch(e){}return e},ze.App.prototype.jumpToZipSuccess=function(e,t){this.isCurrentlyInJumpToZipOperation=!1,this.closeSession(),this.closePreview(),this.readArchiveWithInferredMimetype(e.name,t)},ze.App.prototype.jumpToZipErrorOrCancel=function(e,t,i){i?logImpression("jump_to_zip_canceled","zip"):logImpression("jump_to_zip_error","zip","error: "+t),this.isCurrentlyInJumpToZipOperation=!1,this.setProgressBarPercent(100),i?(this.showEl(this.extractButton,!0),this.showEl(this.cancelButton,!1),this.updateLabelsForReadyToExtract()):(this.configurePreviewForDisplay(e),this.renderErrorPreview(e,t))},ze.App.prototype.previewDecompressionErrorOrCancel=function(e,t,i){var r=null!=e.compressionMethod?"Compression Method: "+e.compressionMethod+"; ":"";i?(logImpression("preview_render_canceled","preview"),logImpression(this.currentArchiveTypeString.toLowerCase(),"preview_decompress",r+"Canceled")):(logImpression("preview_render_error","preview","decompression error: "+t),logImpression(this.currentArchiveTypeString.toLowerCase(),"preview_decompress",r+"Error: "+t)),this.isPreviewDecompressing=!1,this.configurePreviewActionButtonsForWorkingOperation(!1),this.updatePreviewFilenameLabel(),i?(this.willSaveToDriveAfterDecompression||this.willDownloadAfterDecompression?this.setPreviewProgressBarPercent(0):this.closePreview(),this.wasPreviewDecompressionCancelled=!1,this.willDownloadAfterDecompression=!1,this.willSaveToDriveAfterDecompression=!1):(this.hideAllPreviewDivs(),this.renderErrorPreview(e,t))},ze.App.prototype.renderErrorPreview=function(e,t,i){this.showEl(this.previewErrorContent,!0),this.showEl(this.previewDownloadButton,!1),this.showEl(this.previewCloseButton,!0),this.showEl(this.previewNextButton,!0),this.showEl(this.previewPrevButton,!0),this.showEl(this.previewOpenInDriveButton,!1),this.showEl(this.previewSaveToDriveButton,!1),this.enableEl(this.previewNextButton,!0),this.enableEl(this.previewPrevButton,!0),this.setPreviewProgressBarPercent(100),this.previewErrorCaption.textContent="An error occurred when extracting this item from the "+this.currentArchiveTypeString+" file";var r=i||e.message,s=r?t+" ("+r+")":t;this.previewErrorDetails.textContent=s},ze.App.prototype.getBlobMimeTypeByExtension=function(e){return null!=e&&""!==e&&ze.App.EXTENSION_TO_MIMETYPE_MAP[e]||""},ze.App.prototype.previewReadyForRender=function(e,t,i){this.updatePreviewFilenameLabel(),this.showEl(this.previewDownloadButton,!0);var r=null!=t.driveFileId;this.configurePreviewActionButtonsForWorkingOperation(!1,!1,r),e(t,this.previewedBlob),i||this.handlePreviewRenderComplete()},ze.App.prototype.handlePreviewRenderComplete=function(){this.setPreviewProgressBarPercent(100)},ze.App.prototype.renderImagePreview=function(r,e){var s,t,i=window.URL||window.webkitURL,n=ze.App.getFileExtension(r.name),o=this;"svg"==n?((s=new FileReader).addEventListener("loadend",function(e){var t=s.result,i=(r.cachedObjectUrl=t).split(",")[1];o.previewImg.src="data:image/svg+xml;base64,"+i,o.showEl(o.previewImageContent,!0)}),s.readAsDataURL(e)):(t=i.createObjectURL(e),r.cachedObjectUrl=t,this.previewImg.src=t,this.showEl(this.previewImageContent,!0))},ze.App.prototype.renderTextPreview=function(s,e){var t=new FileReader,n=this;t.addEventListener("error",function(e){n.hideAllPreviewDivs();var t="",i="",i=e&&e.target&&e.target.error?(t=e.target.error.name,e.target.error.message):(t=e,"FileReader.readAsText() error");n.renderErrorPreview(s,t,i)}),t.addEventListener("loadend",function(e){var t,i,r;e&&e.target&&e.target.error||e&&e.srcElement&&e.srcElement.error||(t="",e.srcElement?t=e.srcElement.result:e.target&&(t=e.target.result),i=!1,r="",r=t&&2e4<t.length?(i=!0,t.substring(0,2e4)):t,n.previewTxt.textContent=r,n.showEl(n.previewTextContent,!0),n.previewTextContent.scrollTop=0,i&&ze.App.execLater(bindFn(n.handleSecondPhasePreviewTextLoad,n,t,s),void 0,500))});var i=2097152<e.size?e.slice(0,2097152):e;t.readAsText(i)},ze.App.prototype.handleSecondPhasePreviewTextLoad=function(e,t){var i;this.previewedEntry==t&&(i="",i=e&&524288<e.length?e.substring(0,524288)+"\n \n ------- PREVIEW TEXT WAS SHORTENED BY ZIP EXTRACTOR ------- ":e,this.previewTxt.textContent=i)},ze.App.prototype.renderPdfPreview=function(e,t){var i=window.URL||window.webkitURL,r=new Blob([t],{type:"application/pdf"}),s=i.createObjectURL(r);e.cachedObjectUrl=s,this.previewPdf.setAttribute("src",s),this.isPreviewPdfDirty=!0,this.showEl(this.previewPdfContent,!0)},ze.App.prototype.renderDrivePreview=function(e,t){var i=e.driveFileId;null==i?(isAuthorized()?this.showEl(this.previewSaveToDriveDetails,!1):this.showEl(this.previewSaveToDriveDetails,!0),this.showEl(this.previewDriveContent,!0),this.showEl(this.previewDriveSaveToDriveFirst,!0),this.previewDrv&&this.showEl(this.previewDrv,!1),this.handlePreviewRenderComplete(),this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0)):(this.showEl(this.previewDriveSaveToDriveFirst,!1),this.showEl(this.previewSaveToDriveDetails,!1),this.doEmbeddedDrivePreview(i),this.showEl(this.previewDriveContent,!0))},ze.App.prototype.doEmbeddedDrivePreview=function(e){this.showEl(this.previewSpinner,!0),this.showEl(this.previewItemIcon,!1),this.previewDrv?this.showEl(this.previewDrv,!0):(this.previewDrv=document.createElement("iframe"),this.previewDrv.className="previewDrv",this.previewDriveContent.appendChild(this.previewDrv)),this.previewDrv.onload=bindFn(this.previewDriveEmbeddedViewerLoaded,this),this.previewDrv.src="https://docs.google.com/file/d/"+e+"/preview?authuser="+CURRENT_AUTH_USER},ze.App.prototype.previewDriveEmbeddedViewerLoaded=function(e){this.handlePreviewRenderComplete(),this.showEl(this.previewOpenInDriveButton,!0),this.showEl(this.previewSaveToDriveButton,!1),this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0),this.previewDrv.onload=null},ze.App.prototype.renderVideoPreview=function(e,t){var i=(window.URL||window.webkitURL).createObjectURL(t);e.cachedObjectUrl=i,this.previewVid.src=i,this.showEl(this.previewVideoContent,!0)},ze.App.prototype.renderGenericPreview=function(e,t){this.noPreviewIcon.textContent=this.previewItemIconImg.textContent,this.showEl(this.previewGenericContent,!0)},ze.App.prototype.renderAudioPreview=function(e,t){var i=(window.URL||window.webkitURL).createObjectURL(t);e.cachedObjectUrl=i,this.previewAud.src=i,this.showEl(this.previewAudioContent,!0)},ze.App.prototype.configurePreviewHeader=function(e){this.previewItemFilename.textContent=e.name||"",this.updatePreviewFilenameLabel(),this.previewItemIconImg.textContent=ze.App.getMaterialIconIdForEntry(e),this.previewItemSize.textContent=ze.App.formatSize(e.uncompressedSize),this.previewItemFilename.innerHTML+=" <small>("+this.previewItemSize.textContent+")</small>"},ze.App.prototype.configurePreviewForLoading=function(e){this.setPreviewProgressBarPercent(0)},ze.App.prototype.previewDecompressionProgressFunction=function(e,t,i,r){this.handleGenericPreviewProgress(i,r,t,"Decompressing...")},ze.App.prototype.hideAllPreviewDivs=function(){this.showEl(this.previewTextContent,!1),this.showEl(this.previewImageContent,!1),this.showEl(this.previewVideoContent,!1),this.showEl(this.previewPdfContent,!1),this.showEl(this.previewAudioContent,!1),this.showEl(this.previewGenericContent,!1),this.showEl(this.previewErrorContent,!1),this.showEl(this.previewDriveContent,!1)},ze.App.prototype.resetPreview=function(){if(this.hideAllPreviewDivs(),this.clearAllPreviewObjects(),this.previewedEntry&&this.previewedEntry.cachedObjectUrl){var e=window.URL||window.webkitURL;try{e.revokeObjectURL(this.previewedEntry.cachedObjectUrl)}catch(e){logImpression("revokeObjectURL()","misc",e)}}this.previewedEntry=null,this.previewedBlob=null,this.previewType=null},ze.App.prototype.clearAllPreviewObjects=function(){this.previewTxt.textContent="",this.previewImg.src="",this.previewDrv&&(this.previewDrv.src="about:blank");try{var e;this.isPreviewPdfDirty&&(this.previewPdf.src="",this.previewPdf.removeAttribute("src"),(e=this.previewPdf.cloneNode(!0)).setAttribute("src",""),this.previewPdf.parentNode.replaceChild(e,this.previewPdf),this.previewPdf=e),this.isPreviewPdfDirty=!1}catch(e){}try{this.previewAud.pause();try{0!==this.previewAud.currentTime&&(this.previewAud.currentTime=0)}catch(e){}this.previewAud.src="",this.previewAud.removeAttribute("src")}catch(e){}try{this.previewVid.pause();try{0!==this.previewVid.currentTime&&(this.previewVid.currentTime=0)}catch(e){}this.previewVid.src="",this.previewVid.removeAttribute("src")}catch(e){}},ze.App.prototype.flashTimer=null,ze.App.prototype.flashElement=function(e,t,i,r,s,n){clearTimeout(this.flashTimer);var o=null!=s?s:e.style.backgroundColor,p=n||0,a=this;e.style.backgroundColor=p%2==0?t:o,++p<2*i&&(a.flashTimer=setTimeout(bindFn(a.flashElement,a,e,t,i,r,o,p),r))},ze.App.INDENT_PX=24,ze.App.BASE_INDENT_PX=0,ze.App.checkboxIdCounter=0,ze.App.UNCHECKED_COLOR="#888",ze.App.clearTable=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},ze.App.disableCheckboxesForChildren=function(e){for(var t in e.children){var i=e.children[t];ze.App.getCheckboxButtonForEntry(i).disabled=!0,i.directory&&ze.App.disableCheckboxesForChildren(i)}},ze.App.generateZipTable=function(e,t,i){ze.App.execLater(bindFn(ze.App.generateZipTableInternal,null,e,t),i)},ze.App.generateZipTableInternal=function(e,t){ze.App.generateZipTableChildren(e,t,0,0);var i=e.lastElementChild;i&&i.classList.add("lastZipTableRow")},ze.App.generateZipTableChildren=function(e,t,i,r){var s=MAINAPP.numExtraZipParts,n=MAINAPP.zipPartsLoadedMask;for(var o in t.children){var p,a=t.children[o],l=ze.App.generateFileTableRow(a,i);a.tableRow=l,a.tableRowIndex=r++,e.appendChild(l),a.error&&(MAINAPP.updateEntryState(a,ze.App.ESTATE.PARSE_ERROR,a.error),ze.App.updateEntryRowStyle(a,!1)),0<s&&(null!=(p=a.diskNumberStart)&&p!=s&&1!=n[p]&&(MAINAPP.updateEntryState(a,ze.App.ESTATE.ENTRY_DISK_MISSING),ze.App.updateEntryRowStyle(a,!1))),a.directory&&(r=ze.App.generateZipTableChildren(e,a,i+1,r))}return r},ze.App.handleRowClick=function(e,t){var i="";t&&t.target&&t.target.className&&(i=t.target.className),i.indexOf&&-1==i.indexOf("button")&&(-1==i.indexOf("zipStatusIcon")?-1==i.indexOf("icon")&&-1==i.indexOf("statusCell")&&ze.App.previewItem(e):"delete"==t.target.textContent&&ze.App.removeEntryFromZipInEditMode(e))},ze.App.removeEntryFromZipInEditMode=function(e){MAINAPP.maybeRemoveEntryFromZipInEditMode(e)},ze.App.openEntryInDrive=function(e){ze.App.openItemInDrive(e.driveFileId)},ze.App.openItemInDrive=function(e){var t="https://drive.google.com/open?id="+e,i=window.open(t,"_blank");i&&i.focus()},ze.App.previewItem=function(e){MAINAPP.previewItem(e)},ze.App.isEntryDownloadable=function(e){return!e.directory},ze.App.generateFileTableRow=function(i,e){var t=document.createElement("div");t.className=i.directory?"zipTableRow directoryRow":"zipTableRow",t.onclick=bindFn(ze.App.handleRowClick,this,i),t.entry=i;var r=document.createElement("div");t.appendChild(r),r.className=i.directory?"zipTableCell filenameCell directoryCell":"zipTableCell filenameCell";var s=document.createElement("div");t.appendChild(s),s.className="zipTableCell sizeCell";var n=document.createElement("div");t.appendChild(n),n.className="zipTableCell statusCell";var o=document.createElement("div");n.appendChild(o),o.className="statusCellIcon",o.hidden=!0;var p=document.createElement("i");o.appendChild(p),p.className="material-icons zipStatusIcon",p.tabIndex=0,p.textContent="add";var a=ze.App.createSpinner();n.appendChild(a);var l=ze.App.createMaterialCheckbox(!0);n.appendChild(l),l.onclick=function(e){var t=ze.App.isCheckboxIconButtonChecked(e.target);ze.App.setCheckboxIconButtonChecked(l,!t),ze.App.handleCheckboxClick(i,!t)},r.style.paddingLeft=ze.App.BASE_INDENT_PX+ze.App.INDENT_PX*e+"px";var h=document.createElement("div");h.className="tableRowName",h.textContent=i.name;var d=document.createElement("i");return r.appendChild(d),d.className="material-icons tableRowIcon",d.tabIndex=-1,d.textContent=ze.App.getMaterialIconIdForEntry(i),r.appendChild(h),i.directory||i.error?s.textContent="":s.textContent=ze.App.formatSize(i.uncompressedSize),t},ze.App.createSpinner=function(){var e=document.createElement("img");e.className="newSpinnerImg",e.tabIndex=-1,e.src="images/spinner-44.gif";var t=document.createElement("div");return t.hidden=!0,t.className="newSpinnerDiv",t.appendChild(e),t},ze.App.createMaterialCheckbox=function(e,t){var i=document.createElement("button");i.className="ze-button ze-icon-button ze-button--colored zipEntryCheckboxButton",t&&(i.id=t);var r=document.createElement("i");return r.className="material-icons ze-icon-button-icon ze-checkbox-button",i.appendChild(r),ze.App.setCheckboxIconButtonChecked(i,e),i},ze.App.getEntryStatusIconMaterialId=function(e,t,i){switch(e){case ze.App.ESTATE.DEFAULT:return t?"lock":"__";case ze.App.ESTATE.ADDED_TO_ZIP:return i?"delete":t?"lock":"check_circle_outline";case ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE:return"check_circle";case ze.App.ESTATE.QUEUED:return"cloud_queue";case ze.App.ESTATE.QUEUED_PENDING_RETRY:return"info_outline";case ze.App.ESTATE.REQUEUED_AFTER_ERROR:return"cloud_queue";case ze.App.ESTATE.SKIPPED:return"not_interested";case ze.App.ESTATE.PARSE_ERROR:case ze.App.ESTATE.ENTRY_DISK_MISSING:return"warning";case ze.App.ESTATE.PENDING:return"cloud_upload";case ze.App.ESTATE.WAITING:return"cloud";case ze.App.ESTATE.DECOMPRESSION_COMPLETE:return"filter_drama";case ze.App.ESTATE.BEGIN_UPLOAD:return"backup";case ze.App.ESTATE.UPLOAD_PROGRESS:return"cloud_upload";case ze.App.ESTATE.UPLOAD_ERROR:case ze.App.ESTATE.DECOMPRESSION_ERROR:return"warning";case ze.App.ESTATE.DECOMPRESSION_CANCELED:return"error_outline";case ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED:return"cached";case ze.App.ESTATE.UPLOAD_COMPLETE:return"cloud_done";case ze.App.ESTATE.CANCELED:case ze.App.ESTATE.UPLOAD_ABORTED:return"error_outline";default:return"add"}},ze.App.SIZE_BYTE_UNITS=["KB","MB","GB","TB"],ze.App.formatSize=function(e){if(null==e)return"? KB";if(0===e)return"0 KB";if(e<1e3)return e.toString()+" B";for(var t=0;t++,1024<(e/=1024););var i=Math.max(e,.1),r=1===t?Math.ceil(i):Math.round(i*Math.pow(10,1))/Math.pow(10,1);return r+" "+ze.App.SIZE_BYTE_UNITS[t-1]},ze.App.TYPES_MAP={image:{"*":"photo",bmp:2,jpg:2,jpeg:2,gif:2,png:2,webp:2,tif:3,tiff:3,svg:3,ico:2,heic:3,heif:3,raw:3,cr2:3,cr3:3,crw:3,nef:3,nrw:3,arw:3,srf:3,sr2:3,rw2:3,dcr:3,k25:3,kdc:3},text:{"*":"description",txt:2,rtf:2,htm:2,html:2,mhtml:2,mxml:2,xml:2,log:2,tex:2,cls:2,bak:2,rels:2,bat:2,stp:2,ini:2,inf:2,mbox:2,msg:2,lic:2,eml:2,text:2,latex:2,conf:2,smi:2,sub:2,srt:2,asc:2,lst:2,bas:2,reg:2,manifest:2,ascii:2,yml:2,eng:2,xsl:2,xslt:2,enc:2,ps1:2,ino:2,url:2,vcf:2,aux:2,toc:2,properties:2},code:{"*":"code",c:2,h:2,m:2,md:2,cc:2,cs:2,pl:2,pm:2,rb:2,sh:2,ts:2,tsx:2,js:2,css:2,scss:2,java:2,py:2,cpp:2,hpp:2,php:2,perl:2,ipynb:2,asp:2,aspx:2,jsp:2,json:2,yaml:2,bsh:2,csh:2,cyc:2,cv:2},csv:{"*":"grid_on",csv:2},video:{"*":"videocam",mp4:2,ogv:2,mpg:2,mpeg:2,mov:2,webm:2,m4v:2,mkv:2,"3gp":3,wmv:1,avi:3,flv:3},audio:{"*":"audiotrack",mp3:2,m4a:2,wav:2,flac:2,aac:2,mid:2,ogg:2,oga:2,opus:2,weba:2,aif:1,aiff:1},font:{"*":"font_download",ttf:3,otf:3},pdf:{"*":"picture_as_pdf",pdf:2,xps:3},drawing:{"*":"category",dwg:3,odg:3,eps:3,psd:3,ps:3,ai:3,dxf:3},archive:{"*":"business_center",zip:2,zipx:2,gz:2,whl:2,jar:2,tar:2,tgz:2,rar:2,bzip:2,bzip2:2,bz2:2,tbz:2,tbz2:2,lzma:2,tlz:2,lz:2,xz:2,txz:2,"7z":2},office:{"*":"assignment",ppt:3,pptx:3,pot:3,potx:3,potm:3,pps:3,ppsx:3,ppsm:3,pptm:3,thmx:1,doc:3,docm:3,docx:3,dot:3,dotx:3,dotm:3,xls:3,xlsx:3,xlt:3,xltx:3,xlsm:3,xltm:3,xlsb:1,xlam:1,xla:1,slk:1,odt:3,ods:3,odp:3},executable:{"*":"dns",exe:1,dll:1}},ze.App.TYPES_MAP_KEYS=Object.keys(ze.App.TYPES_MAP),ze.App.getMaterialIconIdForEntry=function(e){if(e.directory)return"folder";var t=e.name;if(!t)return"error_outline";var i=ze.App.getFileExtension(t);if(ze.App.startsWith(e.name,"._")||!i||""===i)return"insert_drive_file";var r=ze.App.getTypesMapEntryByExtension(i);return null!=r?r["*"]:"insert_drive_file"},ze.App.getPreviewableState=function(e,t){var i=ze.App.getTypesMapEntryByKeyName(e);return null!=i?i[t]:null},ze.App.getTypesMapEntryByKeyName=function(e){return null!=e?ze.App.TYPES_MAP[e]:null},ze.App.getTypesMapEntryByExtension=function(e){var t=ze.App.getTypesMapKeyNameByExtension(e);return ze.App.getTypesMapEntryByKeyName(t)},ze.App.getTypesMapKeyNameByExtension=function(e){for(var t=0;t<ze.App.TYPES_MAP_KEYS.length;t++)if(null!=ze.App.TYPES_MAP[ze.App.TYPES_MAP_KEYS[t]][e])return ze.App.TYPES_MAP_KEYS[t];return null},ze.App.setEntryChecked=function(e,t,i){var r=ze.App.getCheckboxButtonForEntry(e);ze.App.setCheckboxIconButtonChecked(r,t,i),ze.App.updateEntryRowStyle(e,t)},ze.App.setCheckboxIconButtonChecked=function(e,t,i){e.firstElementChild.textContent=t?i?"indeterminate_check_box":"check_box":"check_box_outline_blank"},ze.App.isCheckboxIconButtonChecked=function(e){var t="i"==e.tagName.toLowerCase()?e:e.firstElementChild;return"check_box"==t.textContent||"indeterminate_check_box"==t.textContent},ze.App.updateEntryRowStyle=function(e,t){e.tableRow.style.color=t?"inherit":ze.App.UNCHECKED_COLOR;var i=!(e.state==ze.App.ESTATE.PARSE_ERROR)&&!t;this.getFilenameCell(e).style.textDecoration=i?"line-through":"inherit"},ze.App.handleCheckboxClick=function(e,t){ze.App.updateEntryRowStyle(e,t),ze.App.setParentEntriesCheckState(e,!0,!0),!t&&e.directory&&ze.App.setChildEntriesCheckState(e,!1)},ze.App.setChildEntriesCheckState=function(e,t){for(var i in e.children){var r=e.children[i];r.error||ze.App.setEntryChecked(r,t),r.directory&&ze.App.setChildEntriesCheckState(r,t)}},ze.App.setParentEntriesCheckState=function(e,t){var i=e.parentEntry;i&&!i.root&&(ze.App.setEntryChecked(i,t),ze.App.setParentEntriesCheckState(i,t))},ze.App.getCheckboxButtonForEntry=function(e){return e.tableRow.children[2].children[2]},ze.App.isChecked=function(e){return ze.App.isCheckboxIconButtonChecked(ze.App.getCheckboxButtonForEntry(e))},ze.App.translateEntryState=function(e,t){switch(e){case ze.App.ESTATE.QUEUED:return"Queued";case ze.App.ESTATE.QUEUED_PENDING_RETRY:return"Queued (Pending resolution of error on parent folder)";case ze.App.ESTATE.SKIPPED:return"Skipped";case ze.App.ESTATE.PARSE_ERROR:return"Parse Error";case ze.App.ESTATE.ENTRY_DISK_MISSING:return"Entry Disk Missing";case ze.App.ESTATE.PENDING:return"Pending creation of parent folder";case ze.App.ESTATE.WAITING:return"Waiting";case ze.App.ESTATE.BEGIN_DECOMPRESSION:case ze.App.ESTATE.DECOMPRESSION_PROGRESS:return"Decompressing File...";case ze.App.ESTATE.DECOMPRESSION_COMPLETE:return"Decompressed File";case ze.App.ESTATE.BEGIN_UPLOAD:case ze.App.ESTATE.UPLOAD_PROGRESS:return"Extracting to Google Drive...";case ze.App.ESTATE.UPLOAD_ERROR:return"Extraction to Drive Error ("+t.message+")";case ze.App.ESTATE.DECOMPRESSION_ERROR:return"Decompression Error ("+t.message+")";case ze.App.ESTATE.DECOMPRESSION_CANCELED:return"Decompression Canceled";case ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED:return"Finishing...";case ze.App.ESTATE.UPLOAD_COMPLETE:return"Extracted to Google Drive";case ze.App.ESTATE.CANCELED:return"Canceled";case ze.App.ESTATE.UPLOAD_ABORTED:return"Aborted";default:return""}},ze.App.getFilenameCell=function(e){return e.tableRow.children[0].children[1]},ze.App.getIconCell=function(e){return e.tableRow.children[0].children[0]},ze.App.prototype.executeSession=function(e){e&&(this.sessionHasBeenRetried=!0),this.isPreviewDecompressing=!1,this.wasPreviewDecompressionCancelled=!1,this.isSessionAborted=!1,this.isSessionAbortedForThePurposesOfPreview=!1,this.highestZipEntryIndexUploadedInSession=0,this.fileTableContainer.scrollTop=0,this.queueEntry(this.zipEntryTree),this.queueEntryChildren(this.zipEntryTree),this.currentSessionProgress=0,this.totalSessionSize=ze.App.computeSessionSize(this.zipEntryTree),this.updateSecondaryProgressString(),this.asyncWorkQueue=new ze.AsyncWorkQueue(ze.App.MAX_WORKQUEUE_WORKERS),ze.App.entryIsUploadable(this.zipEntryTree)?(this.asyncWorkQueue.enqueue(this.generateWorkItem(this.zipEntryTree,this.parentFolderId)),this.updateEntryState(this.zipEntryTree,ze.App.ESTATE.PENDING),this.runWorkQueue()):this.processEntryTreeChildren(this.zipEntryTree,this.zipEntryTree.driveFileId,e)},ze.App.prototype.abortSession=function(){this.isSessionAborted=!0,this.isSessionAbortedForThePurposesOfPreview=!0,this.asyncWorkQueue.stop(),ze.Dapi.abortAllRequests(),this.cancelAllUnstartedEntries(),this.checkForExtractionComplete()},ze.App.prototype.closeSession=function(e){this.isSessionClosed,ze.App.resetPageTitle(),this.asyncWorkQueue.close(),this.zipEntryStateMap={},this.zipEntriesInProcessMap={},this.totalSessionSize=0,this.currentSessionProgress=0,this.isSessionClosed=!0,this.highestZipEntryIndexUploadedInSession=0,this.isInZipEditMode=!1,this.wasZipFileCreatedLocally=!1,this.zipFilename=null,this.zipFileSize=null,this.zipMimeType=null,this.isTarFile=!1,this.extraZipPartsMap={},this.numExtraZipParts=0,this.zipPartsLoadedMask=[],this.zipEntryTree=null,this.zipBlob=null,this.zipBlobSource=null,this.currentArchiveHeaderIsEncrypted=!1,this.lastDownloadId=null,this.hasDownloadBeenAutoRetried=!1,this.isSessionAborted=!1,this.fileIdToOpen=null,this.parentFolderId=null,this.createdZipSavedToDriveId=null,this.isSavingToDrive=!1,this.wasSaveToDriveCancelled=!1,this.wasArchiveDecompressionProcessCancelled=!1,this.wasCheckPasswordCancelled=!1,this.willSaveToDriveAfterDecompression=!1,this.willDownloadAfterDecompression=!1,this.isPreviewDecompressing=!1,this.isCurrentlyInJumpToZipOperation=!1,this.wasPreviewDecompressionCancelled=!1,this.addFilesToZipOrEncryptZipCancelRequested=!1,this.numFilesRecentlyAdded=null,this.numFilesRecentlyRemoved=null,this.cachedMistypedZipImageUri&&(this.fileTableAlternateImageImg.src=""),this.cachedMistypedZipImageUri=null,this.setResumeFlags(!1,!1,!1,!1,!1,!1),this.createZipFromFileAssociatedExtension=null,this.currentAutodetectedEncoding=null,clearState(),ze.App.clearTable(this.fileTableItems),this.startNewManualSession(e)},ze.App.prototype.processEntryTreeChildren=function(e,t,i){for(var r in e.children){var s=e.children[r];this.isSessionAborted?this.updateEntryState(s,ze.App.ESTATE.CANCELED):ze.App.entryIsUploadable(s)?(this.asyncWorkQueue.enqueue(this.generateWorkItem(s,t)),this.updateEntryState(s,ze.App.ESTATE.PENDING)):s.directory&&s.state==ze.App.ESTATE.UPLOAD_COMPLETE&&this.processEntryTreeChildren(s,s.folder.id,i)}this.isSessionAborted||this.runWorkQueue()},ze.App.computeSessionSize=function(e){return ze.App.getEntrySize(e)+ze.App.computeChildEntriesSize(e)},ze.App.computeChildEntriesSize=function(e){var t=0;for(var i in e.children){var r=e.children[i];t+=ze.App.getEntrySize(r)+(r.directory?ze.App.computeChildEntriesSize(r):0)}return t},ze.App.getEntrySize=function(e){if(ze.App.entryIsUploadable(e)){return(e.directory?0:null==e.uncompressedSize?2*e.compressedSize:e.uncompressedSize)+ze.App.ENTRY_OVERHEAD_BYTES}return 0},ze.App.prototype.queueEntry=function(e){var t=this.isTableEntrySelected(e),i="";e.state==ze.App.ESTATE.DEFAULT||e.state==ze.App.ESTATE.CANCELED||e.state==ze.App.ESTATE.DECOMPRESSION_CANCELED||e.state==ze.App.ESTATE.UPLOAD_ABORTED||e.state==ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE||e.state==ze.App.ESTATE.ADDED_TO_ZIP?(i=t?ze.App.ESTATE.QUEUED:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,i)):e.state==ze.App.ESTATE.UPLOAD_ERROR?(i=t?ze.App.ESTATE.REQUEUED_AFTER_ERROR:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,i)):e.state==ze.App.ESTATE.REQUEUED_AFTER_ERROR&&(i=t?ze.App.ESTATE.QUEUED:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,i))},ze.App.prototype.queueEntryChildren=function(e){for(var t in e.children){var i=e.children[t];this.queueEntry(i),i.directory&&this.queueEntryChildren(i)}},ze.App.prototype.cancelAllUnstartedEntries=function(){this.cancelUnstartedEntry(this.zipEntryTree),this.cancelUnstartedChildEntries(this.zipEntryTree)},ze.App.prototype.cancelUnstartedEntry=function(e){ze.App.entryIsTerminal(e)||ze.App.entryIsInProgress(e)||this.updateEntryState(e,ze.App.ESTATE.CANCELED)},ze.App.prototype.cancelUnstartedChildEntries=function(e){for(var t in e.children){var i=e.children[t];this.cancelUnstartedEntry(i),i.directory&&this.cancelUnstartedChildEntries(i)}},ze.App.prototype.runWorkQueue=function(){this.asyncWorkQueue.run(bindFn(this.workQueueExecutionComplete,this))},ze.App.prototype.updateEntryState=function(e,t,i,r,s){e.error=i||"",e.message=r||"",this.updateZipEntryStateMap(e,t),e.state=t,this.updateZipEntryUi(e,s)},ze.App.prototype.incrementSessionProgress=function(e,t){return this.isSessionAborted?-1:(this.currentSessionProgress+=t,this.handleProgress(this.currentSessionProgress,this.totalSessionSize))},ze.App.prototype.updateZipEntryStateMap=function(e,t){var i=e.state,r=e.path,s=this.zipEntryStateMap[t];s||(s={},this.zipEntryStateMap[t]=s),s[r]=e;var n=this.zipEntryStateMap[i];n&&n.hasOwnProperty(r)&&delete n[r],ze.App.isTerminalState(t)?delete this.zipEntriesInProcessMap[r]:this.zipEntriesInProcessMap[r]=e},ze.App.prototype.areAllStatesTerminal=function(){return 0===Object.keys(this.zipEntriesInProcessMap).length},ze.App.entryIsTerminal=function(e){return ze.App.isTerminalState(e.state)},ze.App.isTerminalState=function(e){return e==ze.App.ESTATE.UPLOAD_COMPLETE||e==ze.App.ESTATE.UPLOAD_ERROR||e==ze.App.ESTATE.DECOMPRESSION_ERROR||e==ze.App.ESTATE.DECOMPRESSION_CANCELED||e==ze.App.ESTATE.SKIPPED||e==ze.App.ESTATE.CANCELED||e==ze.App.ESTATE.QUEUED_PENDING_RETRY||e==ze.App.ESTATE.UPLOAD_ABORTED||e==ze.App.ESTATE.ADDED_TO_ZIP||e==ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE||e==ze.App.ESTATE.DEFAULT||e==ze.App.ESTATE.PARSE_ERROR||e==ze.App.ESTATE.ENTRY_DISK_MISSING},ze.App.entryIsUploadable=function(e){var t=e.state;return t==ze.App.ESTATE.QUEUED||t==ze.App.ESTATE.QUEUED_PENDING_RETRY||t==ze.App.ESTATE.REQUEUED_AFTER_ERROR||t==ze.App.ESTATE.UPLOAD_ERROR},ze.App.entryIsCanceled=function(e){var t=e.state;return t==ze.App.ESTATE.CANCELED||t==ze.App.ESTATE.UPLOAD_ABORTED||t==ze.App.ESTATE.DECOMPRESSION_CANCELED},ze.App.entryIsInProgress=function(e){var t=e.state;return t==ze.App.ESTATE.BEGIN_UPLOAD||t==ze.App.ESTATE.UPLOAD_PROGRESS||t==ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED},ze.App.prototype.generateWorkItem=function(e,t){e.parentId=t;var i=e.directory?this.processFolder:this.processFile;return bindFn(i,this,e,t)},ze.App.prototype.processFolder=function(e,t,i){if(this.isSessionAborted)this.updateEntryState(e,ze.App.ESTATE.CANCELED);else{if(e.uploadPrev=0,e.uploadCurrent=0,e.uploadTotal=0,this.updateEntryState(e,ze.App.ESTATE.BEGIN_UPLOAD),ze.App.isForTesting()){var r={};return r.name="test folder name: "+e.name,r.id="test folder id "+Math.random(),void this.folderInsertComplete(e,i,bindFn(this.processEntryTreeChildren,this,e),r)}var s=ze.Dapi.generateCallbacks(bindFn(this.folderInsertComplete,this,e,i,bindFn(this.processEntryTreeChildren,this,e)),bindFn(this.folderInsertError,this,e,i),void 0,bindFn(this.folderInsertAborted,this,e,i));ze.Dapi.createFolder(s,e.name,t)}},ze.App.prototype.processFile=function(e,t,i){this.isSessionAborted?this.updateEntryState(e,ze.App.ESTATE.CANCELED):(e.decompressionPrev=0,e.decompressionCurrent=0,e.decompressionTotal=0,e.uploadPrev=0,e.uploadCurrent=0,e.uploadTotal=0,this.updateEntryState(e,ze.App.ESTATE.BEGIN_DECOMPRESSION),ze.App.decompressArchiveEntry(this.zipBlob,e,!0,bindFn(this.decompressionComplete,this,e,t,i),bindFn(this.uploadDecompressionErrorOrCancel,this,e,i),bindFn(this.handleDecompressionProgress,this,e),bindFn(this.generalDecompressionCheckCancelFn,this),this.getZipPasswordCharCodeByteArray()))},ze.App.prototype.uploadDecompressionErrorOrCancel=function(e,t,i,r){var s=null!=e.compressionMethod?"Compression Method: "+e.compressionMethod+"; ":"";r?(logImpression(this.currentArchiveTypeString.toLowerCase(),"extract_decompress",s+"Canceled"),this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_CANCELED,"Decompression Canceled")):(logImpression(this.currentArchiveTypeString.toLowerCase(),"extract_decompress",s+"Error: "+i),this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_ERROR,"Decompression Error",i));var n=null!=e.uncompressedSize?e.uncompressedSize:2*e.compressedSize;this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*n),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),t(),this.checkForExtractionComplete()},ze.App.prototype.handleDecompressionProgress=function(e,t,i){this.isSessionAborted||(e.decompressionPrev=e.decompressionCurrent?e.decompressionCurrent:0,e.decompressionCurrent=t,e.decompressionTotal=i)},ze.App.prototype.decompressionComplete=function(e,t,i,r){if(this.isSessionAborted)return this.updateEntryState(e,ze.App.ESTATE.CANCELED),void this.checkForExtractionComplete();this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_COMPLETE),this.uploadFile(e,t,r,i)},ze.App.prototype.uploadFile=function(e,t,i,r){if(this.isSessionAborted)return this.updateEntryState(e,ze.App.ESTATE.CANCELED),void this.checkForExtractionComplete();if(this.updateEntryState(e,ze.App.ESTATE.BEGIN_UPLOAD),ze.App.isForTesting()){var s={};return s.name="test filename: "+e.name,s.id="test random id: id-"+Math.random(),void this.fileUploadComplete(e,r,s)}!e.directory&&e.tableRowIndex>this.highestZipEntryIndexUploadedInSession&&(this.highestZipEntryIndexUploadedInSession=e.tableRowIndex,e.tableRow.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}));var n=ze.Dapi.generateCallbacks(bindFn(this.fileUploadComplete,this,e,r),bindFn(this.fileUploadError,this,e,r),bindFn(this.fileUploadProgress,this,e),bindFn(this.fileUploadAborted,this,e,r));ze.Dapi.uploadFile(n,e.name,i,t)},ze.App.prototype.fileUploadComplete=function(e,t,i){e.file=i,e.driveFileId=i.id,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_COMPLETE),this.updateUiForFileComplete(e),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES);var r=this.handleProgress(this.currentSessionProgress,this.totalSessionSize);this.updateSecondaryProgressString(r),t(),this.checkForExtractionComplete()},ze.App.prototype.maybeRefreshCredentials=function(e){e!=ze.Dapi.ErrType.AUTH_ERROR&&401!=e||authorize(!0,void 0,void 0,void 0,CURRENT_AUTH_USER,!1,"maybeRefreshCredentials")},ze.App.prototype.fileUploadError=function(e,t,i,r){logImpression("upload_file","save_to_drive","error: "+i),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*e.uncompressedSize),this.updateSecondaryProgressString(),this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ERROR,i,r),t(),this.checkForExtractionComplete(),this.maybeRefreshCredentials(i)},ze.App.prototype.fileUploadAborted=function(e,t,i){logImpression("upload_file","save_to_drive","aborted"),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString();this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ABORTED,"Upload Aborted",i),t(),this.checkForExtractionComplete()},ze.App.prototype.fileUploadProgress=function(e,t,i){var r,s,n;this.isSessionAborted||(e.uploadPrev=e.uploadCurrent?e.uploadCurrent:0,e.uploadCurrent=t,e.uploadTotal=i,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_PROGRESS),t===i&&this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED),r=e.uploadCurrent-e.uploadPrev,s=e.uncompressedSize/i*r,n=this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*s),this.updateSecondaryProgressString(n))},ze.App.prototype.folderInsertComplete=function(e,t,i,r){e.folder=r,e.driveFileId=r.id,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_COMPLETE),this.updateUiForFileComplete(e);var s=this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES);this.updateSecondaryProgressString(s),i(r.id),t(),this.isSessionAborted&&this.checkForExtractionComplete()},ze.App.prototype.folderInsertError=function(e,t,i,r){logImpression("create_folder","save_to_drive","error: "+i),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString(),this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ERROR,i,r),this.setAllChildEntriesQueuedPendingRetry(e),t(),this.checkForExtractionComplete(),this.maybeRefreshCredentials(i)},ze.App.prototype.folderInsertAborted=function(e,t,i){logImpression("create_folder","save_to_drive","aborted"),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString();this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ABORTED,"Folder Create Aborted",i),this.cancelAllChildEntries(e),t(),this.checkForExtractionComplete()},ze.App.prototype.cancelAllChildEntries=function(e){for(var t in e.children){var i=e.children[t];this.updateEntryState(i,ze.App.ESTATE.CANCELED),i.directory&&this.cancelAllChildEntries(i)}},ze.App.prototype.setAllChildEntriesQueuedPendingRetry=function(e){for(var t in e.children){var i=e.children[t];i.state!=ze.App.ESTATE.SKIPPED&&i.state!=ze.App.ESTATE.PARSE_ERROR&&i.state!=ze.App.ESTATE.ENTRY_DISK_MISSING&&(this.updateEntryState(i,ze.App.ESTATE.QUEUED_PENDING_RETRY),this.incrementSessionProgress(i,ze.App.ENTRY_OVERHEAD_BYTES),i.directory&&this.setAllChildEntriesQueuedPendingRetry(i))}},ze.App.prototype.workQueueExecutionComplete=function(){this.checkForExtractionComplete()},ze.App.prototype.checkForExtractionComplete=function(){this.areAllStatesTerminal()&&this.appState!=ze.App.APP_STATE.COMPLETE_WITH_ERRORS&&this.appState!=ze.App.APP_STATE.EXTRACTION_COMPLETE&&this.handleExtractionComplete(this.isSessionAborted)},ze.App.prototype.updateZipEntryUi=function(e,t,i){if(e.root)return t?(this.showEl(this.selectAllCheckbox,!0),this.showEl(this.rootStatusSpinner,!1),void this.showEl(this.rootStatusIconContainer,!1)):void this.updateRootEntryUi(e,e.isEncrypted);var r=e.state,s=e.tableRow;if(s||e.zipTreeEntry&&(s=e.zipTreeEntry.tableRow),s){var n=s.children[2],o=n.children[0],p=o.children[0],a=n.children[1],l=n.children[2];if(t&&r!=ze.App.ESTATE.PARSE_ERROR&&r!=ze.App.ESTATE.ENTRY_DISK_MISSING)return this.showEl(o,!1),this.showEl(a,!1),void this.showEl(l,!0);var h,d=i||this.isInZipEditMode&&ze.App.ESTATE.ADDED_TO_ZIP;n.children[0].children[0].style.cursor=d?"pointer":"default",r==ze.App.ESTATE.BEGIN_DECOMPRESSION?(this.showEl(o,!1),this.showEl(a,!0),this.showEl(l,!1),a.title="Decompressing file..."):r==ze.App.ESTATE.DECOMPRESSION_PROGRESS||(r==ze.App.ESTATE.BEGIN_UPLOAD?(this.showEl(o,!1),this.showEl(a,!0),this.showEl(l,!1),a.title="Extracting file to Google Drive..."):r==ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED||r==ze.App.ESTATE.UPLOAD_PROGRESS||(h=ze.App.getEntryStatusIconMaterialId(r,e.isEncrypted,this.isInZipEditMode),p.style.color="warning"==h||"error_outline"==h?"#d00000":"lock"==h?"#DCA93B":"",h=h||"whatshot",p.textContent=h,this.showEl(o,!0),this.showEl(a,!1),this.showEl(l,!1),p.title=ze.App.translateEntryState(r,e)))}},ze.App.prototype.updateRootEntryUi=function(e,t){var i,r;e.state==ze.App.ESTATE.BEGIN_UPLOAD?(this.showEl(this.rootStatusSpinner,!0),this.showEl(this.rootStatusIconContainer,!1)):(i=this.rootStatusIcon,r=ze.App.getEntryStatusIconMaterialId(e.state,t,!1),i.style.color="warning"==r||"error_outline"==r?"#d00000":"lock"==r?"#DCA93B":"",r=r||"whatshot",i.textContent=r,this.showEl(this.rootStatusSpinner,!1),this.showEl(this.rootStatusIconContainer,!0)),this.showEl(this.selectAllCheckbox,!1)},ze.App.prototype.sendFeedbackEmail=function(){var e="mailto:feedback@zipextractor.app?subject=ZIP Extractor Feedback&body="+this.generateFeedbackEmailInformation();window.open(e)},ze.App.prototype.generateFeedbackEmailInformation=function(){var e="* ZIP Extractor version: "+ze.VERSION+"%0D%0A",t="* Current app status: "+this.mainLabel.textContent+"%0D%0A* Additional details: "+this.secondaryLabel.textContent+"%0D%0A",i=this.getFirstErrorInfo();i&&(t+="* Error information: "+i+"%0D%0A");return"Hello ZIP Extractor developers, here is some feedback for you.%0D%0A%0D%0AApp Information: %0D%0A============================================= %0D%0A"+e+t+"%0D%0AAdditional Feedback: %0D%0A============================================= %0D%0A%0D%0A%0D%0A "},ze.App.showPicker=function(e,t,i,r,s,n,o){var p={callback:bindFn(ze.App.showPickerInternal,window,e,t,i,r,s,n,o)};gapi.load("picker",p)},ze.App.showPickerInternal=function(e,t,i,r,s,n,o){t?ze.App.showFolderPicker(bindFn(ze.App.pickerFileChosenInternalCallback,window,!!n,e)):ze.App.showFilePicker(bindFn(ze.App.pickerFileChosenInternalCallback,window,!!n,e),i,r,s,n,o)},ze.App.pickerFileChosenInternalCallback=function(e,t,i){i.action==google.picker.Action.PICKED?i.docs&&0<i.docs.length?(logImpression("show_file_picker","picker","file_picked"),t(e?i.docs:i.docs[0])):logImpression("show_file_picker","picker","no_file_picked_in_data"):logImpression("show_file_picker","picker","other_data_action: "+i.action)},ze.App.pickerFolderChosenInternalCallback=function(e,t){t.action==google.picker.Action.PICKED?t.docs&&0<t.docs.length?(logImpression("show_folder_picker","picker","folder_picked"),e(t.docs[0])):logImpression("show_folder_picker","picker","no_folder_picked_in_data"):logImpression("show_folder_picker","picker","other_data_action: "+t.action)},ze.App.showFilePicker=function(e,t,i,r,s,n){logImpression("show_file_picker","picker","show");var o=ze.App.SUPPORTED_MIME_TYPES.join(","),p=new google.picker.DocsView(google.picker.ViewId.DOCS).setSelectFolderEnabled(!1).setIncludeFolders(!1).setMode(google.picker.DocsViewMode.LIST);n&&p.setQuery('title:"'+n+'"'),r||p.setMimeTypes(o),t&&p.setParent(t);var a=i||"Open ZIP file from Google Drive",l=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(APP_CONFIG.appId).setOAuthToken(getAccessToken()).setDeveloperKey(APP_CONFIG.apiKey).setCallback(e).addView(p).setTitle(a);s&&l.enableFeature(google.picker.Feature.MULTISELECT_ENABLED),l.build().setVisible(!0)},ze.App.showFolderPicker=function(e){logImpression("show_folder_picker","picker","show");var t=new google.picker.DocsView(google.picker.ViewId.DOCS).setSelectFolderEnabled(!0).setIncludeFolders(!0).setMode(google.picker.DocsViewMode.LIST).setMimeTypes(ze.Dapi.MimeType.FOLDER),i="phone"==detectDevice()?"Select a Google Drive folder":"Select a Google Drive folder for extracted files";(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(APP_CONFIG.appId).setOAuthToken(getAccessToken()).setDeveloperKey(APP_CONFIG.apiKey).setCallback(e).addView(t).setTitle(i).build().setVisible(!0)},ze.App.getStringFromBytes=function(e,t,i,r){for(var s="",n=null!=t?t:0,o=null!=i?i:e.length,p=n;p<o;p++)s+=String.fromCharCode(e[p]),r&&127<e[p]&&(r.hasExtendedChar=!0);return s},ze.App.isExportableGoogleDocsMimeType=function(e){if(ze.App.isGoogleAppsMimeType(e)){var t=ze.App.stringSuffixAt(e,28);return-1!=ze.App.SUPPORTED_GOOGLE_DOCS_EXPORT_TYPES.indexOf(t)}return!1},ze.App.isGoogleAppsMimeType=function(e){return ze.App.startsWith(e,"application/vnd.google-apps.")},ze.App.isSupportedArchiveType=function(e,t){var i=ze.App.getFileExtension(e.toLowerCase());return!!(i&&""!=i&&-1!=ze.App.SUPPORTED_ARCHIVE_EXTENSIONS.indexOf(i))||!!t&&-1!=ze.App.SUPPORTED_MIME_TYPES.indexOf(t)},ze.App.inferArchiveMimetypeFromMagicBlobAsync=function(e,i,t){e.size<5?i(null):ze.App.blobToByteArrayAsync(e,0,5,function(e){var t=ze.App.inferArchiveMimetypeFromMagicBytes(e);i(t)},t)},ze.App.inferArchiveMimetypeFromMagicBytes=function(e){return 80==e[0]&&75==e[1]?ze.App.CANONICAL_MIME_TYPES.ZIP:31==e[0]&&139==e[1]?ze.App.CANONICAL_MIME_TYPES.GZIP:253==e[0]&&55==e[1]&&122==e[2]?ze.App.CANONICAL_MIME_TYPES.XZ:55==e[0]&&122==e[1]&&188==e[2]&&175==e[3]?ze.App.CANONICAL_MIME_TYPES.SEVENZIP:82==e[0]&&97==e[1]&&114==e[2]&&33==e[3]&&26==e[4]?ze.App.CANONICAL_MIME_TYPES.RAR:66==e[0]&&90==e[1]&&104==e[2]?ze.App.CANONICAL_MIME_TYPES.BZIP:76==e[0]&&90==e[1]&&73==e[2]&&80==e[3]&&1==e[4]?ze.App.CANONICAL_MIME_TYPES.LZIP:137==e[0]&&80==e[1]&&78==e[2]&&71==e[3]&&13==e[4]?ze.App.CANONICAL_MIME_TYPES.PNG:255==e[0]&&216==e[1]?ze.App.CANONICAL_MIME_TYPES.JPG:71==e[0]&&73==e[1]&&70==e[2]&&56==e[3]?ze.App.CANONICAL_MIME_TYPES.GIF:66==e[0]&&77==e[1]?ze.App.CANONICAL_MIME_TYPES.BMP:37==e[0]&&80==e[1]&&68==e[2]&&70==e[3]?ze.App.CANONICAL_MIME_TYPES.PDF:null},ze.App.postProcessEntryFilenameAndMaybeSkip=function(e,t){var i=!1;return null==e.filename&&(e.filename=""),e.filename=e.filename.replace(/\\/g,"/"),null!=e.filename&&""!=e.filename&&"/"!=e.filename&&"./"!=e.filename&&"."!=e.filename&&".."!=e.filename||(e.directory||0==e.uncompressedSize?i=!0:e.filename="(No name "+t+")"),ze.App.startsWith(e.filename,"./")?e.filename=e.filename.substring(2):ze.App.startsWith(e.filename,"/")&&(e.filename=e.filename.substring(1)),ze.App.isSystemFile(e.filename,null,e.directory)&&(i=!0),i},ze.App.getErrorDetailsFromErrorObject=function(e){var t="";return e&&(t+=e.stack),t},ze.App.getParentIdOfDownloadedFile=function(e){var t=e.parents;return t&&0<t.length?t[0]:null},ze.App.blobToString=function(e,t,i,r,s){var n=null!=t?t:0,o=null!=i?i:e.size;ze.App.blobToByteArrayAsync(e,n,o,function(e){r(ze.App.getStringFromBytes(e))},s)},ze.App.blobToDataViewAsync=function(e,t,i,r,s){ze.App.blobToArrayLikeAsync(!0,e,t,i,r,s)},ze.App.blobToByteArrayAsync=function(e,t,i,r,s){ze.App.blobToArrayLikeAsync(!1,e,t,i,r,s)},ze.App.blobToArrayLikeAsync=function(i,e,t,r,s,n){var o,p=new FileReader;p.onload=function(e){try{var t=e.target.result;null==t&&(t=p.result),s(new(i?DataView:Uint8Array)(t))}catch(e){n(e)}},p.onerror=function(){var e=p.error;n(e)},0==t&&r==e.size?p.readAsArrayBuffer(e):(o=e.slice(t,r),p.readAsArrayBuffer(o))},ze.App.decompressArchiveEntry=function(t,r,i,s,n,o,p,a,l){if("7z"==r.type)try{zeSevenZLib.getDecodedBlobForEntry(t,r,s,n,o,p,a,!0)}catch(e){return void n("7z Entry Decompress Error: "+e)}else if("tar"==r.type){var e=null;try{e=t.slice(r.offset+ze.TarLib.TAR_HEADER_SIZE,r.offset+ze.TarLib.TAR_HEADER_SIZE+r.compressedSize),s(e)}catch(e){return void n("TAR Slice Error: "+e)}}else if("rar"==r.type){if(r.isEncrypted&&(null==a||0==a.length))return void n("RAR file is password protected but no password was provided");ze.RarLib.decompressRarEntry(r.originalRarLibEntry,a,s,n,o,p)}else if("bzip"==r.type)ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_BZIP_SCRIPT_NAME),ze.App.CHUNK_SIZE_BZIP,t,r.offset,r.compressedSize,r.uncompressedSize,r.crc32,function(e){var t=0;if(null!=e.size)t=e.size;else for(var i=0;i<e.length;i++)t+=e[i].length;r.uncompressedSize=t,s(e)},n,null,void 0,void 0,o,p,!0,l);else if("gzip"==r.type)ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_INFLATE_SCRIPT_NAME),ze.App.CHUNK_SIZE_INFLATE,t,r.offset,r.compressedSize,r.uncompressedSize,r.crc32,s,n,null,void 0,void 0,o,p,!0,l);else if("lzma"==r.type){var h=null!=r.uncompressedSize?r.uncompressedSize:-1,d={};d.decoderProperties=r.decoderProperties,ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_LZMA_SCRIPT_NAME),ze.App.CHUNK_SIZE_LZMA,t,r.offset,r.compressedSize,h,r.crc32,s,n,null,void 0,d,o,p,!0,l)}else if("xz"==r.type)ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_XZ_SCRIPT_NAME),ze.App.CHUNK_SIZE_XZ,t,r.offset,r.compressedSize,r.uncompressedSize,r.crc32,s,n,null,void 0,void 0,o,p,!0,l);else if("lzip"==r.type)try{ze.App.decompressLzipArchiveEntryMembers(t,r.lzipMembers,r.totalUncompressedSize,r.totalCompressedSize,function(e){s(l?e:new Blob(e))},n,o,p)}catch(e){return void n(e)}else{if("zip"!=r.type)return void n("Error: Unrecognized Entry Archive Type: "+r.type);if(r.isEncrypted&&(null==a||0==a.length))return void n(zeZipLib.ERR_INFLATION+" - ZIP file is password protected but no password was provided");var E=zeZipLib.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES+65536+(r.isEncrypted?zeZipLib.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH:0);ze.App.blobToDataViewAsync(t,r.offset,Math.min(r.offset+E,t.size),function(e){try{zeZipLib.decompressZipEntry(t,e,r.offset,r.compressedSize,r.uncompressedSize,r.bitFlag,i?r.crc32:null,r.compressionMethod,r.encryptionMode,s,n,o,p,a,r.aesKeyStrengthBits,l)}catch(e){n("decompressEntryData error: "+e)}},n)}},ze.App.decompressLzipArchiveEntryMembers=function(e,t,i,r,s,n,o,p){ze.App.doDecompressLzipArchiveEntryMember(e,t,0,i,r,0,[],s,n,o,p)},ze.App.doDecompressLzipArchiveEntryMember=function(r,s,n,o,p,a,l,h,d,E,A){try{var c=s[n],e={};e.decoderProperties=c.lzmaProps,ze.App.genericDecompressWithWorker(new Worker(ze.App.LIB_LZMA_SCRIPT_NAME),ze.App.CHUNK_SIZE_LZMA,r,c.offset,c.compressedSize,-1,c.crc32,function(e){for(var t=0,i=0;i<e.length;i++)l.push(e[i]),t+=e[i].length;t==c.uncompressedSize?n!=s.length-1?ze.App.doDecompressLzipArchiveEntryMember(r,s,n+1,o,p,a+c.compressedSize,l,h,d,E,A):h(l):d("LZIP uncompressed LZMA stream size mismatch: Expected "+c.uncompressedSize+", got: "+t)},d,null,void 0,e,E,A,!0,!0,p,a)}catch(e){return void d(e)}},ze.App.isTextFileType=function(e,t){return"text"==t||"code"==t||"csv"==t||("README"==(e||"").toUpperCase()||"LICENSE"==(e||"").toUpperCase()||"INSTALL"==(e||"").toUpperCase()||"COPYING"==(e||"").toUpperCase()||"NEWS"==(e||"").toUpperCase()||"THANKS"==(e||"").toUpperCase())},ze.App.isHiddenTextViewableDotFile=function(e,t){return e==="."+t},ze.App.isSystemFile=function(e,t,i){if(null==e)return!1;var r=null!=t?t:ze.App.getFileExtension(e).toLowerCase();return ze.App.startsWith(e,"._")||ze.App.stringContains(e,"/._")||ze.App.startsWith(e,"__MACOSX")&&ze.App.stringContains(e,"/._")||ze.App.startsWith(e,"__MACOSX")&&i||"ds_store"==r.toLowerCase()||"thumbs.db"==e.toLowerCase()||ze.App.endsWith(e.toLowerCase(),"/thumbs.db")},ze.App.htmlEscape=function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},ze.App.updateEmbeddedTarFilename=function(e,t,i){var r,s=(e=e||"").toLowerCase().indexOf(t,e.length-t.length);return-1!==s?(e=e.substring(0,s),e+="tar"):-1!==(r=e.toLowerCase().indexOf(i,e.length-i.length))&&(e=e.substring(0,r-1)),e},ze.App.updatePageTitle=function(e){document.title=e?e+" - "+ze.App.NAME:ze.App.NAME},ze.App.resetPageTitle=function(){document.title=ze.App.DEFAULT_PAGE_TITLE},ze.App.getProcessedSizeFromDriveFileObj=function(e){var t=null!=e.size?e.size:null!=e.sizeBytes?e.sizeBytes:null;return null!=t?parseInt(t,10):-1},ze.App.getZipExtractorCreateZipCommentString=function(){return"Created by ZIP Extractor v"+ze.VERSION+" on "+ze.App.getCurrentDateFormatted()},ze.App.getCurrentDateFormatted=function(){var e=new Date,t=""+(e.getMonth()+1),i=""+e.getDate(),r=e.getFullYear();return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),[r,t,i].join("-")},ze.App.sanitizeDriveFilename=function(e){return null==e?null:e.replace("/","_").replace("?","_").replace("*","_").replace("+","_").replace(",","_").replace(":","_").replace(";","_").replace("<","_").replace("=","_").replace(">","_").replace("\\","_").replace("[","_").replace("]","_")},ze.App.genericDecompressWithWorker=function(c,u,n,o,p,e,T,z,_,P,S,t,I,D,R,m,i,r){var s,a,v=performance.now(),y=0,l=0,w=[],C=null==r?0:r,b=null==i?p:i;function g(e,t,i){var r,s;-1==e&&(e=p),(y=l*e)<p?(r=o+y,s=Math.min(e,p-y),ze.App.blobToByteArrayAsync(n,r,r+s,function(e){try{t==ze.App.ENCRYPTION_MODE_PKZIPSTANDARD?zeZipLib.Crypto.decryptChunkBytesInPlaceZipCrypto(e,i):t==ze.App.ENCRYPTION_MODE_WINZIPAES?zeZipLib.Crypto.Aes.decryptChunkBytesInPlaceWinZipAes(e,i):t==ze.App.ENCRYPTION_MODE_7ZAES&&zeSevenZLib.decryptChunkBytesInPlace7zAes(e,i),c.postMessage({append:!0,data:e},[e.buffer]),l++}catch(e){c.terminate(),_(e)}},function(e){c.terminate(),_(e)})):c.postMessage({flush:!0})}c.addEventListener(ze.App.DECOMPRESS_WORKER_MESSAGE_EVENT,function e(t){var i=t.data;if(i.progress&&I)return I(C+y+i.current,b,R),D&&D()?(c.terminate(),void _(ze.App.ERR_WRITE_DATA+" - cancelled",!0)):void 0;var r=i.onflush,s=i.onappend,n=i.isError,o=i.oninit,p=r?" - flush() -":o?" - init() - ":"";if(n)return c.terminate(),void _(ze.App.ERR_GENERIC_DECOMPRESS+p+" - "+i.errorMessage);if(o){if(P==ze.App.ENCRYPTION_MODE_PKZIPSTANDARD)return void ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIP_SCRIPT_NAME,function(){try{g(u,P,S)}catch(e){c.terminate(),_(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decrypt decompress() - "+p+e)}});if(P==ze.App.ENCRYPTION_MODE_WINZIPAES)return void ze.App.ensureLibLoadedAndCallback(ze.App.LIB_ZIP_WINDOW_OBJECT_CHECK,ze.App.LIB_ZIP_SCRIPT_NAME,function(){ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){try{g(u,P,S)}catch(e){c.terminate(),_(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decrypt decompress() - "+p+e)}})});if(P==ze.App.ENCRYPTION_MODE_7ZAES)return void ze.App.ensureLibLoadedAndCallback(ze.App.LIB_CRYPTO_WINDOW_OBJECT_CHECK,ze.App.LIB_CRYPTO_SCRIPT_NAME,function(){try{g(u,P,S)}catch(e){c.terminate(),_(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decrypt decompress() - "+p+e)}});try{g(u,P,S)}catch(e){c.terminate(),_(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decompress() - "+p+e)}}else{if(!r&&!s)return c.terminate(),void _(ze.App.ERR_GENERIC_DECOMPRESS+" - Expected message type of either flush or append");if(!r&&null==i.data)return c.terminate(),void _(ze.App.ERR_GENERIC_DECOMPRESS+" - Inflated data chunk is required but was null");var a=i.data;if(null!=i.data){a.length;try{w.push(a)}catch(e){return c.terminate(),void _(ze.App.ERR_WRITE_DATA+" - decompress() - "+p+e)}}if(D&&D())return c.terminate(),void _(ze.App.ERR_WRITE_DATA+" - inflate() - cancelled",!0);if(s)try{g(u,P,S),I&&I(Math.min(C+y,b),b,R)}catch(e){return c.terminate(),void _(ze.App.ERR_WRITE_DATA+" - sendDataChunk - decompress() - "+p+e)}else{if(!r)return c.terminate(),void _(ze.App.ERR_WRITE_DATA+" - finalization - decompress() - expected either append or flush for finalization actions");c.removeEventListener(ze.App.DECOMPRESS_WORKER_MESSAGE_EVENT,e,!1),c.terminate(),window.console.log("Elapsed Time to decompress entry: "+Math.round(performance.now()-v));var l=T,h=i.crc32;if(null!=l){if(null==h)return void _(ze.App.ERR_READ_DATA_CRC+" - No CRC32 valued was computed for this entry, but a CRC32 check value was provided and required to be checked.");if(l!=h>>>0)return void _(ze.App.ERR_READ_DATA_CRC)}if(P==ze.App.ENCRYPTION_MODE_WINZIPAES){if(!S)return void _("Encryption params required for WINZIP AES decryption verification");var d=S.authenticationCodeBytes;if(!d)return void _("Authentication code required for WINZIP AES decryption verification");var E=S.hmac;if(!E)return void _("HMAC required for WINZIP AES decryption verification");var A=null;try{A=zeZipLib.Crypto.Aes.verifyWinzipAesAuthenticationCode(d,E)}catch(e){return void _(e)}if(!A)return void _("Message authentication code did not match. Password is invalid or ZIP file data has been corrupted.")}z(m?w:new Blob(w))}}},!1),c.onerror=function(e){c.terminate();var t=e||"",i=t.message+" (Line "+t.lineno+") "+(t.filename||" ")+(t.target||" ")+(t.type||" ");_(ze.App.ERR_GENERIC_DECOMPRESS+" - Worker Error #1 - "+e+" - "+i)},c.addEventListener("error",function(e){c.terminate();var t=e||"",i=t.message+" (Line "+t.lineno+") "+(t.filename||" ")+(t.target||" ")+(t.type||" ");_(ze.App.ERR_GENERIC_DECOMPRESS+" - Worker Error #2 - "+e+" - "+i)},!1),s=null!=T,a=t||{},c.postMessage({init:!0,computeCrc32:s,uncompressedSize:e,params:a}),I&&I(C+0,b,R)},ze.AsyncWorkQueue=function(e){this.maxWorkers=e,this.workQueue=null,this.runCompleteCallback=null,this.numCurrentWorkers=-1,this.isRunning=!1,this.init()},ze.AsyncWorkQueue.prototype.init=function(){this.workQueue=[],this.numCurrentWorkers=0,this.runCompleteCallback=null,this.isRunning=!1},ze.AsyncWorkQueue.prototype.close=function(){this.init()},ze.AsyncWorkQueue.prototype.enqueue=function(e){this.workQueue.push(e)},ze.AsyncWorkQueue.prototype.run=function(e){this.runCompleteCallback=e,this.isRunning=!0,this.processQueue()},ze.AsyncWorkQueue.prototype.processQueue=function(){for(;this.numCurrentWorkers<this.maxWorkers&&!this.isEmpty();)this.executeNextWorkItem()},ze.AsyncWorkQueue.prototype.stop=function(){this.workQueue.length=0,this.isRunning=!1},ze.AsyncWorkQueue.prototype.isEmpty=function(){return 0===this.workQueue.length},ze.AsyncWorkQueue.prototype.isActive=function(){return this.isRunning||!this.isDone()},ze.AsyncWorkQueue.prototype.isDone=function(){return 0===this.numCurrentWorkers&&this.isEmpty()},ze.AsyncWorkQueue.prototype.executeNextWorkItem=function(){var e=this.workQueue.shift();if(this.numCurrentWorkers>this.maxWorkers)throw new Error("Error: too many workers. Current # of Workers: "+this.numCurrentWorkers+"; max: "+this.maxWorkers);this.numCurrentWorkers++,e(bindFn(this.workItemComplete,this))},ze.AsyncWorkQueue.prototype.workItemComplete=function(){if(this.isRunning){if(this.numCurrentWorkers--,this.numCurrentWorkers<0)throw console.log("*** Error: too few workers"),new Error("Error: too few workers. Current # of Workers: "+this.numCurrentWorkers+"; min: 0");this.isDone()?(this.isRunning=!1,this.runCompleteCallback&&this.runCompleteCallback()):this.processQueue()}},ze.Dapi={},ze.Dapi.activeRequests=[],ze.Dapi.ApiUrl={UPLOAD:"https://www.googleapis.com/upload/drive/v3/files/",FILES:"https://www.googleapis.com/drive/v3/files/"},ze.Dapi.ErrType={FORBIDDEN:"forbidden",FILE_NOT_FOUND:"fileNotFound",METHOD_NOT_ALLOWED:"methodNotAllowed",DEADLINE_EXCEEDED:"deadlineExceeded",SERVER_ERROR:"serverError",AUTH_ERROR:"authError",BAD_REQUEST:"badRequest",REQUEST_ABORTED:"requestAborted",UNKNOWN:"unknown"},ze.Dapi.ErrMsg={FORBIDDEN:"There was a problem with the server request; please try again",FILE_NOT_FOUND:"You do not have read access to this file; try a different Google account",METHOD_NOT_ALLOWED:"An configuration error occured when uploading this file",DEADLINE_EXCEEDED:"The server took too long to respond; please try again",SERVER_ERROR:"An internal server error occurred; please try again",AUTH_ERROR:"An authorization error occurred; please re-authorize",BAD_REQUEST:"The server request could not be understood; please report this error to the developers",REQUEST_ABORTED:"The request was aborted when it was still in progress",UNKNOWN:"An unknown error occurred; please try again or report this error to the developers",XHR_NETWORK:"Network request failed. Please check that you are online and try again"},ze.Dapi.XHR_ERROR_CODES={403:ze.Dapi.ErrType.FORBIDDEN,404:ze.Dapi.ErrType.FILE_NOT_FOUND,405:ze.Dapi.ErrType.METHOD_NOT_ALLOWED,500:ze.Dapi.ErrType.SERVER_ERROR,503:ze.Dapi.ErrType.DEADLINE_EXCEEDED,401:ze.Dapi.ErrType.AUTH_ERROR,400:ze.Dapi.ErrType.BAD_REQUEST,0:ze.Dapi.ErrType.REQUEST_ABORTED},ze.Dapi.getErrorMessage=function(e,t){switch(e){case ze.Dapi.ErrType.FORBIDDEN:return ze.Dapi.ErrMsg.FORBIDDEN+(t?" ("+t+")":"");case ze.Dapi.ErrType.FILE_NOT_FOUND:return ze.Dapi.ErrMsg.FILE_NOT_FOUND;case ze.Dapi.ErrType.SERVER_ERROR:return ze.Dapi.ErrMsg.SERVER_ERROR;case ze.Dapi.ErrType.DEADLINE_EXCEEDED:return ze.Dapi.ErrMsg.DEADLINE_EXCEEDED;case ze.Dapi.ErrType.AUTH_ERROR:return ze.Dapi.ErrMsg.AUTH_ERROR;case ze.Dapi.ErrType.BAD_REQUEST:return ze.Dapi.ErrMsg.BAD_REQUEST;case ze.Dapi.ErrType.REQUEST_ABORTED:return ze.Dapi.ErrMsg.REQUEST_ABORTED;case ze.Dapi.ErrType.METHOD_NOT_ALLOWED:return ze.Dapi.ErrMsg.METHOD_NOT_ALLOWED;default:return ze.Dapi.ErrMsg.UNKNOWN}},ze.Dapi.DEFAULT_FIELDS_GET="id,name,size,parents,mimeType",ze.Dapi.DEFAULT_FIELDS_CREATE="id",ze.Dapi.Method={POST:"POST",GET:"GET",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"},ze.Dapi.CbType={SUCCESS:"success",ERROR:"error",PROGRESS:"progress",ABORT:"abort"},ze.Dapi.MimeType={JSON:"application/json",FOLDER:"application/vnd.google-apps.folder"},ze.Dapi.XhrResponseType={BLOB:"blob",JSON:"json",TEXT:"text"},ze.Dapi.generateCallbacks=function(e,t,i,r){var s={};return s[ze.Dapi.CbType.SUCCESS]=e,s[ze.Dapi.CbType.ERROR]=t,i&&(s[ze.Dapi.CbType.PROGRESS]=i),r&&(s[ze.Dapi.CbType.ABORT]=r),s},ze.Dapi.abortDownload=function(){var e=ze.Dapi.getDownloadXhr();e&&e.abort()},ze.Dapi.getDownloadXhr=function(){return 0<ze.Dapi.activeRequests.length?ze.Dapi.activeRequests[0]:null},ze.Dapi.get=function(e,t){var i={fields:ze.Dapi.DEFAULT_FIELDS_GET,supportsAllDrives:"true"};ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e,i)},ze.Dapi.uploadFile=function(e,t,i,r){i&&0<i.size?ze.Dapi.uploadFileResumeable(e,t,i,r):ze.Dapi.createEmptyFile(e,t,r)},ze.Dapi.uploadFileResumeable=function(r,e,s,t){var i=ze.Dapi.generateCallbacks(function(e,t){var i;t?MAINAPP.isSessionAborted?(i=r[ze.Dapi.CbType.ABORT])&&i():ze.Dapi.sendResumeableUploadFileData(r,t,s):(0,r[ze.Dapi.CbType.ERROR])(void 0,'No Session URI was provided in server response for "Location" response header')},r[ze.Dapi.CbType.ERROR],void 0,r[ze.Dapi.CbType.ABORT]);ze.Dapi.getResumeableUploadSessionUri(i,e,s,t)},ze.Dapi.getResumeableUploadSessionUri=function(e,t,i,r){var s={uploadType:"resumable",fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"},n={name:t};r&&(n.parents=[r]);var o="application/json; charset=UTF-8",p={"X-Upload-Content-Type":"application/octet-stream","X-Upload-Content-Length":i.size,"Content-Type":o};ze.Dapi.sendXhr(e,ze.Dapi.Method.POST,ze.Dapi.ApiUrl.UPLOAD,s,JSON.stringify(n),o,ze.Dapi.XhrResponseType.JSON,void 0,p,"Location",!0)},ze.Dapi.sendResumeableUploadFileData=function(e,t,i){ze.Dapi.sendXhr(e,ze.Dapi.Method.PUT,t,{},i,"",ze.Dapi.XhrResponseType.JSON,void 0,{})},ze.Dapi.createFolder=function(e,t,i){ze.Dapi.createEmptyItemOrFolder(e,t,!0,i)},ze.Dapi.createEmptyFile=function(e,t,i){ze.Dapi.createEmptyItemOrFolder(e,t,!1,i)},ze.Dapi.createEmptyItemOrFolder=function(e,t,i,r){var s={name:t};i&&(s.mimeType=ze.Dapi.MimeType.FOLDER),r&&(s.parents=[r]);var n={fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"};ze.Dapi.sendXhr(e,ze.Dapi.Method.POST,ze.Dapi.ApiUrl.FILES,n,JSON.stringify(s),ze.Dapi.MimeType.JSON,ze.Dapi.XhrResponseType.JSON)},ze.Dapi.createFolder=function(e,t,i){var r={name:t,mimeType:ze.Dapi.MimeType.FOLDER};i&&(r.parents=[i]);var s={fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"};ze.Dapi.sendXhr(e,ze.Dapi.Method.POST,ze.Dapi.ApiUrl.FILES,s,JSON.stringify(r),ze.Dapi.MimeType.JSON,ze.Dapi.XhrResponseType.JSON)},ze.Dapi.sendXhr=function(h,d,e,t,i,r,s,n,o,E,A){var c=new XMLHttpRequest;ze.Dapi.activeRequests.push(c);var p,a=t||{},l=i||void 0,u=r||ze.Dapi.MimeType.JSON,T=s||ze.Dapi.XhrResponseType.JSON;c.onreadystatechange=function(e){var t,i,r,n,o,s,p,a,l;4==c.readyState&&(ze.Dapi.removePendingXhr(c),200==c.status&&(null==c.response||null==c.response)&&A||200==c.status&&null!=c.response&&null!=c.response||204==c.status&&!c.response?((t=c.response)&&""===c.responseType&&"string"==typeof c.response&&(t=JSON.parse(c.response)),E?(i=c.getResponseHeader(E),ze.Dapi.invokeCallback(h,ze.Dapi.CbType.SUCCESS,t,i)):ze.Dapi.invokeCallback(h,ze.Dapi.CbType.SUCCESS,t)):0===c.status||200==c.status&&(null==c.response||null==c.response)?(logImpression("xhr_aborted","xhr","xhr_status="+c.status+", xhr_response == null? "+c.response==null),r=ze.Dapi.getErrorMessage(ze.Dapi.ErrType.REQUEST_ABORTED),ze.Dapi.invokeCallback(h,ze.Dapi.CbType.ABORT,r)):(n=ze.Dapi.XHR_ERROR_CODES[c.status],o=c.statusText||"",s="",(p=c.response)&&""===c.responseType&&"string"==typeof p&&(p=JSON.parse(p)),p&&p.error&&(s=p.error.message||"")&&(o?o+=" - "+s:o=s),c.response&&c.response instanceof Blob&&"application/json"===c.response.type?((a=new FileReader).onload=function(e){var t="";try{var i,r=JSON.parse(e.target.result);r&&r.error?r.error.errors&&0<r.error.errors.length?(t=(t=r.error.errors[0].reason)||"",(i=r.error.errors[0].message)&&(t+=" - "+i)):t=r.error:t=(r||"")+" ("+e.target.result+")"}catch(e){t="Error parsing response BLOB JSON ("+e+")"}var s=n+" "+c.status+" ["+t+"]"+(o?" ("+o+")":"");logImpression("xhr_http_error","xhr","method="+d+"; error: "+s),ze.Dapi.invokeCallback(h,ze.Dapi.CbType.ERROR,n,ze.Dapi.getErrorMessage(n,t))},a.readAsText(c.response)):(l=n+" "+c.status+(o?" ("+o+")":""),logImpression("xhr_http_error2","xhr","method="+d+"; error: "+l),ze.Dapi.invokeCallback(h,ze.Dapi.CbType.ERROR,n,ze.Dapi.getErrorMessage(n,s)))))},h[ze.Dapi.CbType.PROGRESS]&&(p=function(e){var t,i;e&&(t=e.loaded,i=e.total,400==c.status||401==c.status||403==c.status||404==c.status||500==c.status||503==c.status||ze.Dapi.invokeCallback(h,ze.Dapi.CbType.PROGRESS,t,i))},d==ze.Dapi.Method.GET?c.onprogress=p:c.upload.onprogress=p),h[ze.Dapi.CbType.ERROR]&&(c.onerror=function(e){var t=ze.Dapi.ErrMsg.XHR_NETWORK,i="";c.statusText&&(i+=c.statusText+" - "),e&&(e.target&&e.target.status&&(i+=" - "+e.target.status),e.error&&(i+=" - "+e.error)),logImpression("xhr_network_error","xhr","error: "+(t+(i?" ("+i+")":""))),ze.Dapi.removePendingXhr(c),ze.Dapi.invokeCallback(h,ze.Dapi.CbType.ERROR,t,i)});var z=ze.Dapi.buildCorsUrl(e,a);if(c.open(d,z,!0),c.responseType=T,c.setRequestHeader("Authorization","Bearer "+getAccessToken()),u&&c.setRequestHeader("Content-Type",u),n&&c.setRequestHeader("Range","bytes="+n),o)for(var _ in o)o.hasOwnProperty(_)&&c.setRequestHeader(_,o[_]);c.send(l)},ze.Dapi.buildCorsUrl=function(e,t){var i=e,r=ze.Dapi.buildQuery(t);return r&&(i+="?"+r,0),i},ze.Dapi.buildQuery=function(t){return t=t||{},Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},ze.Dapi.removePendingXhr=function(e){var t=ze.Dapi.activeRequests.indexOf(e);-1!=t&&ze.Dapi.activeRequests.splice(t,1)},ze.Dapi.abortAllRequests=function(){for(var e=ze.Dapi.activeRequests.slice(0),t=0;t<e.length;t++){var i=e[t];i&&i.abort&&i.abort()}},ze.Dapi.invokeCallback=function(e,t,i,r){var s=e[t];s&&s(i,r)},ze.Dapi.downloadFileBytes=function(e,t,i,r){var s={alt:"media",supportsAllDrives:"true"};r&&(s.acknowledgeAbuse=!0),ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e,s,void 0,void 0,ze.Dapi.XhrResponseType.BLOB,i)},ze.Dapi.exportGoogleDocFileBytes=function(e,t,i){var r={alt:"media",supportsAllDrives:"true",mimeType:i||"application/pdf"};ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e+"/export",r,void 0,void 0,ze.Dapi.XhrResponseType.BLOB)},ze.RarLib={},ze.RarLib.RAR_HEADER_V1=String.fromCharCode(82,69,126,94),ze.RarLib.RAR_HEADER_V4=String.fromCharCode(82,97,114,33,26,7,0),ze.RarLib.RAR_HEADER_V5=String.fromCharCode(82,97,114,33,26,7,1,0),ze.RarLib.HEADER_MAGIC_BYTES_SIZE=8,ze.RarLib.ARCHIVE_HEADER_MIN_SIZE=18,ze.RarLib.verifyRarFile=function(e,t,i){e.size<ze.RarLib.ARCHIVE_HEADER_MIN_SIZE?i("RAR file size is less than required header size."):ze.App.blobToString(e,0,ze.RarLib.HEADER_MAGIC_BYTES_SIZE,function(e){return ze.RarLib.RAR_HEADER_V4==e.slice(0,ze.RarLib.RAR_HEADER_V4.length)?void t(ze.RarLib.RAR_HEADER_V4):ze.RarLib.RAR_HEADER_V1==e.slice(0,ze.RarLib.RAR_HEADER_V1.length)?void i("Older RAR Version 1 format is not yet supported."):ze.RarLib.RAR_HEADER_V5==e.slice(0,ze.RarLib.RAR_HEADER_V5.length)?void t(ze.RarLib.RAR_HEADER_V5):void i('File does not appear to be a RAR file ("'+e+'")')},i)},ze.RarLib.getRarEntries=function(e,t,i,r,s,n){var o;e.size<=ze.RarLib.ARCHIVE_HEADER_MIN_SIZE?i("RAR file insufficient size ("+e.size+")"):n==ze.RarLib.RAR_HEADER_V5||n==ze.RarLib.RAR_HEADER_V4?(o=bindFn(ze.RarLib.doGetRarEntries,this,e,t,i,r,s),ze.App.ensureLibLoadedAndCallback(ze.App.LIB_RAR_WINDOW_OBJECT_CHECK,ze.App.LIB_RAR_SCRIPT_NAME,o)):i("Unexpected RAR version: "+n)},ze.RarLib.doGetRarEntries=function(o,p,a,e,l){logImpression("read_rar_new","rar","start"),ze.App.blobToByteArrayAsync(o,0,o.size,function(e){try{var t=new FileInfo("default_rar_filename");t.InitStream(e.buffer);var i={};i.password=l?String.fromCharCode.apply(String,l):null;var r=null;try{r=GetRarArchive(t,i)}catch(e){return MAINAPP.zipBlob=o,e.type==RarError.EncryptedNeedPassword?i.password?void a("Incorrect RAR password for encrypted header",!1,!0,!0):void a("RAR Archive header is encrypted but no password specified",!1,!0):e.type==RarError.WrongPassword?void a("Wrong RAR password for encrypted header",!1,!0,!0):void a(e)}var s=r.IsEncrypted();if(console.log("Got RarArchive. Archive Header Encrypted? "+s),s&&!i.password)return void a("RAR Archive header is encrypted but no password specified (2)",!1,!0);var n=r.Entries();return p(ze.RarLib.translateFilterAndProcessRarLibEntries(n)),void(s&&(MAINAPP.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED),MAINAPP.zipEntryTree.isEncrypted=!1))}catch(e){return void a("An error occurred when reading the RAR file: "+e)}},a)},ze.RarLib.translateFilterAndProcessRarLibEntries=function(e){for(var t=[],i=0;i<e.length;i++){var r=ze.RarLib.maybeTranslateRarLibEntry(e[i]);r&&t.push(r)}return t},ze.RarLib.maybeTranslateRarLibEntry=function(e){var t=e.FileHeader(),i=t.IsDirectory(),r=(r=t.FileName).replace(/\\/g,"/");if(ze.App.isSystemFile(r,null,i))return null;var s={type:"rar"};return s.originalRarLibEntry=e,s.filename=r,s.originalRarFilename=t.FileName,s.compressedSize=t.CompressedSize,s.uncompressedSize=t.UncompressedSize,s.directory=i,e.IsEncrypted()&&(s.isEncrypted=!0,s.encryptionMode=ze.App.ENCRYPTION_MODE_RAR),s},ze.RarLib.decompressRarEntry=function(e,t,i,r,s,n){var o={};try{t&&t.length&&0<t.length&&(o.password=String.fromCharCode.apply(String,t)),i(new Blob(e.getDecompressedByteArrayParts(o)))}catch(e){console.log(e),r("General RAR Decompression error: "+e);var p=(e||"")+" - "+ze.App.getErrorDetailsFromErrorObject(e);o.password?logImpression("rar_decompress_special_error_with_password","rar",p):logImpression("rar_decompress_special_error","rar",p)}},ze.LzipLib={},ze.LzipLib.LZIP_HEADER_SIZE=6,ze.LzipLib.LZIP_FOOTER_SIZE=20,ze.LzipLib.HEADER_SIGNATURE_BYTE_0=76,ze.LzipLib.HEADER_SIGNATURE_BYTE_1=90,ze.LzipLib.HEADER_SIGNATURE_BYTE_2=73,ze.LzipLib.HEADER_SIGNATURE_BYTE_3=80,ze.LzipLib.HEADER_SIGNATURE_BYTE_4=1,ze.LzipLib.MIN_DICTIONARY_SIZE=4096,ze.LzipLib.MAX_DICTIONARY_SIZE=1<<29,ze.LzipLib.verifyLzipFile=function(e,i,r){e.size<ze.LzipLib.LZIP_HEADER_SIZE+ze.LzipLib.LZIP_FOOTER_SIZE?r("LZIP file is less than required size."):ze.App.blobToByteArrayAsync(e,0,ze.LzipLib.LZIP_HEADER_SIZE,function(e){var t;ze.LzipLib.isValidLzipMemberHeader(e)?i(e):(t=ze.App.getStringFromBytes(e),r('File does not appear to be an LZIP V1 file ("'+t+'")'))},r)},ze.LzipLib.getLzipEntry=function(e,t,n,i,r){var o={type:"lzip"},p=ze.App.updateEmbeddedTarFilename(t,"tlz","lz");o.filename=p,ze.LzipLib.getLzipMembersByTail(e,function(e){o.lzipMembers=e;for(var t=0,i=0;i<e.length;i++)t+=e[i].uncompressedSize;o.uncompressedSize=t;for(var r=0,s=0;s<e.length;s++)r+=e[s].compressedSize;o.totalCompressedSize=r,n(o,p)},i)},ze.LzipLib.getLzipMembersByTail=function(e,t,i){ze.LzipLib.doGetLzipMemberByTail(e,e.size,[],t,i)},ze.LzipLib.doGetLzipMemberByTail=function(n,o,p,a,l){var h;o-ze.LzipLib.LZIP_FOOTER_SIZE<0?l("Not enough bytes for LZIP footer. tailOffset: "+o):(h={},p.unshift(h),ze.App.blobToDataViewAsync(n,o-ze.LzipLib.LZIP_FOOTER_SIZE,o,function(e){var t=e.getUint32(0,!0);0===t&&(t=null),h.crc32=t;var s,i=ze.App.readUint64FromDataView(e,4,!0);Number.isSafeInteger(i)?(h.uncompressedSize=i,s=ze.App.readUint64FromDataView(e,12,!0),Number.isSafeInteger(s)&&Number.isSafeInteger(s)?o-s<0?l("LZIP bad (negative) member size"):(h.memberSize=s,h.compressedSize=s-ze.LzipLib.LZIP_HEADER_SIZE-ze.LzipLib.LZIP_FOOTER_SIZE,h.offset=o-s+ze.LzipLib.LZIP_HEADER_SIZE,ze.App.blobToByteArrayAsync(n,o-s,o-s+ze.LzipLib.LZIP_HEADER_SIZE,function(e){if(e.length<ze.LzipLib.LZIP_HEADER_SIZE)l("LZIP member header size is less than required size.");else{if(ze.LzipLib.isValidLzipMemberHeader(e)){var t=e[5],i=null;try{i=ze.LzipLib.getLzmaPropertiesFromLzipPackedPropertiesByte(t)}catch(e){return void l(e)}return h.lzmaProps=i,o-s==0?void a(p):void ze.LzipLib.doGetLzipMemberByTail(n,o-s,p,a,l)}var r=ze.App.getStringFromBytes(e);l('LZIP member has invalid signature ("'+r+'")')}},l)):l("LZIP memberSize > MAX_SAFE_INTEGER")):l("LZIP uncompressedSize > MAX_SAFE_INTEGER")},l))},ze.LzipLib.isValidLzipMemberHeader=function(e){return e[0]==ze.LzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.LzipLib.HEADER_SIGNATURE_BYTE_1&&e[2]==ze.LzipLib.HEADER_SIGNATURE_BYTE_2&&e[3]==ze.LzipLib.HEADER_SIGNATURE_BYTE_3&&e[4]==ze.LzipLib.HEADER_SIGNATURE_BYTE_4},ze.LzipLib.getLzmaPropertiesFromLzipPackedPropertiesByte=function(e){var t=31&e,i=(1<<t)-((224&e)>>5)*(1<<t-4);if(i<ze.LzipLib.MIN_DICTIONARY_SIZE||i>ze.LzipLib.MAX_DICTIONARY_SIZE)throw new Error("LZIP invalid dictionary size: "+i);return new Uint8Array([93,255&i,i>>8&255,i>>16&255,i>>24&255])},ze.LzmaLib={},ze.LzmaLib.LZMA_HEADER_SIZE=13,ze.LzmaLib.verifyLzmaFile=function(e,t,i){e.size<ze.LzmaLib.LZMA_HEADER_SIZE?i("LZMA file size is less than required header size."):ze.App.blobToByteArrayAsync(e,0,ze.LzmaLib.LZMA_HEADER_SIZE,function(e){t(e)},i)},ze.LzmaLib.getLzmaEntry=function(e,t,i,r,s){var n={type:"lzma"};n.decoderProperties=s.slice(0,5);var o=new DataView(s.buffer,5),p=o.getUint32(0,!0),a=o.getUint32(4,!0);if(4294967295!=p||4294967295!=a){var l=p+Math.pow(2,32)*a;if(!Number.isSafeInteger(l))return void r("LZMA Entry Uncompressed Size exceeds MAX_SAFE_INTEGER");n.uncompressedSize=l}else n.uncompressedSize=-1;n.filename=ze.App.updateEmbeddedTarFilename(t,"tlz","lzma"),n.offset=ze.LzmaLib.LZMA_HEADER_SIZE,n.compressedSize=e.size-ze.LzmaLib.LZMA_HEADER_SIZE,i(n,n.filename)},ze.XzLib={},ze.XzLib.XZ_HEADER_SIZE=6,ze.XzLib.HEADER_MAGIC_BYTES2=[253,55,122,88,90,0],ze.XzLib.verifyXzFile=function(e,i,r){e.size<ze.XzLib.XZ_HEADER_SIZE?r("XZ file size ("+e.size+") is less than required header size"):ze.App.blobToByteArrayAsync(e,0,ze.XzLib.XZ_HEADER_SIZE,function(e){var t;e[0]==ze.XzLib.HEADER_MAGIC_BYTES2[0]&&e[1]==ze.XzLib.HEADER_MAGIC_BYTES2[1]&&e[2]==ze.XzLib.HEADER_MAGIC_BYTES2[2]&&e[3]==ze.XzLib.HEADER_MAGIC_BYTES2[3]&&e[4]==ze.XzLib.HEADER_MAGIC_BYTES2[4]&&e[5]==ze.XzLib.HEADER_MAGIC_BYTES2[5]?i(e):(t=ze.App.getStringFromBytes(e),r('File does not appear to be an XZ file ("'+t+'")'))},r)},ze.XzLib.getXzEntry=function(e,t,i,r){var s={type:"xz"};s.filename=ze.App.updateEmbeddedTarFilename(t,"txz","xz"),s.compressedSize=e.size,s.uncompressedSize=-1,s.crc32=null,s.offset=0,i(s,s.filename)},ze.BzipLib={},ze.BzipLib.BZIP_SIGNATURE_SIZE=3,ze.BzipLib.HEADER_SIGNATURE_BYTE_0=66,ze.BzipLib.HEADER_SIGNATURE_BYTE_1=90,ze.BzipLib.HEADER_SIGNATURE_BYTE_2=104,ze.BzipLib.bzipLzmaLibraryPendingLoad=!1,ze.BzipLib.additionalPendingBzipLibCallbackFn=null,ze.BzipLib.verifyBzipFile=function(e,i,r){e.size<ze.BzipLib.BZIP_SIGNATURE_SIZE?r("BZIP file size is less than required signature size."):ze.App.blobToByteArrayAsync(e,0,ze.BzipLib.BZIP_SIGNATURE_SIZE,function(e){var t;e[0]==ze.BzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.BzipLib.HEADER_SIGNATURE_BYTE_1&&e[2]==ze.BzipLib.HEADER_SIGNATURE_BYTE_2?i(e):(t=ze.App.getStringFromBytes(e),r('File does not appear to be a Bzip file ("'+t+'")'))},r)},ze.BzipLib.getBzipEntry=function(e,t,i,r){var s={type:"bzip"};s.filename=ze.App.updateEmbeddedTarFilename(t,"tbz2","bz2"),s.filename=ze.App.updateEmbeddedTarFilename(s.filename,"tbz","bz2"),s.compressedSize=e.size,s.offset=0,i(s,s.filename)},ze.GzipLib={},ze.GzipLib.HEADER_SIGNATURE_BYTE_0=31,ze.GzipLib.HEADER_SIGNATURE_BYTE_1=139,ze.GzipLib.COMPRESSION_MODE_DEFLATE=8,ze.GzipLib.GZIP_SIGNATURE_SIZE=2,ze.GzipLib.GZIP_FIXED_HEADER_SIZE=18,ze.GzipLib.GZIP_MAX_HEADER_READ_SIZE=65535,ze.GzipLib.GZIP_FOOTER_SIZE=8,ze.GzipLib.FLAG_FTEXT=1,ze.GzipLib.FLAG_FHCRC=2,ze.GzipLib.FLAG_FEXTRA=4,ze.GzipLib.FLAG_FNAME=8,ze.GzipLib.FLAG_FCOMMENT=16,ze.GzipLib.verifyGzipFile=function(e,i,r){e.size<ze.GzipLib.GZIP_FIXED_HEADER_SIZE?r("GZIP file size is less than required minimum header size."):ze.App.blobToByteArrayAsync(e,0,ze.GzipLib.GZIP_SIGNATURE_SIZE,function(e){var t;e[0]==ze.GzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.GzipLib.HEADER_SIGNATURE_BYTE_1?i(e):(t=ze.App.getStringFromBytes(e),r('File does not appear to be a Gzip file ("'+t+'")'))},r)},ze.GzipLib.getGzipEntry=function(n,o,p,a){var l={type:"gzip"},h=2;ze.App.blobToDataViewAsync(n,0,ze.GzipLib.GZIP_MAX_HEADER_READ_SIZE,function(e){var t,i,r,s;l.compressionMethod=e.getUint8(h),h+=1,l.compressionMethod==ze.GzipLib.COMPRESSION_MODE_DEFLATE?(t=e.getUint8(h),l.flags=t,h+=1,t&ze.GzipLib.FLAG_FTEXT?l.ftext=!0:l.ftext=!1,l.mtime=e.getUint32(h,!0),h+=4,l.xflags=e.getUint8(h),h+=1,l.os=e.getUint8(h),h+=1,t&ze.GzipLib.FLAG_FEXTRA&&(l.xlen=e.getUint16(h,!0),h+=2,l.xbytes=new Uint8Array(e.buffer,h,h+l.xlen).slice(),h+=l.xlen),t&ze.GzipLib.FLAG_FNAME?(i=ze.GzipLib.getNullTerminatedStringFromDataView(e,h),l.filename=i,h+=i.length,h+=1):l.filename=ze.App.updateEmbeddedTarFilename(o,"tgz","gz"),t&ze.GzipLib.FLAG_FCOMMENT&&(r=ze.GzipLib.getNullTerminatedStringFromDataView(e,h),l.comment=r,h+=r.length,h+=1),t&ze.GzipLib.FLAG_FHCRC&&(l.fhcrc16=e.getUint16(h,!0),h+=2),l.offset=h,s=n.size-h-ze.GzipLib.GZIP_FOOTER_SIZE,l.compressedSize=s,ze.App.blobToDataViewAsync(n,h+s,h+s+ze.GzipLib.GZIP_FOOTER_SIZE,function(e){l.crc32=e.getUint32(0,!0),0===l.crc32&&(l.crc32=null),l.uncompressedSize=e.getUint32(4,!0),p(l,l.filename)},a)):a("Error: GZIP does not support non-DEFLATE compression method ("+l.compressionMethod+")")},a)},ze.GzipLib.getNullTerminatedStringFromDataView=function(e,t){for(var i="",r=e.byteLength,s=null,n=t;n<r;n++){if(0===(s=e.getUint8(n)))return i;i+=String.fromCharCode(s)}return i},ze.SevenZLibCore={},ze.SevenZLibCore.SEVENZ_SIGNATURE=[55,122,188,175,39,28,0],ze.SevenZLibCore.SEVENZ_SIGNATURE_STRING=String.fromCharCode(55,122,188,175,39,28,0),ze.SevenZLibCore.SEVENZ_SIGNATURE_SIZE=7,ze.SevenZLibCore.SEVENZ_START_HEADER_SIZE=32,ze.SevenZLibCore.verifySevenZFile=function(e,t,i){e.size<ze.SevenZLibCore.SEVENZ_HEADER_SIZE?i("SevenZ file size is less than required start header size."):ze.App.blobToString(e,0,ze.SevenZLibCore.SEVENZ_SIGNATURE_SIZE,function(e){return ze.SevenZLibCore.SEVENZ_SIGNATURE_STRING==e?void t():void i('File does not appear to be a 7z file, or unsupported version ("'+e+'")')},i)},ze.SevenZLibCore.getSevenZEntries=function(s,n,o,p,a){ze.App.blobToDataViewAsync(s,0,ze.SevenZLibCore.SEVENZ_START_HEADER_SIZE,function(e){zeSevenZLib.getEndHeaderMetaDataFromStartHeader(e,function(e,t,r){ze.App.blobToDataViewAsync(s,e,e+t,function(e){var t,i=zeSevenZLib.computeCrc32SliceBy8(new Uint8Array(e.buffer));if(i!=r)return console.log("7z End Header CRC FAIL"),void o("End Header CRC Fail: Expected: "+r+"; got: "+i);zeSevenZLib.isEndHeaderEncoded(e)?(t=zeSevenZLib.getEncodedHeaderDecodeSequence(e),zeSevenZLib.decodeEncodedHeaderDecodeSequence(s,t,function(e){ze.SevenZLibCore.doGetSevenZEntriesFromDecodedEndHeader(s,e,n,o,p,a)},function(e){return MAINAPP.zipBlob=s,"encryptedHeader"==e.type?a?void o("Incorrect 7z Password for Encrypted Header",!1,!0,!0):void o("7z archive header is encrypted but no password specified",!1,!0):"wrongPassword"==e.type?void o("Wrong 7z Password for Encrypted Header",!1,!0,!0):void o(e)},p,void 0,a)):ze.SevenZLibCore.doGetSevenZEntriesFromDecodedEndHeader(s,e,n,o,p,a)},o)},o)},o)},ze.SevenZLibCore.doGetSevenZEntriesFromDecodedEndHeader=function(e,t,i,r,s,n){var o=null;try{o=zeSevenZLib.getEntriesFromDecodedEndHeader(t)}catch(e){return void r(e)}i(o,function(){!n||(MAINAPP.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED),MAINAPP.zipEntryTree.isEncrypted=!1)})},ze.TarLib={},ze.TarLib.TAR_TYPE_FILE=0,ze.TarLib.TAR_TYPE_DIR=5,ze.TarLib.TAR_HEADER_SIZE=512,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET=257,ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE=5,ze.TarLib.TAR_TYPE_OFFSET=156,ze.TarLib.TAR_TYPE_SIZE=1,ze.TarLib.TAR_LINKNAME_OFFSET=157,ze.TarLib.TAR_LINKNAME_SIZE=100,ze.TarLib.TAR_SIZE_OFFSET=124,ze.TarLib.TAR_SIZE_SIZE=12,ze.TarLib.TAR_NAME_OFFSET=0,ze.TarLib.TAR_NAME_SIZE=100,ze.TarLib.TAR_PREFIX_OFFSET=345,ze.TarLib.TAR_PREFIX_SIZE=155,ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING="ustar",ze.TarLib.verifyTarFile=function(e,i,r){e.size<ze.TarLib.TAR_HEADER_SIZE?r("TAR file size is less than required header size."):ze.App.blobToByteArrayAsync(e,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE,function(e){var t=ze.TarLib.verifyTarFileSignatureAsResultPair(e,0);t[0]?i():r(t[1])},r)},ze.TarLib.verifyTarFileSignatureAsResultPair=function(e,t){var i=new Array(2);if(e.length<t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE)return i[0]=!1,i[1]="TAR file signature size less than required size",i;var r=ze.App.getStringFromBytes(e,t,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE),s=r==ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING,n=0==e[t]&&0==e[t+1]&&0==e[t+2]&&0==e[t+3]&&0==e[t+4];return s||n?i[0]=!0:(i[0]=!1,i[1]='File does not appear to be a TAR file ("'+r+'")'),i},ze.TarLib.getTarEntriesFromBlob=function(e,t,i,r,s){ze.App.blobToByteArrayPartsAsync(e,function(e){try{ze.TarLib.getTarEntriesFromByteArrayParts(e,t,i,r,s)}catch(e){return void i(e)}},i,void 0,r)},ze.TarLib.getTarEntriesFromByteArrayParts=function(e,t,i,r,s){if(e&&0!=e.length){var n=new ze.JaggedByteArrayPartsWrapper(e),o=new Uint8Array(ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE);n.readBytesIntoBuffer(ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE,o);var p=ze.TarLib.verifyTarFileSignatureAsResultPair(o,0);if(p[0]){for(var a=0,l=[],h=n.getSize(),d=new Uint8Array(ze.TarLib.TAR_HEADER_SIZE);a+ze.TarLib.TAR_HEADER_SIZE<h;){n.readBytesIntoBuffer(a,ze.TarLib.TAR_HEADER_SIZE,d);var E=ze.TarLib.getTarEntryFromFileHeader(d,0,s);null!=E&&""!=E.filename&&"."!=E.filename&&".."!=E.filename&&(ze.App.stringContains(E.filename,"PaxHeader/")||ze.App.postProcessEntryFilenameAndMaybeSkip(E)||(E.offset=a,l.push(E))),0<(a+=(E?E.compressedSize:0)+ze.TarLib.TAR_HEADER_SIZE)%ze.TarLib.TAR_HEADER_SIZE&&(a=(1+(a/ze.TarLib.TAR_HEADER_SIZE|0))*ze.TarLib.TAR_HEADER_SIZE)}t(l)}else i(p[1])}else i("Cannot get TAR entries from null or empty tarByteArrayParts")},ze.TarLib.getTarEntryFromFileHeader=function(e,t,i){var r={type:"tar"},s=i?new TextDecoder(i):null;try{var n={},o=null;i?o=s.decode(e.subarray(t+ze.TarLib.TAR_NAME_OFFSET,t+ze.TarLib.TAR_NAME_OFFSET+ze.TarLib.TAR_NAME_SIZE)):(o=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_NAME_OFFSET,t+ze.TarLib.TAR_NAME_OFFSET+ze.TarLib.TAR_NAME_SIZE,n),n.hasExtendedChar&&(r.filenameHasExtendedChar=!0));var p=o.replace(/\0/g,"");if(0===(r.filename=p).length)return void(r.lastBlock=!0);var a=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_SIZE_OFFSET,t+ze.TarLib.TAR_SIZE_OFFSET+ze.TarLib.TAR_SIZE_SIZE),l=parseInt(a,8);r.compressedSize=l,r.uncompressedSize=l;var h,d,E=0|ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_TYPE_OFFSET,t+ze.TarLib.TAR_TYPE_OFFSET+ze.TarLib.TAR_TYPE_SIZE),A=E==ze.TarLib.TAR_TYPE_DIR;return r.directory=A,0==e[t+ze.TarLib.TAR_LINKNAME_OFFSET]||(h=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_LINKNAME_OFFSET,t+ze.TarLib.TAR_LINKNAME_OFFSET+ze.TarLib.TAR_LINKNAME_SIZE),r.linkname=h),r.tarChecksum=-1,ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE)==ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING&&(0==e[t+ze.TarLib.TAR_PREFIX_OFFSET]||(d=null,i?d=s.decode(e.subarray(t+ze.TarLib.TAR_PREFIX_OFFSET,t+ze.TarLib.TAR_PREFIX_OFFSET+ze.TarLib.TAR_PREFIX_SIZE)):(d=ze.App.getStringFromBytes(e,t+ze.TarLib.TAR_PREFIX_OFFSET,t+ze.TarLib.TAR_PREFIX_OFFSET+ze.TarLib.TAR_PREFIX_SIZE,n),n.hasExtendedChar&&(r.filenameHasExtendedChar=!0)),null!=d&&0<d.length&&(d=d.replace(/\0/g,""),r.filename=d+"/"+r.filename))),E===ze.TarLib.TAR_TYPE_FILE||E===ze.TarLib.TAR_TYPE_DIR?r:null}catch(e){return r.err=e,r}},ze.App.decodeUTF8Bytes=function(e){for(var t,i,r,s="",n=e.length,o=0;o<n;)switch((t=e[o++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(e[o-1]);break;case 12:case 13:i=e[o++],s+=String.fromCharCode((31&t)<<6|63&i);break;case 14:i=e[o++],r=e[o++],s+=String.fromCharCode((15&t)<<12|(63&i)<<6|(63&r)<<0)}return s};var winOpen=window.open;window.open=function(){try{var e,t,i,r,s,n,o,p,a,l,h;arguments&&2<arguments.length&&(null!=(h=arguments[2])&&(window.screen.width,e=window.screen.height,t="height=",i=h.indexOf(t),r=h.indexOf(",",i),-1!=i&&-1!=r&&(s=parseInt(h.substring(i+t.length,r)),n=Math.round(Math.min(660,e)),h=h.substring(0,i+t.length)+n+h.substring(r),o="top=",p=h.indexOf(o),a=h.indexOf(",",p),-1!=p&&-1!=a&&(l=parseInt(h.substring(p+o.length,a))-(n-s)/2,h=h.substring(0,p+o.length)+l+h.substring(a)),arguments[2]=h)))}catch(e){logImpression("window_open_height_update_err","app_load",e)}return winOpen.apply(this,arguments)},ze.App.getStackInfoFromErrorObj=function(e){var t,i,r,s=null;try{return e&&(!(t=e.stack)||(i=t.split("\n"))&&i.length&&0<=i.length&&(0<=(r=i[0]).indexOf("@")?s=r:1<=i.length&&(s=i[1].trim()))),s}catch(e){return null}},ze.App.blobToByteArrayPartsAsync=function(e,t,i,r,s){var n=r||20971520;ze.App.doReadBlobIntoByteArrayParts(e,n,0,t,i,[],s)},ze.App.doReadBlobIntoByteArrayParts=function(t,i,e,r,s,n,o){var p=Math.min(e+i,t.size);o&&o(p,t.size,!0),ze.App.blobToByteArrayAsync(t,e,p,function(e){n.push(e),p!=t.size?ze.App.doReadBlobIntoByteArrayParts(t,i,p,r,s,n,o):r(n)},s)},ze.JaggedByteArrayPartsWrapper=function(e){if(!e)throw new Error("JaggedByteArrayPartsWrapper Error: byteArrayParts cannot be null");if(null==e.length)throw new Error("JaggedByteArrayPartsWrapper Error: byteArrayParts must be an array");if(0<e.length&&(null==e[0].length||!(e[0]instanceof Uint8Array)))throw new Error("JaggedByteArrayPartsWrapper Error: byteArrayParts must be an array of byte (Uint8) Arrays");this.byteArrayParts_=e,this.numRows_=this.byteArrayParts_.length,this.tmpRowColPair_=Array(2),this.rowLengths_=null,this.cumulativeRowOffsets_=null,this.totalSize_=null,this.indexByteArrayParts_()},ze.JaggedByteArrayPartsWrapper.prototype.indexByteArrayParts_=function(){this.rowLengths_=[],this.cumulativeRowOffsets_=[];for(var e=0,t=0;t<this.byteArrayParts_.length;t++){var i=this.byteArrayParts_[t].length;this.rowLengths_.push(i),e+=i,this.cumulativeRowOffsets_.push(e)}this.totalSize_=e},ze.JaggedByteArrayPartsWrapper.prototype.doReadOrWriteByteAtAndGetSubscripts_=function(e,t,i,r){var s=this.numRows_,n=i||0,o=t||this.tmpRowColPair_;if(s<=n)throw new Error("JaggedByteArrayPartsWrapper: startRow cannot exeed the number of rows");var p=this.cumulativeRowOffsets_;if(e<p[n])return o[0]=n,o[1]=e-(0==n?0:p[n-1]),null!=r?(this.byteArrayParts_[o[0]][o[1]]=r,n):this.byteArrayParts_[o[0]][o[1]];for(var a=++n;a<s;a++)if(e<p[a])return o[0]=a,o[1]=e-p[a-1],null!=r?(this.byteArrayParts_[o[0]][o[1]]=r,a):this.byteArrayParts_[o[0]][o[1]];throw new Error("JaggedByteArrayPartsWrapper: Could not resolve subscripts for idx: "+e)},ze.JaggedByteArrayPartsWrapper.prototype.doReadByteIntoBuffer_=function(e,t,i,r){return t[r||0]=this.doReadOrWriteByteAtAndGetSubscripts_(e,this.tmpRowColPair_,i),this.tmpRowColPair_[0]},ze.JaggedByteArrayPartsWrapper.prototype.readBytesIntoBufferSimple=function(e,t,i,r){for(var s=null,n=0;n<t;n++)s=this.doReadByteIntoBuffer_(e+n,i,s,r)},ze.JaggedByteArrayPartsWrapper.prototype.readBytesIntoBuffer=function(e,t,i,r){if(t!=i.length)throw new Error("JaggedByteArrayPartsWrapper: length of bytes to read is larger than the byteArray buffer");if(t-e>this.totalSize_)throw new Error("JaggedByteArrayPartsWrapper: read() length minus offset exceeds total size");for(var s=null,n=r||0,o=0,p=0,a=0,l=0,h=0,d=0;d<t;)this.doReadOrWriteByteAtAndGetSubscripts_(e+d,this.tmpRowColPair_,o),o=this.tmpRowColPair_[0],a=p=this.tmpRowColPair_[1],h=t-d,l=Math.min(this.byteArrayParts_[o].length,p+h),s=new Uint8Array(this.byteArrayParts_[o].buffer,a,l-a),i.set(s,n+d),d+=s.length},ze.JaggedByteArrayPartsWrapper.prototype.readByteAt=function(e,t,i){return this.doReadOrWriteByteAtAndGetSubscripts_(e,t,i)},ze.JaggedByteArrayPartsWrapper.prototype.getRowAt=function(e){return this.doReadOrWriteByteAtAndGetSubscripts_(e,this.tmpRowColPair_),this.tmpRowColPair_[0]},ze.JaggedByteArrayPartsWrapper.prototype.writeByteAt=function(e,t,i){return this.doReadOrWriteByteAtAndGetSubscripts_(e,void 0,i,t)},ze.JaggedByteArrayPartsWrapper.prototype.getSize=function(){return this.totalSize_},ze.JaggedByteArrayPartsWrapper.prototype.trimToMaxLength=function(e){var t=this.totalSize_-e;return 0<t?this.trimBytes_(t):0},ze.JaggedByteArrayPartsWrapper.prototype.trimBytes_=function(e){if(e>this.totalSize_)throw new Error("Error: numBytesToTrim exceeds the total size");for(var t=e,i=0,r=this.numRows_-1;0<t;){var s=this.byteArrayParts_[r].length;t<s?(this.byteArrayParts_[r]=new Uint8Array(this.byteArrayParts_[r].buffer,this.byteArrayParts_[r].byteOffset,s-t),t=0):(i++,t-=s),r--}if(this.byteArrayParts_.length=this.byteArrayParts_.length-i,0!=t)throw new Error("Expected numTrimBytesRemaining to be 0 in JaggedByteArrayPartsWrapper.trimBytes_()");return this.indexByteArrayParts_(),e},ze.JaggedByteArrayPartsWrapper.prototype.toBlob=function(){return new Blob(this.byteArrayParts_)},ze.JaggedByteArrayPartsWrapper.prototype.getByteArrayParts=function(){return this.byteArrayParts_};